<!doctype html>
<html lang="ru-RU" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-computer-organization/lab7" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Лабораторная работа №7 | efremovnv</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" name="twitter:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" property="og:url" content="https://efremovnv.github.io/docs/labs/computer-organization/lab7"><meta data-rh="true" property="og:locale" content="ru_RU"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Лабораторная работа №7 | efremovnv"><meta data-rh="true" name="description" content="Использование интерфейса JTAG для взаимодействия процессорной системы с инструментальным компьютером"><meta data-rh="true" property="og:description" content="Использование интерфейса JTAG для взаимодействия процессорной системы с инструментальным компьютером"><link data-rh="true" rel="icon" href="/docs/img/logo2.svg"><link data-rh="true" rel="canonical" href="https://efremovnv.github.io/docs/labs/computer-organization/lab7"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/computer-organization/lab7" hreflang="ru-RU"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/computer-organization/lab7" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.b2f4074e.css">
<script src="/docs/assets/js/runtime~main.f7f1290e.js" defer="defer"></script>
<script src="/docs/assets/js/main.647d6c6e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/logo.svg"><link rel="preload" as="image" href="/docs/img/logo-dark.svg"><div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo-dark.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">efremovnv</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/labs/intro">Методички</a><a class="navbar__item navbar__link" href="/docs/labs/contributing">Контрибьюция</a><a class="navbar__item navbar__link" href="/docs/labs/links">Ссылки</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-label="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/labs/intro">Учебные материалы по организации ЭВМ и систем</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/peripheral-devices/lab1">Периферийные устройства</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/labs/computer-organization/lab7">Организация ЭВМ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/labs/computer-organization/lab7">Лабораторная работа №7</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/computer-organization/lab8">Лабораторная работа №8</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/course-work/rp-op-design">Курсовая работа</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Организация ЭВМ</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Лабораторная работа №7</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><header><h1>Лабораторная работа №7</h1></header>
<p>Использование интерфейса JTAG для взаимодействия процессорной системы с инструментальным компьютером</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="контекст">Контекст<a href="#контекст" class="hash-link" aria-label="Прямая ссылка на Контекст" title="Прямая ссылка на Контекст">​</a></h2>
<p>Данная лабораторная работа посвящена изучению интерфейса JTAG UART и его использованию для взаимодействия процессорной системы NIOS II с инструментальным компьютером. Студенты научатся передавать данные между платой DE2-70 и терминалом, работать с буферами FIFO, а также реализовывать обработку ввода-вывода с использованием прерываний и таймеров.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="цель-работы">Цель работы<a href="#цель-работы" class="hash-link" aria-label="Прямая ссылка на Цель работы" title="Прямая ссылка на Цель работы">​</a></h2>
<p>Изучение порта JTAG UART и практическое его использование для взаимодействия процессорной системы, реализованной на стенде, с оператором за инструментальным компьютером.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="планируемые-результаты-обучения">Планируемые результаты обучения<a href="#планируемые-результаты-обучения" class="hash-link" aria-label="Прямая ссылка на Планируемые результаты обучения" title="Прямая ссылка на Планируемые результаты обучения">​</a></h2>
<p>После выполнения этой работы студенты должны уметь:</p>
<ul>
<li>Вводить информацию в процессорную систему, используя клавиатуру инструментального компьютера;</li>
<li>Выводить информацию из процессорной системы в терминальное окно инструментального компьютера.</li>
<li>Выполнять ввод и вывод информации с использованием прерывания текущей программы</li>
<li>Использовать вложенные прерывания от таймера</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="исходные-файлы-лабораторной-работы">Исходные файлы лабораторной работы<a href="#исходные-файлы-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Исходные файлы лабораторной работы" title="Прямая ссылка на Исходные файлы лабораторной работы">​</a></h2>
<p>Программа, демонстрирующая использование JTAG UART порта в процессорной системе, является составной частью приложения AMP. Она доступна в разделе Sample program под именем JTAG UART.s.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="подготовка-к-лабораторной-работе">Подготовка к лабораторной работе<a href="#подготовка-к-лабораторной-работе" class="hash-link" aria-label="Прямая ссылка на Подготовка к лабораторной работе" title="Прямая ссылка на Подготовка к лабораторной работе">​</a></h2>
<p>Для выполнения лабораторной работы необходимо изучить по материалам лекций и предложенной литературе:</p>
<ol>
<li>Организацию обмена данными между стендом и инструментальным компьютером.</li>
<li>Принцип работы и назначение регистров и отдельных полей JTAG UART порта. Эта информация содержится в описании процессорной системы «DE2-70 Media Computer» [9]. Включите ее в отчет.</li>
<li>Реализацию прерываний в процессорной системе с процессором NIOSII[8]. Используемые для этого регистры процессора и портов ввода – вывода.</li>
<li>Особенности использования вложенных прерываний.</li>
<li>Уясните принцип действия программы, работающей с интерфейсом JTAG из файла JTAG UART.s. Включите ее в отчет.</li>
<li>Уясните содержимое фрагмента программы TEST_DE2_70_Media_Computer из листинга 9 приложения и включите его в отчет.</li>
<li>Уясните пункты задания, выполняемого в текущей лабораторной работе, и подготовьте программные заготовки для их выполнения.</li>
</ol>
<p>В лабораторной работе ASCII-коды символов, введенных в терминальном окне AMP, отправляются в процессорную систему, реализованную на стенде с использованием UART JTAG интерфейса, отображаются на светодиодах и 7-сегментных индикаторах, затем отправляются обратно в инструментальный компьютер, и отображаются в терминальном окне AMP.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="материалы-для-подготовки">Материалы для подготовки<a href="#материалы-для-подготовки" class="hash-link" aria-label="Прямая ссылка на Материалы для подготовки" title="Прямая ссылка на Материалы для подготовки">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="что-такое-jtag">Что такое JTAG<a href="#что-такое-jtag" class="hash-link" aria-label="Прямая ссылка на Что такое JTAG" title="Прямая ссылка на Что такое JTAG">​</a></h3>
<p>Когда речь идет о JTAG, прежде всего, подразумевается стандарт: IEEE 1149.1-2001 Test Access Port and Boundary-Scan Architecture (Стандарт IEEE 1149.1-2001 Порт тестового доступа и Архитектура Граничного сканирования).</p>
<p>С ростом степени интеграции БИС, плотности монтажа и появлением многослойных печатных плат, методы диагностики, основанные на подключении к контрольным точкам платы и выводам микросхем, становятся все более сложными в использовании и неэффективными.</p>
<p>В начале 1985 года объединенными усилиями нескольких европейских компаний была создана группа для разработки решения проблем тестирования интегральных схем, цифровых устройств и систем. Эта группа получила имя: Joint European Test Action Group (JETAG). Позднее, в 1988 году к ней присоединились представители североамериканских компаний, и название было изменено на Joint Test Action Group (JTAG).</p>
<p>Результатом работы этой группы явился принятый в 1990 году стандарт IEEE Std.1149.1 и его усовершенствованная версия: стандарт IEEE Std.1149.1a (1993 год).</p>
<p>В основу стандарта положена идея внедрение в компоненты цифрового устройства средств, обеспечивающих унифицированный подход к решению следующих задач:</p>
<ul>
<li>Тестирование связей между интегральными схемами, после того, как они были смонтированы на печатной плате или другой основе;</li>
<li>Наблюдение за работой компонент без вмешательства в их нормальную работу, или непосредственное управление одним или более компонентом;</li>
<li>Обеспечение стандартизованного доступа к произвольным средствам самотестирования, встраиваемым в БИС;</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="порт-тестового-доступа-tap-test-access-port">Порт тестового доступа: TAP (Test Access Port)<a href="#порт-тестового-доступа-tap-test-access-port" class="hash-link" aria-label="Прямая ссылка на Порт тестового доступа: TAP (Test Access Port)" title="Прямая ссылка на Порт тестового доступа: TAP (Test Access Port)">​</a></h3>
<p>Когда мы говорим о передаче информации через JTAG, то мы подразумеваем обмен между ведущим устройством и встроенными в БИС средствами тестирования. Для этой цели был разработан TAP (Test Access Port)—Порт Тестового Доступа.</p>
<p>Аппаратная поддержка поддержки JTAG реализуется достаточно простыми схемами. TAP требует 4-х внешних контактов:</p>
<ul>
<li><strong>TDI (Test Data Input)</strong> — контакт для получения последовательных данных. На этот контакт последовательно, бит-за-битом подаются данные, которые затем интерпретируются схемой управления;</li>
<li><strong>TDO (Test Data Output)</strong> — контакт вывода последовательных данных. С этого контакта ведущее устройство последовательно считывает данные из БИС (например результат тестовых операций);</li>
<li><strong>TCK (Test Clock Input)</strong> — контакт сигнала синхронизации обмена;</li>
<li><strong>TMS (Test Mode Select)</strong> — этот контакт управляет состоянием внутреннего автомата TAP. В частности, с помощью этого контакта определяется что грузиться: команда или данные, а также определяется начало и конец загрузки;</li>
</ul>
<p>Следующий контакт не является обязательным для реализации:</p>
<ul>
<li><strong>TRST (Test ReSeT)</strong> — сброс в начальное состояние контроллера внутреннего автомата TAP</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jtag-порт-в-процессорной-системе">JTAG порт в процессорной системе<a href="#jtag-порт-в-процессорной-системе" class="hash-link" aria-label="Прямая ссылка на JTAG порт в процессорной системе" title="Прямая ссылка на JTAG порт в процессорной системе">​</a></h3>
<p>JTAG порт реализует соединение между стендом DE2-70 и инструментальным компьютером. Это соединение используется пакетом Quartus II для загрузки файла программирования в кристалл ПЛИС на плате, посредством чего создаётся процессорная система. Соединение также используется приложением AMP для загрузки программы в процессорную систему и управления её выполнением.</p>
<p>Порт JTAG включает универсальный асинхронный приемопередатчик (UART), который может использоваться для передачи символьных данных между инструментальным компьютером и программой, выполняемой в процессорной системе на стенде. Причем обмен между процессором Nios II и портом JTAG осуществляется параллельным кодом, а между JTAG и инструментальным компьютером последовательным кодом.</p>
<p>Если на инструментальном компьютере используется приложение AMP, то для передачи символьных данных в порт JTAG их следует печатать в терминальном окне приложения, предварительно поместив туда курсор с помощью мыши. Вывод символов в порт JTAG из процессорной системы Nios II будет приводить к отображению их в терминальном окне приложения АМР, выполняющегося на инструментальном компьютере.</p>
<p>Программный интерфейс JTAG порта состоит из двух 32-битных регистров:</p>
<ul>
<li>Регистр, доступный по адресу <strong>0x10001000</strong>, является регистром данных.</li>
<li>Регистр, доступный по адресу <strong>0x10001004</strong>, является регистром управления.</li>
</ul>
<p>Когда символьные данные из инструментального компьютера посылаются в JTAG UART, то они сохраняются в 64-символьном буфере FIFO. Число символов, хранимых в настоящий момент в буфере FIFO, указывается в поле <strong>RAVAIL</strong>, которое представлено разрядами 31-16 регистра данных. Если буфер FIFO переполнен, то дополнительно посылаемые в него данные со стороны инструментального компьютера будут потеряны. Если данные присутствуют в буфере FIFO, то величина RAVAIL будет больше нуля и 15-ый бит регистра данных <strong>RVALID</strong> будет равен 1.</p>
<p>Чтобы осуществить чтение символа из вершины буфера FIFO, необходимо прочитать содержимое регистра данных JTAG порта. При этом младшие разряды 7-0 регистра данных будут содержать вводимый символ. Поле RAVAIL при выполнении чтения автоматически уменьшится на единицу.</p>
<p>Контроллер JTAG UART также включает 64-символьный буфер FIFO, который хранит данные, ожидающие передачи в инструментальный компьютер. Символьные данные загружаются в этот буфер посредством записи в разряды 7-0 регистра данных. Размер доступного пространства в текущий момент времени в записываемом буфере FIFO указывается в разрядах 31-16 регистра управления. Это поле <strong>WSPACE</strong>. Если буфер FIFO полон, то все данные, в последующем записываемые в регистр данных, будут теряться.</p>
<p>Бит 10 в регистре управления, названный <strong>AC</strong>, устанавливается в 1, если к JTAG UART был доступ со стороны инструментального компьютера. Этот бит может быть использован для проверки наличия установленного соединения инструментального компьютера с платой DE2-70. Бит АС может быть вновь очищен посредством записи в него 1.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="прерывания-от-jtag-uart">Прерывания от JTAG UART<a href="#прерывания-от-jtag-uart" class="hash-link" aria-label="Прямая ссылка на Прерывания от JTAG UART" title="Прямая ссылка на Прерывания от JTAG UART">​</a></h3>
<p>Биты <strong>RE</strong> и <strong>WE</strong> регистра управления используются для того, чтобы разрешить прерывания процессора, связанные с приемом или передачей символов. Если прерывание разрешено, то оно будет происходить, когда RAVAIL для буфера FIFO принимаемых данных превысит 7, или WSPACE для буфера FIFO отправляемых данных станет меньше 7. Произошедшие прерывания будут сопровождаться установкой в 1 разрядов <strong>RI</strong> и <strong>WI</strong> в регистре управления, которые потом могут быть очищены путем чтения или записи данных из/в JTAG UART.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="чеклист-выполнения">Чеклист выполнения<a href="#чеклист-выполнения" class="hash-link" aria-label="Прямая ссылка на Чеклист выполнения" title="Прямая ссылка на Чеклист выполнения">​</a></h2>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Изучена документация по JTAG UART и системе команд NIOS II.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Написана и отлажена программа вывода символа в JTAG UART с проверкой WSPACE.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Экспериментально определен размер буфера FIFO на вывод.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализован многократный вывод символов с задержкой для переполнения буфера.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Написана процедура вывода текстовой строки (null-terminated string).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Написана и отлажена подпрограмма чтения из JTAG UART с проверкой RVALID.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Экспериментально определен размер буфера FIFO на ввод.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализован вывод кодов символов на светодиоды/индикаторы.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализован ввод строки в память с эхо-печатью.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализован ввод строки в режиме прерывания от JTAG UART.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализован периодический вывод символов с использованием таймера.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализовано совместное использование прерываний от JTAG UART и таймера.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализован &quot;предохранительный клапан&quot; в обработчике прерывания по записи.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="порядок-выполнения-лабораторной-работы">Порядок выполнения лабораторной работы<a href="#порядок-выполнения-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Порядок выполнения лабораторной работы" title="Прямая ссылка на Порядок выполнения лабораторной работы">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-1-запись-в-uart-jtag-вывод-информации">Часть 1. Запись в UART JTAG (вывод информации)<a href="#часть-1-запись-в-uart-jtag-вывод-информации" class="hash-link" aria-label="Прямая ссылка на Часть 1. Запись в UART JTAG (вывод информации)" title="Прямая ссылка на Часть 1. Запись в UART JTAG (вывод информации)">​</a></h3>
<ol>
<li>
<p>Напишите программу, которая записывает символ z в порт UART JTAG. Предусмотрите в программе анализ поля WSPACE в регистре управления UART, отражающего наличие свободного места в буфере FIFO для записываемых символов. Реализуйте выход из программы, если свободного места в буфере нет.</p>
</li>
<li>
<p>Отладьте программу. По содержимому поля WSPACE определите размер буфера FIFO. Используйте для этого вкладку Memory приложения AMP. Измените символ z на другой символ.</p>
</li>
<li>
<p>Модифицируйте программу из предыдущего пункта таким образом, чтобы символы выводились многократно. Реализуйте программную задержку в цикле вывода. Подберите задержку таким образом, чтобы происходили следующие события:</p>
<ul>
<li>Программа завершается по переполнению буфера FIFO, и при этом выводится в терминальное окно AMP минимальное количество символов. Подсчитайте количество выведенных символов. Сравните со значением, полученным в пункте 2.</li>
<li>Буфер FIFO никогда не переполняется, и программа реализует бесконечный цикл.</li>
<li>Буфер FIFO успевает вывести некоторое количество символов до того, как он переполнится.</li>
</ul>
<p>Запишите в отчет подобранные задержки.</p>
</li>
<li>
<p>Напишите программу, которая выводит в терминальное окно AMP некоторое сообщение. Сообщение разместите в сегменте данных программы. Для этого используйте директиву <code>.asciz</code> ассемблера. Программа должна анализировать выводимый байт, и если он равен нулю, то вывод должен прекращаться. Оформите эту программу в виде процедуры, которая в последующем может быть использована для вывода из процессорной системы различных сообщений. Параметром, передаваемым этой процедуре, является адрес текстовой строки в сегменте данных. В качестве тестового примера выведите свою фамилию, имя и отчество. Сделайте снимок на смартфон и поместите его в отчетные материалы.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-2-чтение-из-jtag-uart-ввод-информации">Часть 2. Чтение из JTAG UART (ввод информации)<a href="#часть-2-чтение-из-jtag-uart-ввод-информации" class="hash-link" aria-label="Прямая ссылка на Часть 2. Чтение из JTAG UART (ввод информации)" title="Прямая ссылка на Часть 2. Чтение из JTAG UART (ввод информации)">​</a></h3>
<ol>
<li>
<p>Напишите подпрограмму, которая выполняет чтение из порта UART JTAG. Подпрограмма должна анализировать бит RVALID в регистре данных UART. Если этот бит равен 1, считанные данные присутствовали в буфере FIFO и они достоверны. В противном случае, данных в буфере нет, и подпрограмма должна ожидать их появления. Принятый из UART JTAG символ, основная программа должна отобразить на светодиодах и двух 7-сегментных индикаторах, записать обратно в JTAG и так далее в цикле. Отладьте подпрограмму.</p>
</li>
<li>
<p>С помощью AMP скомпилируйте программу из предыдущего пункта и загрузите в память. Поставьте контрольную точку в программе после приема первого символа из UART JTAG. Проанализируйте поле RAVAIL. Запишите в отчет. Обратите внимание! Для анализа поля RAVAIL потребуется включить опцию Query all devices и нажать кнопку Refresh. Учтите, что при этом произойдет чтение регистра данных UART JTAG и, следовательно, удаление символа из вершины буфера FIFO и уменьшение поля RAVAIL на 1. Повторите эксперимент, но предварительно напечатайте в терминальном окне AMP несколько символов с клавиатуры. Рекомендуется набирать осмысленное сообщение, чтобы в последующем можно было бы проверить правильность его вывода в терминальное окно. Проанализируйте поле RAVAIL. Отключите опцию Query all devices, уберите контрольную точку и продолжите выполнение программы. Сравните количество выведенных символов в терминальном окне AMP с содержимым поля RAVAIL. Повторите эксперимент. Экспериментально определите размер буфера FIFO для читаемых данных.</p>
</li>
<li>
<p>Модифицируйте программу таким образом, чтобы коды печатаемых на клавиатуре символов дополнительно отображались на светодиодах и двух HEX индикаторах. Составьте таблицу кодов ASCII для десяти цифр, нескольких букв вашей фамилии. Получите коды символов Enter, Backspace. Получите коды ASCII для одной и той же клавиши прописными и заглавными буквами, в английской и русской раскладке.</p>
</li>
<li>
<p>Модифицируйте подпрограмму чтения из порта UART JTAG таким образом, чтобы ASCII-коды выводимых символов записывались в память побайтно. Ввод должен завершаться при получении символа Enter. В этом случае в конец строки должен быть добавлен нулевой байт, означающий конец строки. Подпрограмма в последующем будет полезна для реализации ввода информации в процессорную систему с клавиатуры инструментального компьютера. Отправьте сохраненную строку в UART JTAG порт, используя подпрограмму, написанную в пункте 7 первой части.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-3-ввод-из-uart-jtag-в-режиме-прерывания">Часть 3. Ввод из UART JTAG в режиме прерывания<a href="#часть-3-ввод-из-uart-jtag-в-режиме-прерывания" class="hash-link" aria-label="Прямая ссылка на Часть 3. Ввод из UART JTAG в режиме прерывания" title="Прямая ссылка на Часть 3. Ввод из UART JTAG в режиме прерывания">​</a></h3>
<ol>
<li>
<p>Модифицируйте программу таким образом, чтобы ввод текстовой строки из инструментального компьютера осуществлялся в режиме прерывания. Для этого основная программа разрешает прерывания по чтению от UART JTAG и выполняет вывод строки с Вашей фамилией, именем и отчеством на дисплей LCD в режиме бегущей строки. Ввод текста в терминальном окне приводит к прерыванию основной программы, и обработчик прерывания далее осуществляет ввод строки в ОП и вывод в UART JTAG всей строки, пока не обнаружит символ конца строки. В это время вывод бегущей строки на LCD дисплей должен остановиться.</p>
</li>
<li>
<p>Модифицируйте программу таким образом, чтобы после ввода каждого символа обработчик прерывания возвращал управление основной программе. Визуально наблюдайте правильность работы программы.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-4-ввод-из-jtag-uart-в-режиме-прерывания-с-использованием-вложенного-прерывания-от-таймера">Часть 4. Ввод из JTAG UART в режиме прерывания с использованием вложенного прерывания от таймера<a href="#часть-4-ввод-из-jtag-uart-в-режиме-прерывания-с-использованием-вложенного-прерывания-от-таймера" class="hash-link" aria-label="Прямая ссылка на Часть 4. Ввод из JTAG UART в режиме прерывания с использованием вложенного прерывания от таймера" title="Прямая ссылка на Часть 4. Ввод из JTAG UART в режиме прерывания с использованием вложенного прерывания от таймера">​</a></h3>
<ol>
<li>
<p>Модифицируйте программу из предыдущей части таким образом, чтобы реализовать вывод символов в терминальном окне AMP следующим образом. Набранный на клавиатуре символ выводится в терминальном окне AMP каждые 500мс.</p>
</li>
<li>
<p>Модифицируйте программу из предыдущей части таким образом, чтобы основная программа разрешила прерывания по чтению от UART JTAG и выводила бегущую строку на LCD. При нажатии клавиши клавиатуры инструментального компьютера формируется прерывание основной программы. Обработчик прерывания UART JTAG разрешает прерывания от таймера каждые 500 мс и возвращает управление основной программе. Обработчик прерывания от таймера выводит символ в терминальное окно AMP каждые 500 мс, причем, если клавиша не нажата, повторяется вывод последнего набранного символа.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-5-вывод-из-процессорной-системы-в-jtag-uart-с-использованием-вложенного-прерывания">Часть 5. Вывод из процессорной системы в JTAG UART с использованием вложенного прерывания<a href="#часть-5-вывод-из-процессорной-системы-в-jtag-uart-с-использованием-вложенного-прерывания" class="hash-link" aria-label="Прямая ссылка на Часть 5. Вывод из процессорной системы в JTAG UART с использованием вложенного прерывания" title="Прямая ссылка на Часть 5. Вывод из процессорной системы в JTAG UART с использованием вложенного прерывания">​</a></h3>
<p>Экспериментально определите при каком условии формируется прерывание процессорной системы при выполнении вывода символьной информации в терминальное окно инструментального компьютера. Для этого в основной программе разрешите прерывания по записи от JTAG UART. Обработчик прерывания должен вывести на экран LCD предупреждающее сообщение, проверить, освободился ли буфер FIFO, и если да, вернуть управление основной программе. Таким образом, обработчик прерывания будет срабатывать как предохранительный клапан, принудительно приостанавливая процесс дальнейшего заполнения символьной информацией буфера FIFO, позволяя тем самым в это время его освободить.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="отчетные-материалы">Отчетные материалы<a href="#отчетные-материалы" class="hash-link" aria-label="Прямая ссылка на Отчетные материалы" title="Прямая ссылка на Отчетные материалы">​</a></h2>
<p>Отчетные материалы должны содержать:</p>
<ol>
<li>Цель лабораторной работы.</li>
<li>Материалы, связанные с подготовкой к работе, включая теоретическую часть.</li>
<li>Фрагменты программ JTAG UART.s и TEST_DE2_70_Media_Computer.</li>
<li>Информацию по выполнению каждого пункта задания. Причем в отчете должны содержаться выполняемые Вами действия, наблюдаемые результаты, и Ваши объяснения.</li>
<li>Написанные Вами фрагменты программ.</li>
<li>Краткое заключение.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Прямая ссылка на FAQ" title="Прямая ссылка на FAQ">​</a></h2>
<p><strong>Q: Что такое JTAG UART?</strong>
A: Это компонент, который обеспечивает последовательный интерфейс связи (UART) между процессорной системой на ПЛИС и хост-компьютером через кабель JTAG. Это позволяет использовать терминал на компьютере для ввода/вывода данных.</p>
<p><strong>Q: Зачем проверять биты RVALID и поле WSPACE?</strong>
A: <strong>RVALID</strong> указывает, есть ли действительные данные в буфере приема (FIFO). <strong>WSPACE</strong> показывает количество свободного места в буфере передачи. Без проверки этих полей можно прочитать мусор или потерять передаваемые данные при переполнении буфера.</p>
<p><strong>Q: Как работают прерывания в JTAG UART?</strong>
A: Прерывания могут генерироваться при наличии данных для чтения (бит <strong>RE</strong> - Read Interrupt Enable) или при наличии места для записи (бит <strong>WE</strong> - Write Interrupt Enable). Это позволяет процессору не тратить время на постоянный опрос регистров (поллинг), а реагировать только на события.</p>
<p><strong>Q: Почему важно использовать вложенные прерывания?</strong>
A: Вложенные прерывания позволяют системе обрабатывать более приоритетные события (например, от таймера), даже если она уже занята обработкой менее приоритетного прерывания (например, ввода пользователя), что повышает отзывчивость системы реального времени.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="дополнительные-материалы">Дополнительные материалы<a href="#дополнительные-материалы" class="hash-link" aria-label="Прямая ссылка на Дополнительные материалы" title="Прямая ссылка на Дополнительные материалы">​</a></h2>
<ul>
<li><a href="https://www.terasic.com.tw/cgi-bin/page/archive.pl?Language=English&amp;CategoryNo=53&amp;No=226&amp;PartNo=4" target="_blank" rel="noopener noreferrer">DE2-70 User Manual</a></li>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/683472/current/nios-ii-processor-reference-guide.html" target="_blank" rel="noopener noreferrer">Nios II Processor Reference Guide</a></li>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/683130/21-1/jtag-uart-core.html" target="_blank" rel="noopener noreferrer">Embedded Peripherals IP User Guide (JTAG UART Core)</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="приложение">Приложение<a href="#приложение" class="hash-link" aria-label="Прямая ссылка на Приложение" title="Прямая ссылка на Приложение">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="листинг-8-текст-программы-jtag-uarts">Листинг 8. Текст программы JTAG UART.s<a href="#листинг-8-текст-программы-jtag-uarts" class="hash-link" aria-label="Прямая ссылка на Листинг 8. Текст программы JTAG UART.s" title="Прямая ссылка на Листинг 8. Текст программы JTAG UART.s">​</a></h3>
<div class="language-asm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-asm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/****************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Программа выполняет следующее: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *       1. отправляет символьную строку  из текстовой строки в JTAG UART</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *       2. считывает данные из JTAG UART</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *       3. отправляет считанные данные обратно в JTAG UART</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">********************************************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text									</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.global	_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movia 	sp, 0x07FFFFFC			/* Определяем адрес вершины стека */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movia		r6, 0x10001000			</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movia		r8, TEXT_STRING			/* адрес текстовой строки в r8 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldb		r5, 0(r8)			/* из текстовой строки в r5*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">call		PUT_JTAG                /* вызываем процедуру, которая помещает символ в JTAG */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">addi		r8, r8, 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">br					/* переходим на вывод очередного символа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET_JTAG:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldwio		r4, 0(r6)		/*читаем регистр управления JTAG UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andi		r8, r4, 0x8000	           /*проверяем есть ли новые данные*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beq		r8, r0, GET_JTAG	/*если данных нет, то ожидаем их появления*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andi		r5, r4, 0x00ff	           /*получаем данные*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">call		PUT_JTAG		/*отправляем символ обратно в JTAG UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">call		GET_JTAG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.end		</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">									</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/********************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* Подпрограмма, которая выводит символы в JTAG UART</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*		r5	= выводимый символ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*		r6	= JTAG UART базовый адрес</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">********************************************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.global	PUT_JTAG			</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PUT_JTAG:			</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/* сохраняем используемые регистры */	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subi		sp, sp, 4				/* резервирум место в стеке*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stw		r4, 0(sp)				/* сохраняем r4 в стеке */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldwio		r4, 4(r6)		/* читаем регистр управления JTAG UART */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andhi		r4, r4, 0xffff	             /* проверяем есть ли место для записи в буфере UART */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beq		r4, r0, KONEC	/* если места нет, то переполнение буфера */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stwio		r5, 0(r6)				/* отправляем символ в UART */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OVERFLOW:		</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/* восстанавливаем содержимое r4 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldw		r4, 0(sp)	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">addi		sp, sp, 4	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret				</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.data			</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEXT_STRING:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.asciz	&quot;\nJTAG UART example code\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="листинг-9-фрагмент-программы-test_de2_70_media_computer">Листинг 9. Фрагмент программы TEST_DE2_70_Media_Computer<a href="#листинг-9-фрагмент-программы-test_de2_70_media_computer" class="hash-link" aria-label="Прямая ссылка на Листинг 9. Фрагмент программы TEST_DE2_70_Media_Computer" title="Прямая ссылка на Листинг 9. Фрагмент программы TEST_DE2_70_Media_Computer">​</a></h3>
<div class="language-asm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-asm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/****************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Процедура анализирует, имеются ли данные в буфере чтения JTAG порта.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Если есть, то данные отправляются обратно в JTAG порт и дополнительно в </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * COM-порт. Если новых данных нет, то выполняется проверка, имеются ли данные в буфере чтения com-порта. Если данные есть, то они отправляются обратно в com-порт и дополнительно в JTAG порт. А если нет, то происходит выход из процедуры.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">********************************************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.global UPDATE_UARTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UPDATE_UARTS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/* сохраняем регистры в стеке */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subi		sp, sp, 28		/* резервируем область памяти в стеке*/ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stw		ra, 0(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stw		fp, 4(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stw 		r15, 8(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stw 		r16, 12(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stw 		r17, 16(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stw 		r18, 20(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stw 		r19, 24(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">addi		fp, sp, 28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movia	 r15, JTAG_UART_BASE       /* помещаем в r15 адрес JTAG UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movia	 r19, UART_BASE                  /* помещаем в r19 адрес com-порта*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET_CHAR:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldwio   r17, 0(r15)		/* считываем слово из регистра данных JTAG UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andi    r18, r17, 0x8000			/* проверяем бит RVALID*/           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beq     r18, r0, GET_CHAR_UART		/* если данных нет в буфере, то переходим на GET_CHAR_UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andi    r16, r17, 0x00ff             	/* выделяем байт данных из считанного из JTAG UART порта слова*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PUT_CHAR:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldwio   r17, 4(r15)		/* считываем слово из регистра управления JTAG UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andhi   r17, r17, 0xffff			/* выделяем значение поля workspace*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beq     r17, r0, PUT_CHAR_UART	        /* если свободного места в буфере нет, то переходим на PUT_CHAR_UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stwio   r16, 0(r15)			/* отправляем символ обратно в JTAG UART*/  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PUT_CHAR_UART:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldwio   r17, 4(r19)		/* считываем слово из регистра управления com-порта*/	 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andhi   r17, r17, 0xffff			/* выделяем значение поля workspace*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beq     r17, r0, GET_CHAR_UART	        /* если свободного места нет в буфере, то переходим на GET_CHAR_UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stwio   r16, 0(r19)				/* отправляем символ в com-порт*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET_CHAR_UART:                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldwio   r17, 0(r19)			/* считываем слово из регистра данных com-порта*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andhi   r18, r17, 0xFFFF	                /* выделяем значение поля RAVAIL*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beq     r18, r0, NO_CHAR	      /* если новых данных нет, то переходим на NO_CHAR*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andi    r16, r17, 0x00ff                     /* выделяем байт данных из считанного из com-порта слова*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldwio   r17, 4(r19)		/* считываем слово из регистра управления com-порта*/	 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andhi   r17, r17, 0xffff			/* выделяем значение поля workspace*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beq     r17, r0, PUT_CHAR_JTAG	        /* если свободного места нет в буфере, то переходим на PUT_CHAR_JTAG*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stwio   r16, 0(r19)				/* отправляем символ в com-порт*/	 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PUT_CHAR_JTAG:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldwio   r17, 4(r15)				/* считываем слово из регистра управления JTAG UART*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">andhi   r17, r17, 0xffff		        /* выделяем значение поля workspace*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beq     r17, r0, NO_CHAR	                /* если свободного места нет в буфере, то переходим на NO_CHAR*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stwio   r16, 0(r15)				/* отправляем символ в JTAG UART*/	 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NO_CHAR:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/* извлекаем из стека регистры */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldw		ra, 0(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldw		fp, 4(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldw		r15, 8(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldw		r16, 12(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldw		r17, 16(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldw		r18, 20(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldw		r19, 24(sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">addi		sp, sp, 28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret                                     /* выполняем возврат из процедуры*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/efremovnv/docs/edit/main/website/docs/computer-organization/lab7.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Отредактировать эту страницу</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Последнее обновление<!-- --> <b><time datetime="2025-11-22T17:49:14.000Z" itemprop="dateModified">22 нояб. 2025 г.</time></b></span></div></div></footer></article><div class="margin-top--lg"><button class="button button--secondary button--sm">📄 Скачать PDF</button></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/labs/peripheral-devices/lab4"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">Лабораторная работа №4</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/labs/computer-organization/lab8"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">Лабораторная работа №8</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#контекст" class="table-of-contents__link toc-highlight">Контекст</a></li><li><a href="#цель-работы" class="table-of-contents__link toc-highlight">Цель работы</a></li><li><a href="#планируемые-результаты-обучения" class="table-of-contents__link toc-highlight">Планируемые результаты обучения</a></li><li><a href="#исходные-файлы-лабораторной-работы" class="table-of-contents__link toc-highlight">Исходные файлы лабораторной работы</a></li><li><a href="#подготовка-к-лабораторной-работе" class="table-of-contents__link toc-highlight">Подготовка к лабораторной работе</a></li><li><a href="#материалы-для-подготовки" class="table-of-contents__link toc-highlight">Материалы для подготовки</a><ul><li><a href="#что-такое-jtag" class="table-of-contents__link toc-highlight">Что такое JTAG</a></li><li><a href="#порт-тестового-доступа-tap-test-access-port" class="table-of-contents__link toc-highlight">Порт тестового доступа: TAP (Test Access Port)</a></li><li><a href="#jtag-порт-в-процессорной-системе" class="table-of-contents__link toc-highlight">JTAG порт в процессорной системе</a></li><li><a href="#прерывания-от-jtag-uart" class="table-of-contents__link toc-highlight">Прерывания от JTAG UART</a></li></ul></li><li><a href="#чеклист-выполнения" class="table-of-contents__link toc-highlight">Чеклист выполнения</a></li><li><a href="#порядок-выполнения-лабораторной-работы" class="table-of-contents__link toc-highlight">Порядок выполнения лабораторной работы</a><ul><li><a href="#часть-1-запись-в-uart-jtag-вывод-информации" class="table-of-contents__link toc-highlight">Часть 1. Запись в UART JTAG (вывод информации)</a></li><li><a href="#часть-2-чтение-из-jtag-uart-ввод-информации" class="table-of-contents__link toc-highlight">Часть 2. Чтение из JTAG UART (ввод информации)</a></li><li><a href="#часть-3-ввод-из-uart-jtag-в-режиме-прерывания" class="table-of-contents__link toc-highlight">Часть 3. Ввод из UART JTAG в режиме прерывания</a></li><li><a href="#часть-4-ввод-из-jtag-uart-в-режиме-прерывания-с-использованием-вложенного-прерывания-от-таймера" class="table-of-contents__link toc-highlight">Часть 4. Ввод из JTAG UART в режиме прерывания с использованием вложенного прерывания от таймера</a></li><li><a href="#часть-5-вывод-из-процессорной-системы-в-jtag-uart-с-использованием-вложенного-прерывания" class="table-of-contents__link toc-highlight">Часть 5. Вывод из процессорной системы в JTAG UART с использованием вложенного прерывания</a></li></ul></li><li><a href="#отчетные-материалы" class="table-of-contents__link toc-highlight">Отчетные материалы</a></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li><li><a href="#дополнительные-материалы" class="table-of-contents__link toc-highlight">Дополнительные материалы</a></li><li><a href="#приложение" class="table-of-contents__link toc-highlight">Приложение</a><ul><li><a href="#листинг-8-текст-программы-jtag-uarts" class="table-of-contents__link toc-highlight">Листинг 8. Текст программы JTAG UART.s</a></li><li><a href="#листинг-9-фрагмент-программы-test_de2_70_media_computer" class="table-of-contents__link toc-highlight">Листинг 9. Фрагмент программы TEST_DE2_70_Media_Computer</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">efremovnv</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Начало</a></li></ul></div><div class="col footer__col"><div class="footer__title">Ресурсы</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 efremovnv. Создано с помощью Docusaurus.</div></div></div></footer></div>
</body>
</html>