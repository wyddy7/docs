<!doctype html>
<html lang="ru-RU" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-peripheral-devices/lab4" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Лабораторная работа №4 | efremovnv</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" name="twitter:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" property="og:url" content="https://efremovnv.github.io/docs/labs/peripheral-devices/lab4"><meta data-rh="true" property="og:locale" content="ru_RU"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Лабораторная работа №4 | efremovnv"><meta data-rh="true" name="description" content="Страничный режим процессора X86."><meta data-rh="true" property="og:description" content="Страничный режим процессора X86."><link data-rh="true" rel="icon" href="/docs/img/logo2.svg"><link data-rh="true" rel="canonical" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab4"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab4" hreflang="ru-RU"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab4" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.b2f4074e.css">
<script src="/docs/assets/js/runtime~main.f7f1290e.js" defer="defer"></script>
<script src="/docs/assets/js/main.647d6c6e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/logo.svg"><link rel="preload" as="image" href="/docs/img/logo-dark.svg"><div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo-dark.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">efremovnv</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/labs/intro">Методички</a><a class="navbar__item navbar__link" href="/docs/labs/contributing">Контрибьюция</a><a class="navbar__item navbar__link" href="/docs/labs/links">Ссылки</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-label="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/labs/intro">Учебные материалы по организации ЭВМ и систем</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/labs/peripheral-devices/lab1">Периферийные устройства</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab1">Лабораторная работа №1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab2">Лабораторная работа №2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab3">Лабораторная работа №3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/labs/peripheral-devices/lab4">Лабораторная работа №4</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/computer-organization/lab7">Организация ЭВМ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/course-work/rp-op-design">Курсовая работа</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Периферийные устройства</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Лабораторная работа №4</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><header><h1>Лабораторная работа №4</h1></header>
<p>Страничный режим процессора X86.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="контекст">Контекст<a href="#контекст" class="hash-link" aria-label="Прямая ссылка на Контекст" title="Прямая ссылка на Контекст">​</a></h2>
<p>Данная лабораторная работа посвящена изучению страничной организации памяти в защищённом режиме процессора x86. Студенты познакомятся с механизмами преобразования виртуальных адресов в физические, структурой каталогов (PDE) и таблиц страниц (PTE), а также обработкой исключений страничного нарушения (#PF). Это ключевая тема для понимания работы современных операционных систем и механизмов изоляции памяти.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="сокращения">Сокращения<a href="#сокращения" class="hash-link" aria-label="Прямая ссылка на Сокращения" title="Прямая ссылка на Сокращения">​</a></h2>
<ul>
<li><strong>BIOS</strong> – Base Input/Output System – базовая система ввода/вывода</li>
<li><strong>WSL</strong> – Windows Subsystem for Linux – подсистема Windows для Linux</li>
<li><strong>MBR</strong> – Master Boot Record – главная загрузочная запись</li>
<li><strong>CHS</strong> – Cylinder-Head-Sector – цилиндр-головка-сектор</li>
<li><strong>GPT</strong> – GUID (Globally Unique Identifier) Partition Table – таблица разделов глобальных уникальных идентификаторов</li>
<li><strong>LBA</strong> – Logical Block Addressing – логическая блочная адресация</li>
<li><strong>AT&amp;T</strong> – American Telephone and Telegraph</li>
<li><strong>GDT</strong> – Global Descriptor Table – глобальная таблица дескрипторов</li>
<li><strong>LDT</strong> – Local Descriptor Table – локальная таблица дескрипторов</li>
<li><strong>GDTR</strong> – Global Descriptor Table Register – регистр глобальной таблицы дескрипторов</li>
<li><strong>IDT</strong> – Interrupt Descriptor Table – дескрипторная таблица прерываний</li>
<li><strong>IDTR</strong> – Interrupt Descriptor Table Register – регистр дескрипторной таблицы прерываний</li>
<li><strong>PIC</strong> – Programmable Interrupt Controller – программируемый контроллер прерываний</li>
<li><strong>PF</strong> – Page Fault – страничная ошибка</li>
<li><strong>PTE</strong> – Page Table Entries – записи таблицы страниц</li>
<li><strong>PDE</strong> – Page Directory Entries – записи каталога страниц</li>
<li><strong>PDBR</strong> – Page Directory Base Register – регистр базы каталога страниц</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="цель-работы">Цель работы<a href="#цель-работы" class="hash-link" aria-label="Прямая ссылка на Цель работы" title="Прямая ссылка на Цель работы">​</a></h2>
<p>Изучение механизма работы страничного режима и принципов реализации виртуальной памяти.</p>
<p>В процессе выполнения работы студенты:</p>
<ul>
<li>Разберутся в основах организации виртуальной памяти.</li>
<li>Изучат работу страничного режима процессора x86.</li>
<li>Проведут тестирование исключения #PF (Page Fault).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="необходимые-инструменты">Необходимые инструменты<a href="#необходимые-инструменты" class="hash-link" aria-label="Прямая ссылка на Необходимые инструменты" title="Прямая ссылка на Необходимые инструменты">​</a></h2>
<ul>
<li>Любой дистрибутив GNU/Linux: рекомендуется Ubuntu, также можно использовать виртуальную машину, например, WSL</li>
<li>Ассемблер: <code>as</code></li>
<li>Компоновщик: <code>ld</code></li>
<li>Утилиты для анализа объектных файлов: <code>objdump</code>, <code>readelf</code></li>
<li>Препроцессор: <code>cpp</code></li>
<li>Утилита для работы с дисками: <code>dd</code></li>
<li>Отладчик: <code>gdb</code></li>
<li>Эмулятор: <code>qemu</code></li>
<li>Утилиты для автоматизации сборки проектов: <code>make</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="исходные-файлы-лабораторной-работы">Исходные файлы лабораторной работы<a href="#исходные-файлы-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Исходные файлы лабораторной работы" title="Прямая ссылка на Исходные файлы лабораторной работы">​</a></h2>
<ul>
<li><strong>linker.ld</strong> — скрипт линковщика для основной программы</li>
<li><strong>Makefile</strong> — необходимый для автоматизированной сборки проекта</li>
<li><strong>lab4.S</strong> — программа с реализацией страничного режима</li>
<li><strong>gdt.h, idt.h, irq.h</strong> — заголовочные файлы с макросами и константами</li>
<li><strong>boot.S</strong> — код загрузчика</li>
<li><strong>Makefile</strong> — для автоматизированной сборки загрузчика</li>
<li><strong>linker.ld</strong> — для сборки загрузчика</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="материалы-для-подготовки-к-лабораторной-работе">Материалы для подготовки к лабораторной работе<a href="#материалы-для-подготовки-к-лабораторной-работе" class="hash-link" aria-label="Прямая ссылка на Материалы для подготовки к лабораторной работе" title="Прямая ссылка на Материалы для подготовки к лабораторной работе">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="страничная-организация-памяти">Страничная организация памяти<a href="#страничная-организация-памяти" class="hash-link" aria-label="Прямая ссылка на Страничная организация памяти" title="Прямая ссылка на Страничная организация памяти">​</a></h3>
<p>Механизм управления памятью возможно реализовать только в защищённом режиме. В этом режиме обращение к памяти процессор использует пару значений — селектор:смещение. Адрес указанный таким образом называется логическим адресом, т.к. смещение задаётся относительно начала сегмента, размещённого по любому адресу. С линейными адресами вы уже сталкивались, во 2 и 3 лабораторной работе, когда определяли дескрипторы и регистры IDTR и GDTR, задавая базовые адреса этих объектов. После вычисления линейного адреса процессор преобразует его в физический адрес, по которому и производит обращение к памяти.</p>
<p><strong>Зачем нужен физический адрес, если линейный адрес уже однозначно определяет доступ к памяти?</strong></p>
<p>Смысл в использовании линейных и физических адресов появляется, когда программа включает в процессоре механизм трансляции страниц. Страницей называется непрерывная область памяти фиксированного размера размером 4Кб. Всё адресное пространство можно разбить на страницы, получается 2^20 страниц, которые полностью покрывают 32-разрядное адресное пространство:</p>
<p><img decoding="async" loading="lazy" alt="1763723577665" src="data:image/png;base64,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" width="221" height="215" class="img_ev3q"></p>
<p>Адрес страницы памяти всегда кратен 4Кб (1000h байт), т.е. страница может начинаться только с адреса, у которого младшие 3 hex-разряда (или младшие 12 двоичных разрядов) равны нулю. Физическая память - эта та, которая реализована в компьютере в виде микросхем. Вся физическая память делится на физические страницы. Адресное пространство равно 4Гб и оно делится на логические страницы. Таким образом, логические страницы соответствуют физическим страницам или другими словами, логические страницы отображаются на физические страницы.</p>
<p>Страница имеет свой логический адрес, но может быть отображена на любой физический.</p>
<p>Логические страницы являются виртуальными объектами и каждая такая страница имеет два адреса:</p>
<ul>
<li><strong>линейный</strong> - тот, по которому она расположена в адресном пространстве процессора,</li>
<li><strong>физический</strong> - тот, на который она отображена в физической памяти компьютера.</li>
</ul>
<p>Если линейный адрес совпадает с физическим, то страница тождественно отображена.</p>
<p><img decoding="async" loading="lazy" alt="1763723626616" src="data:image/png;base64,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" width="635" height="289" class="img_ev3q"></p>
<p>Теперь очевидна необходимость в преобразовании линейного адреса в физический, т.к. заранее неизвестно, на какую физическую страницу памяти отображена данная логическая страница.</p>
<p><strong>Доступ к памяти через страницы работает по принципу:</strong></p>
<ul>
<li>выбор страницы – указываем процессору, какую именно страницу использовать (например, через её номер в таблице)</li>
<li>смещение внутри страницы – задаём 12-битное смещение (поскольку стандартный размер страницы – 4 КБ = 2¹² байт)</li>
</ul>
<p>Страничная организация памяти позволяет реализовать механизм виртуальной памяти на уровне процессора. В современных компьютерах объем физической памяти часто меньше 4 ГБ, но благодаря тому, что логическую страницу памяти можно отобразить не только на оперативную память, но и на дисковое пространство, фактически доступный объем памяти значительно увеличивается. При этом содержимое неактивных страниц может быть выгружено с диска обратно в ОЗУ по мере необходимости. Таким образом, общий объем используемой памяти ограничивается уже не размером оперативной памяти, а емкостью жесткого диска (или пропускной способностью сети в случае бездисковых систем, где хранение данных осуществляется удаленно).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="таблицы-и-каталоги-страниц">Таблицы и каталоги страниц<a href="#таблицы-и-каталоги-страниц" class="hash-link" aria-label="Прямая ссылка на Таблицы и каталоги страниц" title="Прямая ссылка на Таблицы и каталоги страниц">​</a></h3>
<p>В программе можно использовать любое количество страниц памяти, но все они должны быть явно определены. Таблицы страниц — массивы, размером 4 Кб, состоящие из 1024 элементов. Таблица страниц должна быть выравнена на границу 4Кб и она хранит описания 1024 страниц, что позволяет описать 4 Мегабайта адресного пространства (1024 страниц по 4Кб каждая). Таблицы страниц группируются в каталог страниц - массив, размером в 4Кб, также состоящий из 1024 элементов. Каждый такой элемент является указателем на таблицу страниц.</p>
<p>Программе совсем не обязательно определять все страницы, таблицы и элементы каталога. Достаточно определить только те, которые реально будут использоваться и динамически добавлять / убирать новые описания в процессе работы. Однако, обязательно нужно определить каталог страниц, а в нём - хотя бы один указатель. То же самое касается таблиц страниц - хотя бы одну с одним элементом.</p>
<p>Для доступа к памяти нужно задать 32-разрядную структуры данных: 10 бит - номер таблицы, ещё 10 - номер страницы в таблице и 12 - смещение внутри самой страницы. Процессор использует описания страниц автоматически. Для этого он преобразует линейные адреса по следующей схеме:</p>
<p><img decoding="async" loading="lazy" alt="1763723642189" src="data:image/png;base64,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" width="593" height="298" class="img_ev3q"></p>
<p>Страничная организация памяти существенно усиливает механизмы защиты ОС, поскольку:</p>
<ul>
<li>каждая программа работает со своими виртуальными адресами, не зная реальных физических адресов</li>
<li>программа не может напрямую обратиться к памяти ядра или других процессов, так как её виртуальные адреса отображаются только на разрешённые физические страницы</li>
<li>попытка доступа к запрещённой области вызовет исключение #PF (Page Fault), и ОС завершит процесс</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="таблица-страниц">Таблица страниц<a href="#таблица-страниц" class="hash-link" aria-label="Прямая ссылка на Таблица страниц" title="Прямая ссылка на Таблица страниц">​</a></h3>
<p>Таблица страниц (Page Table) состоит из 4-байтовых элементов (Entries). Эти элементы называются PTE (Page Table Entries) и представляют собой указатели на страницы.</p>
<p><img decoding="async" loading="lazy" alt="1763723653749" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlMAAAAqCAIAAAAYkUmfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAACVTSURBVHhe7V35X1NX2r83d8ketgAJIJvKoiCbLIoLdap12mk7n3Zm/shp++lMO7ZVp3UFEWQRUNxRBCGQBEgIWW6W94fvvM8cb0JIQrAy3u9P5z737MvznPOc55zDDwwM8Dyv0+l8Pl88HtfpdDabLR6Pcxyn0+mCwaAkSTzPcxo0fKgQBEFRlFgsJstyIpEQRTEcDm9tbXEcZzQaDQZDNBpVh0kKlZKSLURRDIVCwWCQ4ziTyaTX61MmTWD9m81mWZbT+88cPM+HQiFFUVAhiURCkqScy0UQRXFrayscDnMcZ7FYRFGMxWJqT2mhKAoqmed5g8EgSdIus8RCFMVgMKjT6QRBUP/bG4ii6Pf7o9Eoz/M2m43jODDnvYMqxUQikccKVAHNnUcRw/O8IAgbGxusLEuZf35gYEAQhNevXz958gSko0ePOp1OQRBmZ2fn5+c7OztLSkoURVEH1aDhA4AoipIk/fzzzxzHffnllz6fTxCEf//73+ThwoULEACqUKIo/vLLLwi1sbGRTGH9ZwKe5yVJunLlClE++eSTSCSScmDn4D8rWK3WH3/8kaXwPP+nP/3J7/ezxKyAKfivv/5KlPPnz0ej0cwzXFBQ8M9//pM+rVbrmTNnAoHAW55yhSRJwWDw9u3ber3+448/zle0acDzfCAQGBkZwafdbu/o6MiqQrKFTqdbW1ubmJjAZ1VVVVNTUywWy3uKPM/Lsjw/Pz87O9vY2FhTUxOJRNSesocgCC6Xa2ZmBp9NTU2VlZUpJ086URQ9Hs+TJ09qa2v7+/tra2sfPHiwvr7++vXr+fl51IU6kAYNHwZ4nud5HmIPn1arFWKvv7//1KlTHMdduXIFk3E2FMdxEHIUiYrC+s8QNpsNYuzUqVNI+vLly6qkWZD/c+fOnTt3bkf/WWFzc7O7u7u1tfXs2bOgXLhwYXNzU+0vG5jNZoi9gYGBM2fOcBx39epVs9ms9rcNeJ4nuXvmzJm2trbW1lYszXcPnufD4fDt27cxrcmtBbMCli8jIyOyLJ86daq7u9vtdo+NjRmNRrXXPEGn00Wj0YmJiYKCgt7e3qNHjy4sLDx58kSWZbXXXUOn071582Z2dhbuvNSnJEnr6+szMzOVlZW9vb11dXWPHj1aXV2VJEntleN00WjUZrN1dHTU19fH43HkwOPxPHz40Gq1chyXUmBq0PAhwGq1Xr16laVsbm729PT09vaazeYDBw6AqJodknRMQ8kBlEpNTU1NTQ3cmbAMEr15RCKRsNlsTqfTYrGAYjQad7kyoEzyPB8MBjs7O/v7+zNfWplMpt9++43juL6+vmAwaLfbzWZzXnSDPM9bLJabN2/iMxQKqX3sARKJRDQa7ejoOHnyJHFmnud3WclpAA1he3t7R0dHUVFRZWUltMd57zyCIGxtbU1PTxcUFHAcly8NPEkru93ucDjsdnsa+aXDiHI4HH6//86dO3Nzc7W1tTU1NT09PXV1dWrvGjR8SICc++STT4gSj8etVqvFYonH42tra0T8b5j/Xw9dvHgxDSUHUCqkj0kPv99/+vRpjuN+/fVXWkvtRhupQiwWs1gsly5d4jju4sWLOehvVSAOe+3atdHR0cnJyaxWqBR8eHh4dHT0xo0bOp0uLyornud9Ph/HceXl5WCYeYk2E9jtdlmWh4aGRkZGjEZjW1vbXstdu93O83w8Hl9ZWcFCKu+yFlvdx48fP3LkCGS82keuQB+IRqOKokCgbie2/9N+0WjUZDJ1dnZWVVW9fPnS7/c7HI7tpKUGDR8ISM6xRFhPCIIA7eX58+fBFgnxeNxms7FqumRKDvD5fH/84x85jrt58+atW7fUv5NgsVjgjbSj169fV5VlN+B5ntSbu1/wsRzw5MmTWOj8/PPPmWc4EAj09/d3dHS0trb29fVFo9HLly/vss5RTL1ef+PGDY7jGhoasAwKhULbsdT8Aiu/rq6u9vb2YDA4PT1tMBjUnvKKaDQqSdLq6urk5KTdbm9oaMjLDpwKPM/b7fbd95mcocOwdLvdoihWV1c7HA4UPo8rUA0a9i9isZhqCgibl8uXL3Mc9+mnn+p0umSVWnKoZEoO2NjY6Ozs7Orq+uijj9T/kkD2h6x2NI9GiVarFfuIFy9eXF9fV//eBWpqaqqrq+HOanWlKEpRUVF1dXVuwXcETTgmJyf3br+NhdfrjcViTqcTqnVYlqo95RWyLMPIxW639/X1bWcbuXvshakOIsQIFUUxzYJSJ4qiz+ebmJh48eLF8vKyy+Wi7rJdGA0aPljA/hA2L8ePH3e5XGtra3vNjACr1To0NDQ+Pm6z2SjFNIOU1Y6+fv1aRdw9KA8mkylNNjIHRZJbho1G48jIyG+//QYDPRAzD74dEolEKBTq6elpb2/v7u4GESswtde8gud5URTHx8eHh4c9Hs/CwgLHcXq9fvclSgOdTreysjI6OspxXH19/cLCwl7s86mQl84DoE96PB6Xy+XxeNJM9YTq6mqTySSK4vPnzxcWFnw+35EjR8rKyhKJRCAQWFlZqaioMJlMe1rdGjS8z9Dr9Y8fP+Y4rrGxUZbln376CfQ3b94sLS0tLi4eO3YMR9C2C4W/yZSsoChKfX393Nzcy5cv5+bmYE6Zhv9GIpHDhw+/ePHi1atXr169wqmGfNk6YnGA4hw+fDiH4iSDCjg/Pw/RdeHChcy3taLRaFVVFcIuLCwIgnD+/PnMg6eH0Wi0WCxFRUWPHz82Go0NDQ15KXJ6JBKJ0tLS+fn5hYWF5eXlkpKSzs7OvdA9AtBeDA8P43NxcXF5edloNJaUlOxeXZEMnU6nKMrCwkJpaWlRUdHuk4jH4yaTyWQyQZatra01NjY6nc6U+kueTrK73W7Y9tjtdqxwIfzMZvNey3wNGt5n4NR2IpEwGo04YhUOh3mex4gCT0yeGsJAkd0DS6ZkC0mSNjc3sbtms9mMRmPKUU2QJMnv98M8MhP/WYHn+a2tLUEQ9Hp9bsVJhiRJGxsbqKXCwkJZlrNiiLBrh7QrKiqSJCmr4DsCW5t6vX4v7D5SQpIkr9cLaVdSUpJStZ5frK+v43gDClhYWIibCtT+8gGIGJPJlC+tyXayTO2P4/jz58/DRYce2EProijmcaho0LAfgWtKyPxaEARWhRKPx3HhxVth3g6Fv8mUbIEYwCawcZg+nmz9ZwtBEBKJRH55sSAIlOEcYqbge7GNBJYYj8dzyFjOoOODe1QiFVSnFfc6UVzTk98kUsoyFoqi8F1dXShbfoeEBg0fGhKJhCAIWAu+y9FE94flJth2GTwH7CbF3YQFEAOkV24xZIt3nyIBjB3SZe9Sp1TemSjJLUX4lCQpc4NhDRo0aNCg4X8BfX19PMdxdXV1RUVF2y0MNWjQkAkKCgpwu9WpU6d2f6w7c+wyXZvNNjg4mHPwHAAjVZzby/ZkvcViuXPnTm5hAbPZDCOOnGPIClhkjI2NgeFmfiVNXoB9wenpaUmSOjo60thD7QaCIITD4dnZ2YKCgoaGhnxZFaWBKIrr6+tzc3MOh6OysjJDqx9Jktxu9/z8fFdXF4/2KC4u1iSfBg27QVFR0d///neO4/72t7/R9S7vALtMt6Cg4Ntvv805eA6w2Wzfffcdx3Fff/216hKAHWGxWL7//vvcwgJms/kf//gHx3FfffXVO5N8ly5dslgs7+aeaxaQfFevXnU6nd3d3Xsn+UKh0PXr1w8ePHjkyJF3I/nW1taGh4dbW1urq6szl3wrKyv37t37j+Tr6urSJJ8GDbtEYWEhWOqf//zn/J7sTo9dpkvvG+QWPAfYbLYffviB47gvvvgiW+llsVj+9a9/5RYWMJvNuHHt888/f2eS78qVKwaD4Q9/+MPvIvmuX79eWlp6/PjxPZV8g4ODNTU1zc3N70zyjY2NNTc3HzhwICvJd//+/a6urvzYkmrQoEGDBg37BZrk06BBgwYNHxY0yadBgwYNGj4s7BvJB3U5CxwKfh+AkyW4PuD9yZWG9wQ6nU6SJLqlQvW510DnpCGT4cknbN6ohpsqLHmgsqiCEDIsrCr4djcupgdFknlJgR1Tx+hW/SUKkGFJAVVYVZwUFXlDidgGTYkMC45IyLPqk3ga9VgAJ1bfiigtksvIBme5enJ5VX4oVBpk3hzb/nivwPN8LBZbW1vzer0rKysul2tlZQUXkv7u4HleURQYxUUikXdjHadhvwA3n3m93lAohBdi2U+173xDp9MlEomNjY2VlZWVlRUYdKRhBwTcTOb1et1uN4abKqxOp4MH3K2FZ7V9Ph+Gp8fj8Xq9q6urCBsMBncsLK6Fo1Crq6uhUCjb17p1Oh0i8Xq9Wd0ngGvJ2NS3trbY1HU6HVjQysoK/dXpdH6/nw2lKEom1Qv4fL6UKa6vr3u9XtwLqtPp4M3r9eIoeiwW29jY8Hg8qGqXy4W/xBgzLPjGxgYegoBn1WcsFkMdCoKgKIrb7UbBg8FgVvetIFrkDW3K3icXjUY9Ho/b7aYb2nieRxAwUtwLsba25vF4dkwXXZ2Sc7vd6JlqfxzHcRy/L2w79Xr9q1evHj16pKKfOXMm71fzZQuj0Tg+Pu5yuWw2G4zNPv7447zfx6Ph/UdKG0uynOQ47ssvv+Q4jv3My/m5lOmCa8iyPDg4SK/ocRxXWlra1tbG9s+Utp1kfsmiqqrqyJEj4FBWq/XHH3+kX59//jnHcSyFhU6n++yzz8iQMqVtpypCoLu7u6CggL1AMb1tp8lkovvEt7OlTLbt5HneaDRSQEJjY2N1dTWEGc/zeN2XcOjQoaamJmSGRV9fn9lsJqaU0raTiKqwLS0tBw4cwEsgHMedPXtWluWrV6/is7Kysr29/cGDBy9fvnwr2Nuoq6tramqCGWdK204IA7xfX19fD8/Xrl1DoQ4dOhSJRB48eOByuerr6w8ePEgZAHQ6XW9vr9FopCvcUtp2CoIQiUSSH5IsKio6evQoHp2Ynp52u92gy7J85syZQCCA85ocx7W2tjqdzrGxMSxy2tvbS0tLIaeSbTtFUfT7/Xfv3n0rMY7r6+ujFxf2n20nZjpwt7S0tLe3t7a2tre3YyIGD6SsYNUyRFfparB+V/lkl8n0C3SVDpMlRqPRgwcPYgYHIZ2sJ1EhTW5VeaDrdkRRRBDVFCZl6Vh6JrNm1jOr2QCgoKA8JNdkclkQCS51TOmmRNP4UflnU0wmvrdg6wprPvpEbdNbYtSypM5iVUNZNSggy/LIyAjE3tGjR8vKyjiOW11dnZubk2VZ7fttsEl89NFHRUVFHMctLCw8ffrUYDCIokjPAAFYxXZ3d7e2tp48eZLo/f39ra2tvb29rPRNCVWKcIyOjgaDwQx3EARBYEVCKBTa2NjIsJ+wqZ8+fRr18/jx46WlJb1ej3ft8ffYsWOgPHv2jFU74e1fvAgfiUR2TJdSlGWZamxmZmZ1dZX18+LFC/pcXFzc2toiTlhXV3f8+PGOjg58WiyW3t7e1tbWqqqqzM8VqC6BwydebIWUIrHX0dGBZ37j8bjX681Q/Qg4HI6enh4EWVtbw2QiFouxFRiJRGKx2NOnT4ny+PFjRVHoxAIra1OCJnO1tbWdnZ1wDw8Ph8Ph5ObYH5KP7ShVVVUHDhw4cOAARjIQi8U2NzexHt/Y2KAqSCQSwWAQRPKs0+kikcjq6ioUCGAlWN1jpQz/pFvwer3s7JIl8jwfDocjkUhHR0dbW9uxY8eOHj26traWfsEXjUb9fv/Kyorb7aaYsa73er0ejwd58/v9uDQdaW1tbXk8nmg0ChaJbcWtra3V1dX19XXICaKj1OhkabqLynMsFguFQtBLICcul8vn8yEPuPV/bW0NlYYYFEWBjsvtdoO78TwfiUS8Xm8gEMC8L9mNVwuIHg6H07vZyUEycf8CmiuqZDRiIpHw+Xyrq6tUn6R7RDfI5Mk0PCEElVFDQ0NNTU1LS0t3d3dnZ6fT6czw/BNgt9sHBgbgnpub0+v1oiiyHAoPNgmCYLPZHA6H0+kkutPpdDgc2b5NUV5e3traCvfKykoy20oJURRVaiGPx5MVg8bSs6ysjO7xf/nypdFonJ6exueJEycqKipOnjzZ1dXV3d1ts9lALykpcTgchw8fxuf6+nqGeaawFy9exOebN2+Is0HNyHoOh8PEyiorK8vKyvCWOJrJ4XA4HI6snlZQdSR0NrA4o9FIr+86HI6KiooTJ050dXW1tbWVlZVl24WcTueJEyfw6ff7kclEIsFeoakqbyQSURSFVAWZl6usrOzAgQP0mGLK53zV3+8/FhcX8VoVygMxNj4+fvfu3fv3709OTo6Ojk5NTYmiGA6Hb968OTQ0RERMsQOBwO3btycnJ8fHx2/duhWPxw0Gw/z8/NjY2NjYGEUyODhoMplAHxkZoVm5wWCYm5sD0WKxzM3N3bt3b2Jiwul0Tk1NjY+Pj4yMbLfPLAhCMBgcHR0dGRm5f//+xMTEyMjIkydPBEEwGo2PHz8eGxsbHx+fnJwcGxu7e/ducXHx7Ows0rpz5874+PjNmzcRlSiKb968uXPnzuTk5L1798bGxpCiKIperxelHhsbu3Xr1tzc3HbjUBRFj8dDnm/cuDE0NDQ1NYXP8fHxqamp0dHRhw8fIj/Dw8OIE+sSn893586d0dFRlGV4eHhhYaGgoADehoeHy8vL79y5A7fD4RgaGoJbkiRyOxyOwcFBuJ1OZ0o3DQ+r1UpEq9WqLs++wtLS0o0bN9AzR0ZGbt686fF4DAbD9PT0yMjI5OTk3bt3X716JYqizWZDNY6MjAwPDz9//nzHRZvRaKQF0JEjR8LhsCiKdru9vLx896+bSpKk0iLOzc1h30FRFHbfBJ/ZJre1tUWPqj99+hRrrB0hCIIqoWfPnmW4XmShugFZp9NhHSbLst1ux3KquLi4sLCQ+Gk0Gg2Hw3V1dfhcXFzMSuKyDB1v8sHNyjkAE024MZWk2o5Go6jtDMXDdsDMFSIZizyO45aXly9duhQMBiFfMxdCLKh1UMNQvTqdzvLyctCT961I0a16IGX32H+Sb3p6emJiAkJLURSomDc3N4uLi5ubm+HH6/UKgoDVCQX0eDxY37C64Hg8fvPmTfbVq66uLjiwUUx0UugJgkDtwaphM7FtwUZ6KBQqLy9vamoCcXFxEdFSVDTVwprvv+E5Dgp6s9nscrkww8Uo9fv99+7dMxqNXq93cnISfQX+l5aWkqc8KJHH47l//z77rodOpzt79iz5OXHixLlz51TDD5VmMBjW1tbwHGhjYyN+PX361Gw2U54NBgMVimVM7MyO7dDbufEiGqsSTJ6u7jvQE6DHjh2DIxwOz8zMQAVkMBg4jnvx4sXLly/hJs8NDQ07zrjZyhEEwe/3Ly8vLy8vr6yswHLkLd9p4Xa7b9y4AXddXV00GiVVZ0NDQ0FBAdxerzcHMbMdsmVzrKqzpaUF/VlRlMwVnoDf73e73aTiq62tpU5LzxAmEglFUZIHJiWUzMHTAFYzly9fxqfT6SSpv7y8DEdVVRUcLpcLDofDsRcPhoPj3bt3Dws1lXgbHBy8cePGxsZGtkPP6/UuLy/jdlnsTIdCoYmJCcwhaK1Mmt5Dhw7BQYyiublZkqQMy+t2uxcWFvCy/HZq0iwGwHuC1tbWlpYWuG/duhWNRgsLC9vb27e2tmZnZ8lbJBIpLy+HEpKIkiRR17l48SJ6GCqFNVoj/ywHgQ5wY2NDpRlnPRBxO0Sj0bKyspaWFq/Xq9LMsI9+2e12ONjp5xdffEFcxmQyEfchQbWxsWG1Wp89e4bPTz755PTp0x0dHT09PSnNlwwGA97UxuPX/f39HR0dJ0+etNvtrJajsLCQgvzlL39BfhBhbW1tY2Pj0tISxaPCmzdvyM2OIlZXpprwpnQvLS253W6/35/DTPP9x9TUlMViaW9vb2pqmp+fB/HcuXNwPH36lJoDJgnYBCXKjjAajSMjI1NTUxMTE2NjY4ODg6SmywTXrl3zer3gv4cPH47H49R8JSUlxKazUvHlHayqs6ioqLa2Fm6/359trm7evAm7ysbGxoqKipRjJ4+AbQga9OjRoyUlJSRTFxYW4CAFMnUPp9OZlXzNCig+dANnz54tLi6mX6FQaHh4OBgMZlWrb968ofVGd3e3xWKJRqPIvyRJpMAg3kWrXqLYbLZk6bUdXrx4gSvCYeGi1+uT62r/Sb6ysrKDBw/SpABceHJyUrWpizexamtriUfo9Xp2CSXLckqVEc0UzGYz++rm+Pj4+Pj46Ojo0NBQylZPb3AFQNc6MzOjGk6CIGxubtKqET1PBbPZzJ5xoba8fv06643VDxiNRofDwa4YVKBsCIJgMpkcDoder49EIhSJam7L5kGW5bW1tcePH8dise10OzSTVSHZ4i49BgcHJyYm7t69++TJE/W//QOVhcvx48fJvbm5OTk5yU6eWFNDVs6xeog0CIfDNE96+fLlyZMnT58+TX+zmrP39/cfO3asp6fn8OHD0WgUfRi/vF4vpfLgwYOUAyo3ZFJGFqxGwePx0Nzx4cOH2ebqxIkTbW1tfX19lZWV7Lus9L4dmSCpqpEykJI/bAe9Xt/b29vW1nbixIny8vKUZuGSJKkmK9gPZim5gYwDiAKegClvNBrV6/Xd3d0DAwPsDNjtdm835FOioqKCFKfQW4Jd19fXs3awhKwqMBmwcGlvb+/v799uZbz/JB9ATSVJEq2RBwYGampqyEM0Gp2fnycNTDgcjsfj9MmqyFkQP4INBS0Bab90Y2MjK2URC71eTwLys88+o87EiuTq6mpqeFZ9FAgEKMN4BBXu7u7ulpYW3JLOzsVisVgwGHS5XGkMvSj+TDyr8oAdKbi/+OKLt/z9Py5cuKAmcVwavsYyKbb39/f3wzE7O5tHldo7gEposSzG4XAcO3aMLBQ4jhsZGSH3qVOnmpubDx482NnZyV6snCG/i8ViZCixvLxcUlJSUVGh9pQZsBMDzsvz/OLiIv16/PgxqbDyqPBkNykPHTqUciLIQhAE1tb04cOHZBkfiUSyUnharVan01lWVkYT30gkgrIHAgGPx4NNx/X1dZzeQyhRFPV6PS1QKisrU/KWlCguLkaK4NGw+zCZTKwfvV5PshyQJCnDnpAemMpQVDzPz83NwcgIg9Ttdq+urvI839fXRztB2SZtt9vPnDkD9/DwsM/nQ3sVFxcnv5eLfaWSkhKWmJWeA4Y/paWlBoNhO1aTIwd/96Biwyyb9C3sXG90dPTVq1dwy7K8srICM43/RMFxiqLQbuovv/wCz6h3isRoNMKGG6B0TSYTTbvYNmDdLBfbEXfu3KHjU/F4nOb7sViMtNusTekPP/xA+21bW1sHDhyAe3p6emZm5vnz5w8fPuQ4jpTmV65cuXXrFlncUDyEUChE+3NXr169ffv2+Pj42NiYLMvbdbJvv/0Wv0RRjEQi5I09tcP248rKypR0Vn/C0peWlsjNrgtZ/9t15fcTwWCQ9BP37t3DDgqsTmZnZ6emppaXl9lu09DQAMejR49mZ2efP38+Pj6ewxPSkUiktrYWC7Jnz57Nzc3RXl22nAt2E1j9iKJIKriampqurq7Ozk4aLx6PJ3MZkwarq6szMzNwl5WVJa8JVBAEgQY+5gqdnZ0kPLKSfCisoii09orFYnTqYGhoaHl5eXh4GEZtpOT3er0ul+v58+f4LCws3DHPBDZFahpiU3CbTCYynwGSzZQyb1P4xLibn59/9uwZDvNBzYhS6PV6eICu69q1a8vLy6RCLC4uTt7mTAOcKKf569DQEEY6tu54nmfl3OHDhw0GA6vVgxkEfe4IVZWmxP6QfOwSZ2pqampqCu7Tp08rikK1xvJKRVFIWQxgfmE0Gnt6eojI8/zZs2dZM/1bt25B64ipENFv3LgBOWSz2YhZsxlrbm7eUa8SDodpVYq9E2BqaoomjIuLizRh/Omnn5LjPHfuXCAQIBsZWqWVl5cHg8Hi4mJsbVLXdDqdKaWFoih2ux3mFWQxUV5eHo1GSVKmHE6oNJ/Px5qe099YLEYTf9aYgt0fbWpqYpeb/wn5torvm2++of0tOuPc2NhIZUmZt/cNkUikrq4ObGt+fh77NLW1tTU1NaSFJkOG5ubmQ4cOQczT7KexsXFra4sizLzUsVisr68PUnNmZoZSqaur2/G1mu3mdphQwo2TReXl5cSUHz16pJo2ZZ5b1icOWcOcx2Qy7chkJUmiOWJVVVVZWVlZWRnl6sWLF8mDSAVKPXktlUgkIpEIce379+9T7dEeZyKRwORPEISuri5ZltPwXBWS7STj8Xh9fT19VlRU4C4VojidzmQlXuarIiwrz549i/H44MED0Pv6+mjEGY1GDFiyoIbdHA72Wa3WHRuFBU7vqWx0dTodjIYEQaD5OuYNrHIO7CIT8xZiL6pFZErw++IOF2xrBQIBWFWhu1gsFqqOaDS6tbWVSCSMRmM4HOZ53mKxINTm5mYsFpNlmRTNOAiBrW+r1Yoew8aPyy/MZjMaLJkej8dx1RC2auFGX4Sb0koJRVEweLCphkexI5FIb28vTJN5nrfZbBhL5eXlWA5+9NFHGxsbFotFFEVMlHDMCxpOs9lMJ99xRRaOxKEU23WFlJ51Oh1yKIqiyWSyWCw///wzOvq5c+fW19dRaaj5SCSC4yWyLOMmBbPZDCLc4XA4FAqxbuwpKoqiosfjcZxWLC4uxiT0008/dblcRNfr9Yg8FApJkpTtKbG9Rpq7VLBMR6MbjUYsR6DaCgaD4XBYr9ebTCZo1+PxeCAQICKmDqFQKBKJ6PV6sjDcMV109Xg8vrm5iZmNwWDAbjfbH1Le4QKjc0VRVCnijjFs/xAjSyQSyJ7BYIA4R1iDwZBSf5DyDhd05mg0Go1GcdDIZDJhbLIxpLzDhed5v9+PUCTkULeKophMJjYbyXe4ULlwiC1Z+IHh4GwZTmEbjUaDwUChkGccgFMdrkh5hwuAY+kmkylZ+FHMer2eShQIBBCz2Wxm5RzoKeNJeYcL/YrFYn6/H0bsVqtVluV4PO7z+dhqxO2MaHRwNoPBoGqUlHe4AJubm4lEAowFfX5rawvnMUwmE2u4APs1g8EAYiKRAOOFCprneTbF5DtcEARHYMH8yTOBvcNFwJwipd3newVUOhixxWIBm6A8g4FiqKBt8Auf1FrwDKWN1WolBpQcP+Y+WPOp6ESEwgFJgAuw9Ldy/zYgPjHGTCaT2Wx+9eqVoijt7e1g7mazuaCgYHFxEf0DU/6Wlhakwi569Ho91QbFn0gkZFlGbtOIPSDZM+rHbDZjJOj1+idPnqD22traMBejPKAs6K/oyjB4gS1MSjfqJ5mOSjabzUVFRdDcHjlyhKQvAlLeMpkDvmMYDAaYFzY1Nam2S3meNxgM6ELgwuhFsEKyWCxQLoGOy7RUREjBlPP6NOkiNuq9yWKPNfFVBd8uRYPBQNMsUJBhlh2TzE7OLf4ixcbGRnYPD9LObDajllLa8siyDCsnVVhkgM0V5BN4LpsNWZaxV9LY2MgeDsGMRMVhCTTS0RWJOyMU5Vm1eEXlCILw/PlzURTr6+vZBQbNgVKmiL9siUwmk8lkItZEPkFPGQ+K8/LlS7PZjLUj/cJii0pEJ7tUYhXmPOg/qOHkRoGZwuvXrwsLC0tLS1U2caxlMma9GO+qdoFPSprneVBSyiadThcKhZaWlkpLSwsKCrDCxoInpX9AEIRAIOByuSoqKvaHthPtRNpbgC1ePB4nImuOSHTVAU/WPyjbxZ9MByeiVMitoqcBDvzCrhcTyY6Oju7u7kAgALsbnENqa2sbGBigbGM5qGpUOjuMBYSKjqlo8nhQIdkzW40QjfBJaSWHhYNuP0rjRrTJdILH4zl58mRvb6/P52PpqGQK+N8CvPdIJBJ00JjMBVEW0FH5Ks9EhPYiufUzgSrpTPoDsF2K1NAsUdU5twubHtSZEX9WwZNzRQXPMB54TlM5bC+lXUCqW5aYIdKniL9sibY7q54+njRgS0S1xHZF6qVsGf8bPgOoMkyDN7ldkuOnRFlv6ZG5/30j+f6HkUgkJEki63AiyrIsSVJTU1NXV1dPT084HM6hc+8egUDg+PHjXV1dvb297IbT3gFKD6vV+ruUV4MGDf/z0CTfewHMT1VEzI8kSSouLrbZbL+XGIAMLi4utlgs7ywPWAypqRo0aNCQD2iS731HhhrUPcV+VDBq0KBBw3bQJJ8GDRo0aPiwwOMYx3t+qkGDhvcfhYWF33zzDcdxf/3rX1WnC/YUu0y3oKDg22+/zTl4DrDZbN999x3HcV9//XXy67LpYbFYvv/++9zCAmazGYdAvvrqK/ZynD0CTjVcunTJbDafP38+23v7dglYbF69etXpdHZ3d+94jjM34FTD9evXcZNU+nug8gKcahgeHm5tba2urt7xAncA9zaPjY11dXXxuDytqKjo99WnadCw31FQUIA3pM6cOZOXx9YzxC7TpZOjuQXPAVarFXeenTp1KlvZYzabh4aGcgsLmEwm3G3W39+/43u5eYEkSbi758SJE+/GRoyAUw3379+XZbmjo2OPZJJOpwuHww8fPiwsLGxoaNjxtrndQxCE9fX1Fy9eOJ3OzO+KE0XR7Xa/evWKrmHToEGDBg0aPgj09fXxuDfkndnsadDwPwxcMfXuTYFw3jnndHcZPAfsJkUcps7wlF5K7D6GbPHuU2QhSdI7YPLvJhUCjthnmyKUzwaD4f8A4u5SJWAjL90AAAAASUVORK5CYII=" width="595" height="42" class="img_ev3q"></p>
<p>Если страница не присутствует в памяти (бит P=0), то процессор не использует все остальные биты элемента PTE и программа может их использовать по своему усмотрению, например, хранить информацию о том, куда эту страница была перемещена:</p>
<p><img decoding="async" loading="lazy" alt="1763723660872" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAAfCAIAAACwBYm6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAN7SURBVHhe7dtbYpswEEBR043grEReOqyEZCX0Y9LpRBoNcsBYce75SAMSQuIxepRcLgCA/txut0H+yVMAALtN0/S9ACsH/sl3AwD6QIAGgE4RoAGgUwRoAOgUARoAOkWABoBOEaABoFN8B32qaZryXZcLtwB4Ve530Ou6zvOsmymlYRi+5OA7aAB4Chudy02LAP0ENyNPA/DSlmWRX2wE0J0ZljhOJUsc9oJne+K5j5taWzYR2c3V09WOkvw762mVJyqLzUiG7BQ2yXJLyBqSUtKiWi6p/F6WrNctKHBZlo+PD93UVC1Nm5DtacxQXgERp+JZyiUOfYTkwdAnsMzGEkdfypA0z/O6rkGq3XTZnrnWS9/LrYnW8ygtrWtki9q8pC0NqRWYRWe3FZI5OMtmBrwA7dRrIxtBgD7P5iunL7Od++hOm5pS+jzmX2bNr5uSx8YL+d099q6RV1xPV3yKoA4ppVqSpSXUctok95KWqTapLNk9RK9wdo+s9/d3/enazIDfgwDdHX2x3TdcgsIwDGXIyGjPnI3I4h7bmow8baueYrNPOkdc1TjVVTtEb8qyLLUeS4J4NtC24gz2prj3Ba+EAN2dxrlPi3EcdXwnP2XPIQ6sZ2Ce5/2RKK5qnOqqHbKu6zRN8zzXwqtcf+m33HuxmSGz88qgcwTo88ikdfOtsyukedqdrter/KJFvb29fckR+j+394bqLfVsbLLLPen3xFWNU121Q7QXTCm543G5I5JN785dGfSOuOXjp6g9QhkC9HlkVOW+dVa5QmrJiElGapujJx3fuUXtFNdTNDbZpf+lKUu6efI94qrGqa74kOv1OgyDu4hsR9zugH0zA346O6+1nXqe73IhQJ9Hg6nO2W2E1S9vdFOTyuVOmUQHN9Wy46yjxlxxPVXZZLvf7inp5xDjOB4Sp9yqNjbEFRwi7dVVjniIdC85rz4D+HF0FmsfodrUlgDdkWEYslfdfmObpY7jWLup1iNGZHE97+UGRI1uLW3clPVStUva3pBagdlIX7JlkVS61aBz3cxg7Zxb4CnKp85uWgP3+BzSVbqXOkjaTz/1bQzoB3Lb5e58nMNPd3iBeG3lH6o04g9VXp+dCJ8cnQHsR4D+FYI51OO4n3+4OwG4WOIAgEdhiQMAXhMBGgA6RYAGgE4RoAGgUwRoAAAAoNntdvsL6aCi7iTZ/80AAAAASUVORK5CYII=" width="480" height="31" class="img_ev3q"></p>
<p><strong>Формат PTE:</strong></p>
<table><thead><tr><th>Бит</th><th>Описание</th></tr></thead><tbody><tr><td>0</td><td><strong>P (Present - присутствие)</strong>. Если 0, то страница не отображена на физическую память. Это значит, что она либо не определена, либо её содержимое было записано на диск операционной системой в процессе свопинга. Если происходит обращение к неприсутствующей странице (у которой бит P = 0), то процессор генерирует исключение страничного нарушения (#PF).</td></tr><tr><td>1</td><td><strong>R / W (Read / Write - Чтение / Запись)</strong>. Если 0, то для этой страницы разрешено только чтение, 1 - чтение и запись.</td></tr><tr><td>2</td><td><strong>U / S (User / Supervisor - Пользователь / Система)</strong>. Если 0, то доступ к странице разрешён только с нулевого уровня привилегий, если 1 - то со всех.</td></tr><tr><td>3</td><td><strong>PWT (Write-Through - Сквозная запись)</strong>. Когда этот флаг установлен, разрешено кэширование сквозной записи (write-through) для данной страницы, когда сброшен - кэширование обратной записи (write-back).</td></tr><tr><td>4</td><td><strong>PCD (Cache Disabled - Кэширование запрещено)</strong>. Когда установлен, кэширование данной страницы запрещено. Кэширование страниц запрещают для портов ввода/вывода, отображённых на память либо в случаях, когда кэширование не даёт выигрыша в производительности. Также, кэширование запрещается при обработке исключений и отладке в ситуациях, связанных с программированием кэшей. Более подробно работа с флагами PWT и PCD описана в разделе &quot;Управление кэшами&quot;.</td></tr><tr><td>5</td><td><strong>A (Accessed - Доступ)</strong>. Устанавливается процессором каждый раз, когда он производит обращение к данной странице. Процессор не сбрасывает этот флаг - его может может сбросить программа, чтобы потом, через некоторое время определить, был ли доступ к этой странице, или нет. Например, страницу с флагом A=0 можно не сохранять на диск в процессе свопинга, т.к. она не использовалась.</td></tr><tr><td>6</td><td><strong>D (Dirty - Грязный)</strong>. Устанавливается каждый раз, когда процессор производит запись в данную страницу. Этот флаг также не сбрасывается процессором и может использоваться программой, чтобы определить, была ли запись в страницу или нет. Например, страницу с флагом D=0 можно не сохранять на диск в процессе свопинга, т.к. её содержимое не изменялось.</td></tr><tr><td>7</td><td><strong>PAT (Page Table Attribute Index - Индекс атрибута таблицы страниц)</strong>. Для процессоров, которые используют таблицу атрибутов страниц (PAT - page attribute table), этот флаг используется совместно с флагами PCD и PWT для выбора элемента в PAT, который выбирает тип памяти для страницы. Этот бит введён в процессоре Pentium III, а для процессоров, не использующих PAT, бит PAT должен быть равен 0.</td></tr><tr><td>8</td><td><strong>G (Global Page - Глобальная страница)</strong>. Когда установлен, определяет глобальную страницу. Такая страница остаётся достоверной в кэшах TLB при перезагрузке регистра CR3 или переключении задач. Этот бит введён в Pentium Pro и работа с ним подробно описана в &quot;Управлении кэшами&quot;. Для процессоров, младше Pentium Pro, этот бит зарезервирован и должен быть равен 0.</td></tr><tr><td>9..11</td><td>Доступно для использования программой. Процессор не использует эти биты.</td></tr><tr><td>12..31</td><td>Базовый адрес страницы - это адрес, с которого начинается страница, другими словами - это физический адрес, на который отображена данная страница.</td></tr></tbody></table>
<p>В рамках данного изучения мы ограничимся базовой конфигурацией страничной организации памяти:</p>
<ul>
<li>мы будем работать исключительно с 4Кб страницами, без использования механизмов кэширования</li>
<li>биты U/S, PWT, PCD, PAT и G везде будут установлены в 0</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="каталог-страниц">Каталог страниц<a href="#каталог-страниц" class="hash-link" aria-label="Прямая ссылка на Каталог страниц" title="Прямая ссылка на Каталог страниц">​</a></h3>
<p>Каталог страниц - это массив размером в 4Кб, состоящий из 4-байтовых элементов PDE (Page Directory Entries). Каждый элемент указывает на таблицу страниц и по формату почти совпадает с PTE. Элемент PDE определяет положение таблицы страниц, указывая адрес физической страницы памяти.</p>
<p><img decoding="async" loading="lazy" alt="1763723699290" src="data:image/png;base64,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" width="590" height="42" class="img_ev3q"></p>
<p>Если таблица страниц не присутствует в памяти (бит P=0), то процессор не использует все остальные биты элемента PDE и программа может их использовать по своему усмотрению, например, хранить информацию о том, куда эту таблица страниц была перемещена:</p>
<p>Для начала мы будем использовать модель памяти процессора i368, поэтому флаги U/S, PWT, PCD и PS будем устанавливать в 0.</p>
<p><strong>Формат PDE</strong> (все флаги в элементе PDE действуют на соответствующую таблицу страниц):</p>
<table><thead><tr><th>Бит</th><th>Описание</th></tr></thead><tbody><tr><td>0</td><td><strong>P (Present - присутствие)</strong>. Если 0, то таблица страниц не отображена на физическую память. Это значит, что она либо не определена, либо её содержимое было записано на диск операционной системой в процессе свопинга. Если происходит обращение к неприсутствующей таблице страниц (у которой бит P = 0), то процессор генерирует исключение страничного нарушения (#PF).</td></tr><tr><td>1</td><td><strong>R / W (Read / Write - Чтение / Запись)</strong>. Если 0, то для всех страниц этой таблицы разрешено только чтение, 1 - чтение и запись.</td></tr><tr><td>2</td><td><strong>U / S (User / Supervisor - Пользователь / Система)</strong>. Если 0, то доступ ко всем страницам данной таблицы разрешён только с нулевого уровня привилегий, если 1 - то со всех.</td></tr><tr><td>3</td><td><strong>PWT (Write-Through - Сквозная запись)</strong>. Когда этот флаг установлен, разрешено кэширование сквозной записи (write-through) для всех страниц данной таблицы страниц, когда сброшен - разрешено кэширование обратной записи (write-back).</td></tr><tr><td>4</td><td><strong>PCD (Cache Disabled - Кэширование запрещено)</strong>. Когда установлен, кэширование всех страниц данной таблицы страниц запрещено. Кэширование страниц запрещают для портов ввода/вывода, отображённых на память либо в случаях, когда кэширование не даёт выигрыша в производительности. Также, кэширование запрещается при обработке исключений и отладке в ситуациях, связанных с программированием кэшей. Более подробно работа с флагами PWT и PCD описана в разделе &quot;Управление кэшами&quot;.</td></tr><tr><td>5</td><td><strong>A (Accessed - Доступ)</strong>. Устанавливается процессором каждый раз, когда он производит обращение к страницам данной таблицы страниц. Процессор не сбрасывает этот флаг - его может может сбросить программа, чтобы потом, через некоторое время определить, был ли доступ к этой таблице страниц, или нет.</td></tr><tr><td>6</td><td>0 (зарезервировано).</td></tr><tr><td>7</td><td><strong>PS (Page size - Размер страницы)</strong>. Если 0, то используются страницы размером 4Кб и данный элемент PDE указывает на таблицу страниц. Если флаг PS установлен в 1, то данный элемент PDE указывает на страницу размером 4Мб (для 32-разрядной адресации), либо размером 2Мб (при расширенной физической адресации).</td></tr><tr><td>8</td><td><strong>G (Global Page - Глобальная страница)</strong>. В PDE этот бит процессором игнорируется.</td></tr><tr><td>9..11</td><td>Доступно для использования программой. Процессор не использует эти биты.</td></tr><tr><td>12..31</td><td>Базовый адрес таблицы страниц - это адрес, с которого начинается таблица страниц, другими словами - это физический адрес, на который она отображена.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="регистр-pdbr">Регистр PDBR<a href="#регистр-pdbr" class="hash-link" aria-label="Прямая ссылка на Регистр PDBR" title="Прямая ссылка на Регистр PDBR">​</a></h3>
<p>Для того, чтобы процессор мог использовать страничное преобразование, ему необходимо указать адрес начала каталога страниц. Этот адрес хранится в регистре PDBR (Page Directory Base Register - регистр базы каталога страниц). Функцию этого регистра выполняет регистр управления CR3, т.е. PDBR - это синоним CR3.</p>
<p>Т.к. каталог страниц должен быть выравнен на границу 4Кб, его адрес будет содержать нули в младших 12 разрядах, а 20 старших, следовательно, будут нести информацию. Эти 20 разрядов и хранятся в регистре CR3. Оставшиеся 12 бит в CR3 зарезервированы.</p>
<p><strong>Формат регистра CR3:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763723715521" src="data:image/png;base64,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" width="510" height="55" class="img_ev3q"></p>
<p>Для того, чтобы загрузить значение в CR3, можно использовать только команду MOV (как и для всех регистров управления). Т.к. регистры управления - 32-разрядные, то вторым операндом команды MOV должен быть 32-разрядный регистр общего назначения (как правило, это EAX).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="включение-страничного-преобразования">Включение страничного преобразования<a href="#включение-страничного-преобразования" class="hash-link" aria-label="Прямая ссылка на Включение страничного преобразования" title="Прямая ссылка на Включение страничного преобразования">​</a></h3>
<p>Для активации страничной адресации в программе необходимо выполнить три ключевых шага:</p>
<ol>
<li>подготовить описания всех используемых в программе страниц, таблиц страниц и каталога страниц</li>
<li>загрузить адрес начала (т.е. базовый адрес) каталога страниц в CR3</li>
<li>разрешить в процессоре страничное преобразование</li>
</ol>
<p><strong>Простой вид элемента PTE:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763723725192" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAh8AAAAoCAIAAADR3w+6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAPqSURBVHhe7d1RcqQgEIDhzdbew9xEjuJNLG/iUfQm8Sb70BVCukHUoMHx/55mEAbUkRawZt6cc38AACjqb/hm+qQSw7cA6mSvXHs5r7A5bQrqt/e8e3uLZCv6ii7TNLlPvsBKSQD1sKHFXs4rbB6bgvrtPe/erswbK/qKLnaKTMqrRAC1sZfqrivXFrcpuIVjZ+2k0/1tZswPdqSmM+oDUNwPL1Vb3KbghZ10unV0WR/pALiXk25LUbkazruOLgBeRg1dDK5XyXn/tqr/bQuAO6uki8HF6jnv31b1/RNmlTQOwDFys5h9ZhQv5rLzviVevKU2AABwGOsuAIDyiC4AgBMwMwYAKMs59yaLM33f640AXtEwDDoJt7W36x6G4ZoizjlmxgAA5RFdAADlEV0AAOURXQAA5RFdAADlEV0AAOU9LroMhs7xe4ZhkN/tqapVAG7kcOdWvMjjoovoA3rb72maZp7neZ6bptHbACBnHEfpSaQPkbdZB+5otxR5aHSpU9d1EvC6rtPbACBnWRbpSaQPkbdZ8zzrpJwtRf7phAebpik8ZG3bys/khOk+Ue4L5OQ1TePjgYrnfpOkq6FSmOhf++rsuCrVQltv+JlN00g7ww/0+cPGhzulPj+VwX7J+r5P1Ztqf/Q4rByTaJ4tBxlAlL9st8sWeejYJTo1Oc9z27Z937dtGwZneaESpZOVEeiyLGoE6j9k471DyPbXXqqFXrQPlXaGEcX3/qrxfqdSn28zhLOLaqbR1pttf8r2nAD2ivYb67YUeWh0kX5Q9X1yvMZxVH1ZdHnm2Aj0h1ItXJeaarON9zvlnFvf61SGkK33WPsB3NFDo4tQfZ/0esuyyJ21Eo5gsoZhiOb3A6bUats4jitL+qkWHvsTOjV0u0Cq/SLVnvVjYmUPMoALPDq6KH6RwC422JmxdanJn+yM2bIs7+/vOvVTqoUfHx8y0xUmZsngIzsEKSjVfpFqyfoxsbIHGcAFHh1dove20zSp9Og9tX/gzz8CqDJEO9CVdC+bwbZQutFUF5y6ix/HUR4r9Hvnd0qle9kMoVS9tv1Z2WOi7M0PvIZsv3Slh0YX6RnVE01yJuzoJByF+CmdrutkSVzWrtUkm+951dlNpXvRKSMv2sJwzVyt2wv77Ja8WJYltVPRab0tGUK23mj7s1K1hOEt3N/sQQZelV9J9UukOseF+Pew24v+t48kSidrt57t+nqjBwFR6yNO3Mver/2BK+VYEf49DABwCqLL7UVvK6KJL+xp+wvUj+jyylJPYZ3tt+oFUA+iCwCgPKILAKA8ogsAoDyiCwCgPKILAOAE/GYGAKAs59x/MIIuzlGCMwMAAAAASUVORK5CYII=" width="543" height="40" class="img_ev3q"></p>
<p>Для того, чтобы включить или, другими словами, разрешить в процессоре страничное преобразование, необходимо установить бит PG (это 31-й бит) в регистре управления CR0. После того, как это будет сделано, нужно выполнить команду перехода - она заставит процессор сбросит конвейер и начать выборку команд уже используя механизм трансляции страниц. Перед возвратом программы в режим реальных адресов нужно запретить страничное преобразование -     сбросить бит PG в CR0 и выполнить команду перехода</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="чеклист-выполнения">Чеклист выполнения<a href="#чеклист-выполнения" class="hash-link" aria-label="Прямая ссылка на Чеклист выполнения" title="Прямая ссылка на Чеклист выполнения">​</a></h2>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Подготовлена директория <code>lab4</code> и созданы необходимые файлы.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Программа успешно собрана с помощью <code>make</code> и запущена.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнен запуск с отладчиком GDB.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Исследована память по адресу 0x9000 (каталог страниц) в GDB.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Проанализировано содержимое таблиц страниц до и после инициализации.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Изучены значения регистров CR3 и CR0.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнено сопоставление линейных и физических адресов в GDB.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выбран и реализован вариант индивидуального задания.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Создан дескриптор с правами только на чтение для области памяти.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализовано заполнение сегмента данными при включенном страничном преобразовании.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнена проверка записанных данных при выключенном страничном преобразовании.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Продемонстрирован обмен записей страниц (swapping) и его влияние на чтение данных.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="выполнение-лабораторной-работы">Выполнение лабораторной работы<a href="#выполнение-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Выполнение лабораторной работы" title="Прямая ссылка на Выполнение лабораторной работы">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-1-подготовка-к-выполнению-лабораторной-работы">Часть 1. Подготовка к выполнению лабораторной работы<a href="#часть-1-подготовка-к-выполнению-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Часть 1. Подготовка к выполнению лабораторной работы" title="Прямая ссылка на Часть 1. Подготовка к выполнению лабораторной работы">​</a></h3>
<ol>
<li>Создайте директорию для выполнения лабораторной работы <code>mkdir lab4</code> и перейти в неё <code>cd lab4</code>, создайте директорию <code>img</code>, в ней будут храниться файлы необходимые для загрузчика.</li>
<li>Создайте по примеру лабораторной работы №3 необходимые для данной лабораторной работы файлы упомянутые в разделе исходные файлы. Скопируйте код предоставленный в приложении.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-2-выполнение-лабораторной-работы-4">Часть 2. Выполнение лабораторной работы 4<a href="#часть-2-выполнение-лабораторной-работы-4" class="hash-link" aria-label="Прямая ссылка на Часть 2. Выполнение лабораторной работы 4" title="Прямая ссылка на Часть 2. Выполнение лабораторной работы 4">​</a></h3>
<ol>
<li>Соберите программу с помощью <code>make</code>, запустите её, наблюдайте успешное выполнение.</li>
<li>Запустите программу с поддержкой GDB, и подключитесь через него.</li>
<li>Установите точку останова в начале функции <code>set_pages</code>(адрес начала определите используя инструментарий, который применяли во время выполнения предыдущих работ) и продолжите выполнение.</li>
<li>Исследуйте память по адресу 0x9000 (будущий каталог страниц).</li>
<li>Установите точку останова после заполнения каталога страниц, перед инициализацией первой таблицы страниц, и продолжите выполнение, проанализируйте содержимое каталога страниц.</li>
<li>Проанализируйте содержимое таблиц страниц до и после инициализации.</li>
<li>Изучите содержимое регистров CR3, CR0.</li>
<li>В GDB выведите содержимое сегмента данных используя первую таблицу страниц(адреса тождественны), определите используя теорию линейный адрес которому соответствует этот же физический адрес при обращении через вторую таблицу страниц.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-3-индивидуальное-задание">Часть 3. Индивидуальное задание<a href="#часть-3-индивидуальное-задание" class="hash-link" aria-label="Прямая ссылка на Часть 3. Индивидуальное задание" title="Прямая ссылка на Часть 3. Индивидуальное задание">​</a></h3>
<p>Выберите из таблицы вариант соответствующий вашему номеру в списке группы.</p>
<table><thead><tr><th>Вариант</th><th>Расположение в адресном пространстве</th><th>Базовый адрес сегмента каталога и таблиц страниц</th><th>Номер страницы с каталогом в сегменте</th><th>i</th><th>j</th></tr></thead><tbody><tr><td>1</td><td>4/4</td><td>9000</td><td>1</td><td>1</td><td>14</td></tr><tr><td>2</td><td>3/4</td><td>a000</td><td>2</td><td>2</td><td>11</td></tr><tr><td>3</td><td>2/4</td><td>1000</td><td>4</td><td>3</td><td>5</td></tr><tr><td>4</td><td>8/8</td><td>b000</td><td>3</td><td>5</td><td>3</td></tr><tr><td>5</td><td>6/8</td><td>2000</td><td>5</td><td>7</td><td>9</td></tr><tr><td>6</td><td>4/8</td><td>3000</td><td>1</td><td>9</td><td>10</td></tr><tr><td>7</td><td>2/8</td><td>11000</td><td>2</td><td>11</td><td>8</td></tr><tr><td>8</td><td>16/16</td><td>c000</td><td>3</td><td>14</td><td>12</td></tr><tr><td>9</td><td>14/16</td><td>d000</td><td>4</td><td>1</td><td>3</td></tr><tr><td>10</td><td>12/16</td><td>e000</td><td>5</td><td>2</td><td>4</td></tr><tr><td>11</td><td>10/16</td><td>0000</td><td>1</td><td>3</td><td>5</td></tr><tr><td>12</td><td>8/16</td><td>4000</td><td>2</td><td>4</td><td>6</td></tr><tr><td>13</td><td>6/16</td><td>1000</td><td>3</td><td>5</td><td>1</td></tr><tr><td>14</td><td>4/16</td><td>9000</td><td>4</td><td>6</td><td>2</td></tr><tr><td>15</td><td>2/16</td><td>b000</td><td>5</td><td>7</td><td>3</td></tr><tr><td>16</td><td>15/16</td><td>2000</td><td>1</td><td>8</td><td>7</td></tr><tr><td>17</td><td>3/4</td><td>a000</td><td>3</td><td>14</td><td>12</td></tr><tr><td>18</td><td>8/8</td><td>3000</td><td>2</td><td>6</td><td>2</td></tr><tr><td>19</td><td>10/16</td><td>f000</td><td>4</td><td>3</td><td>5</td></tr><tr><td>20</td><td>12/16</td><td>10000</td><td>5</td><td>5</td><td>3</td></tr><tr><td>21</td><td>8/16</td><td>2000</td><td>3</td><td>7</td><td>9</td></tr></tbody></table>
<p>В соответствии с вариантом вам необходимо определить область физической памяти, на которую вам необходимо будет отобразить сегмент заданного размера (например, дробь 7/8 означает что необходимо отобразить 1024 КБ/8 = 128 КБ на физическую область памяти начиная с адреса 0x1C0000(используем только второй мегабайт физической памяти)). Также необходимо добавить дескриптор с правами только на чтение который будет описывать данный сегмент памяти при выключенном страничном преобразовании. Затем с включенным страничным преобразованием необходимо заполнить данный сегмент возрастающими двойными словами, выключить страничное преобразование и прочитать записанные данные, совпадение записанных и считанных данных является доказательством успешного выполнения лабораторной работы. Также необходимо учесть, что в сегменте, содержащем каталог и таблицы страниц, каталог страниц должен находиться на странице с номером внутри сегмента соответствующем варианту. Базовый адрес данного сегмента также указан в таблице. Записи для страниц с номерами i и j в таблице страниц необходимо поменять местами, в дальнейшем при чтении без страничного преобразования необходимо пронаблюдать результат этого действия.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Прямая ссылка на FAQ" title="Прямая ссылка на FAQ">​</a></h2>
<p><strong>Q: Зачем нужна страничная организация памяти?</strong>
A: Она позволяет виртуализировать память, предоставляя каждому процессу собственное адресное пространство, изолированное от других. Также она позволяет использовать больше памяти, чем физически установлено (свопинг), и гибко управлять правами доступа.</p>
<p><strong>Q: Что такое CR3?</strong>
A: <strong>CR3 (Page Directory Base Register, PDBR)</strong> — это управляющий регистр процессора, который хранит физический адрес начала каталога страниц текущей задачи.</p>
<p><strong>Q: В чем разница между PDE и PTE?</strong>
A: <strong>PDE (Page Directory Entry)</strong> — это запись в каталоге страниц, указывающая на таблицу страниц. <strong>PTE (Page Table Entry)</strong> — это запись в таблице страниц, указывающая на физическую страницу памяти.</p>
<p><strong>Q: Что такое TLB?</strong>
A: <strong>TLB (Translation Lookaside Buffer)</strong> — это кэш процессора, который хранит последние результаты трансляции виртуальных адресов в физические, ускоряя доступ к памяти.</p>
<p><strong>Q: Когда возникает исключение #PF (Page Fault)?</strong>
A: Оно возникает, когда процессор не может транслировать виртуальный адрес в физический (например, страница не присутствует в памяти, бит P=0) или при нарушении прав доступа (например, попытка записи в страницу только для чтения).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="дополнительные-материалы">Дополнительные материалы<a href="#дополнительные-материалы" class="hash-link" aria-label="Прямая ссылка на Дополнительные материалы" title="Прямая ссылка на Дополнительные материалы">​</a></h2>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html" target="_blank" rel="noopener noreferrer">Intel® 64 and IA-32 Architectures Software Developer’s Manuals</a></li>
<li><a href="https://wiki.osdev.org/Paging" target="_blank" rel="noopener noreferrer">OSDev Wiki: Paging</a></li>
<li><a href="https://wiki.osdev.org/Page_Directory" target="_blank" rel="noopener noreferrer">OSDev Wiki: Page Directory</a></li>
<li><a href="https://wiki.osdev.org/Page_Table" target="_blank" rel="noopener noreferrer">OSDev Wiki: Page Table</a></li>
<li><a href="https://habr.com/ru/post/170929/" target="_blank" rel="noopener noreferrer">Виртуальная память (Habr)</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="приложение">Приложение<a href="#приложение" class="hash-link" aria-label="Прямая ссылка на Приложение" title="Прямая ссылка на Приложение">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile">Makefile<a href="#makefile" class="hash-link" aria-label="Прямая ссылка на Makefile" title="Прямая ссылка на Makefile">​</a></h3>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">all: lab4.bin img/boot.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	dd if=img/boot.img of=disk.img # Копируем загрузочный образ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	dd if=lab4.bin of=disk.img seek=1 bs=512 conv=notrunc # Записываем программу после загрузчика</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lab4.o: lab4.S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	cpp -o lab4.s lab4.S # Разворачиваем макрорасширения</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	as --32 -o lab4.o lab4.s # Компилируем программу для архитектуры x86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lab4.bin: lab4.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ld --gc-sections -m elf_i386 -T linker.ld -o lab4.elf lab4.o # Связываем объектный файл lab4.o с использованием скрипта линкера linker.ld, создавая ELF-файл lab4.elf. Флаг --gc-sections удаляет неиспользуемые секции для оптимизации.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	objcopy -S -O binary lab4.elf lab4.bin # Конвертируем ELF-файл lab4.elf в чистый бинарный файл lab4.bin. Флаг -S исключает символы и отладочную информацию, а -O binary указывает формат вывода.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">img/boot.img:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(MAKE) -C img/ # Собираем загрузчик</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm *.o *.elf  *.img # Удаляем всё лишнее</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linkerld">linker.ld<a href="#linkerld" class="hash-link" aria-label="Прямая ссылка на linker.ld" title="Прямая ссылка на linker.ld">​</a></h3>
<div class="language-ld codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ld codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ENTRY(_start)  /* Точка входа программы */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS {     /* Определение секций */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    . = 0x8000; /* Адрес начала секции .text */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .text : {   /* Секция кода */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.text) /* Включаем все секции .text */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .data : {   /* Секция инициализированных данных */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.data) /* Включаем все секции .data */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .stack : {  /* Секция стека */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.stack)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /DISCARD/ : { /* Исключаем ненужные секции */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.note*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.comment)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.gnu*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile-1">Makefile<a href="#makefile-1" class="hash-link" aria-label="Прямая ссылка на Makefile" title="Прямая ссылка на Makefile">​</a></h3>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">all: lab4.bin img/boot.img</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lab4s">lab4.S<a href="#lab4s" class="hash-link" aria-label="Прямая ссылка на lab4.S" title="Прямая ссылка на lab4.S">​</a></h3>
<div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;gdt.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;idt.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;irq.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define CS  0x8                 // селектор сегмента кода</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define DS  0x10                // селектор сегмента данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define SS  0x18                // селектор сегмента стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define ES  0x20                // селектор сегмента видеобуфера</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define FS  0x28                // селектор дополнительного сегмента данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define STACK_SIZE  0x100       // размер стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define SCREEN_ROWS 25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define SCREEN_COLS 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MAX_COLS    60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define TIMER_ROW   1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define TIMER_COL   65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Загрузчик первой стадии (GRUB) загружает образ программы начиная со 2 селектора</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    по адресу 0x0000:0x8000 и передает на него управление: ip = 0x8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Процессор находится в реальном режиме</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Значения сегментных регистров:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cs = 0x0    ds = 0x0    es = 0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ss = 0x0    fs = 0x0    gs = 0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Начало секции кода ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.code16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.global _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $0x3, %ax           // очистка экрана: задаем режим видеоадаптера (80x25, 16-цветный)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int     $0x10               // используем 0x10 прерывание BIOS (ah = 0, al = 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $.data, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $seg_data, %bx      // записываем базовый адрес семента данных в соответствующий дескриптор</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, 2(%bx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $.stack, %ax        // записываем базовый адрес сегмента стека в соответствующий дескриптор</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $seg_stack, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, 2(%bx)         // (для кода и видеобуфера базовые адреса известны)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x100, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw %ax, %sp    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cli                         // запрещаем аппаратные прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $0x80, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $0x70          // запрещаем NMI (немаскируемые прерывания)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inb     $0x92, %al          // включаем А20 адресную линию</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orb     $0x2, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $0x92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lgdt    gdtdesc             // загружаем значение GDTR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lidt    idtdesc             // загружаем значение IDTR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %cr0, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orl     $1, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %eax, %cr0                  // устанавливаем бит PE в регистре CR0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ljmp    $CS, $CS_OFF(goto_prot)     // переходим в новый сегмент кода (cs, ip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Теперь процессор работает в защищенном режиме ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.code32                                 // указание процессору генерировать 32-разрядный код</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goto_prot:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $DS, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, %ds                    // загружаем новый селектор сегмента данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $SS, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, %ss				    // загружаем новый селектор сегмента стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $STACK_SIZE, %esp           // устанавливаем указатель стека на значение на значение &quot;дна&quot; стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $ES, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, %es                    // загружаем селектор сегмента видеобуфера</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $FS, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, %fs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    init_pic                    // инициализация контроллеров прерываний</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $0, %al                     // разрешаем немаскируемые прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $0x70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sti                                 // разрешаем прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call set_pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $320, %bx                   // начальное смещение на экране</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $110, %cx                   // число выводимых символов</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $0x1e01, %ax                // загружаем начальный символ с атрибутом</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">screen:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, %es:(%bx)          // записываем очередной символ в видеопамять</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    $2, %bx                 // смещаемся в видеобуфере</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incw    %ax                     // код следующего символа</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %cx                     // сохраняем cx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $0x0FFFFF, %ecx         // добавим паузу для наглядности</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pause:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop    pause       // цикл паузы</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %cx         // возвращаем cx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop    screen      // цикл вывода на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x30, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw %ax, %gs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Демонстрация записи через вторую таблицу и чтения через первую</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_write_test), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Записываем тестовое значение 0xCAFE через вторую таблицу страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Адрес 0x400100 во второй таблице отображается на физический адрес 0x2100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $0x400100, %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $0xABCDEFED, (%ebx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Выводим значение, которое записали</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_wrote), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $0xABCDEFED, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Теперь читаем то же значение через первую таблицу страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Адрес 0x2100 в первой таблице отображается на тот же физический адрес 0x2100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $0x2100, %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    (%ebx), %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Выводим прочитанное значение</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_read1), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Выводим успешное сообщение, если значения совпадают</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpl    $0xABCDEFED, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jne     mismatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_match), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     hang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mismatch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_mismatch), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hang:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     hang        // зацикливание</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set_pages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	movw $FS, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	movw %ax, %es</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0, %edi // базовый адрес каталога страниц (0x28:0x00) 0x28 - селектор дескриптора с базой 0x9000, т.е. физический адрес каталога страниц 0x9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Инициализация страницы каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl %eax, %eax         # Обнуляем EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x400, %cx        # 1024 записи в странице каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cld                     # Устанавливаем направление вперед</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rep stosl               # Заполняем все записи нулями = &gt; имеем 4КБ начиная с 0x9000 заполненых нулями</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0, %edi           # Адрес страницы каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Настройка первой записи страницы каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0xa000 | 0x03, %eax       # Адрес таблицы страниц + флаги (присутствует, читаемо-записываемо) адрес в физической памяти</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl %eax, %fs:(%edi)           # Записываем адрес таблицы страниц в первую ячейку страницы каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0x1000, %edi              # Возвращаем указатель на начало таблицы страниц (0x28:0x1000 =&gt; 0xa000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Инициализация таблицы страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl %eax, %eax                 # Обнуляем EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x400, %cx                # 1024 записи в таблице страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rep stosl                       # Заполняем все записи нулями = &gt; имеем 4КБ начиная с 0xa000 заполненых нулями</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0x1000, %edi              # Возвращаем указатель на начало таблицы страниц (0x28:0x1000 =&gt; 0xa000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Настройка записей таблицы страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl %eax, %eax             # Обнуляем EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0x03, %eax            # флаги присутствует, читаемо-записываемо</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0xff, %cx             # Инициализируем 256 записей таблицы страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tab1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl %eax, %fs:(%edi)       # Записываем адрес страницы в текущую ячейку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl $0x1000, %eax          # Переходим к следующей странице</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl $4, %edi               # Переходим к следующей записи в таблице страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop tab1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0x04, %edi            # Адрес страницы каталога со смещением в одну запись</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Настройка второй записи страницы каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0xb000 | 0x03, %eax   # Адрес таблицы страниц + флаги (присутствует, читаемо-записываемо) адрес в физической памяти</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl %eax, %fs:(%edi)       # Записываем адрес таблицы страниц во вторую ячейку страницы каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0x2000, %edi          # Возвращаем указатель на начало таблицы страниц (0x28:0x2000 =&gt; 0xb000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Инициализация таблицы страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl %eax, %eax             # Обнуляем EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x400, %cx            # 1024 записи в таблице страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rep stosl                   # Заполняем все записи нулями</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0x2000, %edi          # Возвращаем указатель на начало таблицы страниц (0x28:0x2000 =&gt; 0xb000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Настройка записей таблицы страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl %eax, %eax              # Обнуляем EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0x2003, %eax             # флаги присутствует, читаемо-записываемо</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0xff, %cx              # Инициализируем первые 256 записей таблицы страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tab2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl %eax, %fs:(%edi)       # Записываем адрес страницы в текущую ячейку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl $0x1000, %eax          # Переходим к следующей странице</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl $4, %edi               # Переходим к следующей записи в таблице страниц</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop tab2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl %eax, %eax             # Обнуляем EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Установка PDBR (CR3) на адрес страницы каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl $0x9000, %eax          # Адрес страницы каталога</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl %eax, %cr3             # Загружаем адрес в CR3 (PDBR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %cr0, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orl     $0x80000001, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %eax, %cr0                  // устанавливаем бит PE в регистре CR0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $ES, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw %ax, %es</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">init_pic:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $(ICW1_INIT | ICW1_ICW4_NEEDED), %al    // запись 1-ого слова инициализации в регистр команд</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $MASTER_PIC_COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $SLAVE_PIC_COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $ICW2_MASTER_BASE_VECTOR, %al       // запись базового вектора прерываний для обоих контрллеров</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $MASTER_PIC_DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $ICW2_SLAVE_BASE_VECTOR, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $SLAVE_PIC_DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $ICW3_MASTER, %al           // указание линии IRQ, к которой подключен SLAVE-контроллер</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $MASTER_PIC_DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $ICW3_SLAVE, %al            // указываем номер SLAVE-контроллера в каскаде</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $SLAVE_PIC_DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $ICW4_8086_MODE, %al        // запись последнего слова инициализации</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $MASTER_PIC_COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $SLAVE_PIC_COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $(IRQ2|IRQ3|IRQ4|IRQ5|IRQ6|IRQ7), %al   // инициализация регистров маски обоих контроллеров</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $MASTER_PIC_DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $(IRQ0|IRQ1|IRQ2|IRQ3|IRQ4|IRQ5|IRQ6|IRQ7), %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $SLAVE_PIC_DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Процедуры обработки исключений. Для каждого исключения выводится символическая</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    строка с его названием и значение регистра SP. Для некоторых исключений</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    предпринимаются попытки восстановления. Исключения без собственного обработчика</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    перенаправляются на псевдообработчик (dummy_handler)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 0: Ошибка деления (DE) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">divide_error_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %ebp                  // инициализация указателя кадра стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax                        // сохраняем затрагиваемые регистры в стеке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_DE), %esi      // адрес строки с названием исключения в ESI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %eax                  // значение ESP при выходе в обработчик в EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $12, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str                   // вывод строки</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex                   // вывод указателя стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl                  // переход на следующую строку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    $2, 4(%ebp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax                        // возврат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret                                // возврат из прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 1: Исключение отладки (DB) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug_exception_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %ebp                  // инициализация указателя кадра стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax                        // сохраняем затрагиваемые регистры в стеке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_DB), %esi      // адрес строки с названием исключения в ESI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %eax                  // значение ESP при выходе в обработчик в EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $12, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str                   // вывод строки</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex                   // вывод указателя стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_DB2), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    12(%ebp), %eax              // считываем значение регистра флагов</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex                   // выводим регистр флагов</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl                  // переход на следующую строку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax                        // возврат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret                                // возврат из прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 3: Контрольная точка (BP) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">breakpoint_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi                        // сохраняем затрагиваемые регистры в стеке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_BP), %esi      // адрес строки с названием исключения в ESI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $8, %eax                    // значение ESP при выходе в обработчик в EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex                   // вывод на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi                        // возрат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret                                // возврат из прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 4: Переполнение (OF) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">overflow_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi                        // сохраняем затрагиваемые регистры в стеке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_OF), %esi      // адрес строки с названием исключения в ESI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $8, %eax                    // значение ESP при выходе в обработчик в EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex                   // вывод на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi                        // возрат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret                                // возврат из прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 6: Недопустимая команда (UD) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inval_opcode_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi                        // сохраняем затрагиваемые регистры в стеке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_UD), %esi      // адрес строки с названием исключения в ESI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $8, %eax                    // значение ESP при выходе в обработчик в EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex                   // вывод на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi                        // возрат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 10: Недопустимый TSS (TS) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inval_tss_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     inval_tss_handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 11: Сегмент отсутствует в памяти (NP) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_not_present_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %ebp                  // инициализация указателя кадра стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_NP), %esi      // адрес строки с названием исключения в ESI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $12, %eax                   // значение ESP при входе в обработчик в EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    4(%ebp), %eax               // считываем код ошибки - селектор отсутствующего сегмента</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(GDT), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    %eax, %esi                  // получаем адре дескриптора в GDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    5(%esi), %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orb     $0x80, %al                  // устанавливаем бит присутствия &quot;P&quot; в дескрипторе сегмента</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    %al, 5(%esi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax                        // возврат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $4, %esp                    // удаляем код ошибки (4б) из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret                                // чтобы корректно выйти из прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 12: Ошибка сегмента стека (SS) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stack_seg_fault_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi                        // сохраняем затрагиваемые регистры в стеке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_SS), %esi      // адрес строки с названием исключения в ESI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $8, %eax                    // значение ESP при выходе в обработчик в EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex                   // вывод на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi                        // возрат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 13: Общее исключение защиты (GP) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gen_prot_fault_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi                        // сохраняем затрагиваемые регистры в стеке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_GP), %esi      // адрес строки с названием исключения в ESI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $8, %eax                    // значение ESP при выходе в обработчик в EAX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex                   // вывод на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi                        // возрат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка исключения 14: Страничное нарушение (PF) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">page_fault_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %esp, %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %edi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_PF), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    8(%ebp), %eax      // Получаем код ошибки</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex          // Выводим код ошибки</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_addr), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %cr2, %eax         // Получаем адрес, вызвавший ошибку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_hex          // Выводим адрес</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    8(%ebp), %eax      // Получаем код ошибки снова</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    testl   $0x2, %eax         // Проверяем бит W/R (запись/чтение)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jz      read_fault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_write), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     check_recovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">read_fault:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_read), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_recovery:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Упрощаем - просто выводим сообщение о нарушении без попыток восстановления</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_norecover), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_endl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %edi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addl    $4, %esp           // Удаляем код ошибки</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Обработка всех остальных исключений */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dummy_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(mesg_NH), %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trap_handler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorw %bx, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $110, %cx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $0x2f01, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, %es:(%bx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    $2, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incw    %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %cx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $0x0FFFF, %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop    1b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %cx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop    0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Процедуры вывода на экран строк и чисел. Реализовано простейшее управление терминалом с</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    экраном 80x25 символов. Можно задать правую границу области вывода. При заполнении</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    экрана терминала осуществляется его прокрутка вниз</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Вывод символа на экран в текущую позицию. Осуществляет управление терминалом.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Параметры: %al - код символа, %ah - атрибут. При значении символа &#x27;\n&#x27; = 0xA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    осуществляет перевод на новую строку. При заполнении экрана - прокрутка вниз.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">putchar:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %si                             // сохраняем затрагиваемые регистры в стеке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %di</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ds:DS_OFF(cur_row), %si        // считываем значение текущей строки из памяти</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ds:DS_OFF(cur_col), %di        // считываем значение текущего столбца из памяти</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpb    $&#x27;\n&#x27;, %al                      // если символ &#x27;\n&#x27; = 0xA, то перейти на следующую строку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    je      line_feed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %si, %bx                        // вычисляем адрес видеопамяти, соответствующий текущему положению на экране</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    imulw   $SCREEN_COLS, %bx               // количество столбцаов, задаваемое разрешением экрана</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    %di, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    imulw   $2, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, %es:(%bx)                  // выводим переданный символ в текущую позицию</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incw    %di                             // увеличиваем значение столбца</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpw    $MAX_COLS, %di                  // правая граница вывода в количестве символов. Может быть &lt;=80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jne     skip_lf                         // если превышена, то переход на следующую строку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">line_feed:                                  // переход на следующую строку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorw    %di, %di                        // обнуляем значением столбца</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incw    %si                             // увеличиваем значение столбца</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpw    $SCREEN_ROWS,   %si</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jne     skip_lf                         // если строки заполнены, то прокрутка вниз</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    scroll_screen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">skip_lf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %si, %ds:DS_OFF(cur_row)        // сохранение значений текущих строки и столбца в память</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %di, %ds:DS_OFF(cur_col)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %di</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %si                             // возврат регистров из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scroll_screen:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Процедуры обработки аппаратных прерываний</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timer_ISR:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl    %eax, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpw    $18, %ds:DS_OFF(timer_ticks)    // если количество тиков превысило 18 (секунда)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jle     skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $0, %ds:DS_OFF(timer_ticks)     // обнуляем счетчик тиков</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incw    %ds:DS_OFF(timer_sec)           // увеличиваем счетчик секунд</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ds:DS_OFF(timer_sec), %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    print_time                      // выводим количество секунд на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">skip:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incw    %ds:DS_OFF(timer_ticks)         // увеличиваем счетчик тиков</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $EOI, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $MASTER_PIC_COMMAND        // выдаем команду окончания обработки прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keyboard_ISR:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;     pushl   %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;     movl    $0x7FFFFFF, %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">; 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;     nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;     loop    0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;     popl    %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl    %eax, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl    %esi, %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inb     $0x60, %al                      // считываем полученный скан-код</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $DS_OFF(keymap), %esi           // получаем соответствующий ему код символа</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    (%esi, %eax), %al               // по таблице скан-кодов</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $0x7, %ah</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    putchar                         // выводим его на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inb     $0x61, %al                      // установкой старшего бита и последующим его сбросом</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orb     $0x80, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $0x61                      // сообщим контроллеру клавиатуры о приеме кода символа</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    andb    $0x7f, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $0x61</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $EOI, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outb    %al, $MASTER_PIC_COMMAND        // выдаем команду окончания обработки прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Функция вывода символьной строки на экран.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Параметры: esi - адрес строки. Строка должна заканчиваться нулем &#x27;\0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;\n&#x27; - переход на следующую строку</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_str:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl    %eax, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $0x7, %ah       // белые символы на черном фоне</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    (%esi), %al     // текущий символ строки в al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpb    $0, %al         // пока не достигли конца строки &#x27;\0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    je      1f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incl    %esi            // переход к следующему символу</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    putchar         // вывод символа на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Функция перехода на следующую строку */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_endl:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $&#x27;\n&#x27;, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    putchar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_hex:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl    %ecx, %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %eax, %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    andl    $0xF, %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incl    %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shrl    $4, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpl    $0, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jne     0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpl    $0, %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    je      4f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpw    $10, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jl      2f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subw    $10, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    $&#x27;A&#x27;, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     3f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    $&#x27;0&#x27;, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $0x7, %ah</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    putchar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decl    %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     1b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_time:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %edi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    $TIMER_COL, %edi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorl    %ecx, %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movl    %eax, %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    andl    $0xF, %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw   %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incl    %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shrl    $4, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpl    $0, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jne     0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpl    $0, %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    je      4f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw    %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpw    $10, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jl      2f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subw    $10, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    $&#x27;A&#x27;, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     3f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    $&#x27;0&#x27;, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb    $0x7, %ah</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call    put_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decl    %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp     1b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %edi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">put_time:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushl   %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    $TIMER_ROW, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    imulw   $SCREEN_COLS, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw    %di, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    imulw   $2, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw    %ax, %es:(%bx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incw    %di</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popl    %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text_size = . - _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Начало секции данных ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Глобальная таблица дескрипторов ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.align 16								                                    // процессор быстрее обращается с выровненной таблицей</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GDT:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_null:       .quad   0							                                // нулевой дескриптор</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_text:       descr   (0x8000, 1, EXEC_READ, G_PAGE | SEG_32)       // дескриптор сегмента кода 	(селектор 0x0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_data:       descr   (0x8000, 1, READ_WRITE, G_PAGE | SEG_32)           // дескриптор сегмента данных	(селектор 0x10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_stack:      descr   (0x8000, 1, READ_WRITE, G_PAGE | SEG_32)          // дескриптор сегмента стека	(селектор 0x18)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_videomem:   descr   (0xB8000, 1, READ_WRITE, G_PAGE | SEG_32)               // дескриптор видеобуфера	    (селектор 0x20)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_pages:      descr  (0x9000, 4, READ_WRITE, G_PAGE | SEG_32)  // Дескриптор для страниц (селектор 0x28)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_zero:       descr  (0x0000, 4, READ_WRITE, G_PAGE | SEG_32)  // Дескриптор для страниц (селектор 0x30)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GDT_size = . - GDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gdtdesc:    .word   GDT_size - 1    // предел GDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .long   GDT             // базовый адрес GDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Таблица прерываний ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .align  8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IDT:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*                                                      Вектор      Мнемоника   Описание                            Тип         Код ошибка */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(divide_error_handler) )      // 0        #DE         Ошибка деления                      Fault       Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(debug_exception_handler))   // 1        #DB         Исключение отлпдки                  Fault/Trap  Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null_descr                                          // 2        -           Прерывания NMI                      Interrupt   Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(breakpoint_handler))        // 3        #BP         Контрольная точка                   Trap        Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(overflow_handler))          // 4        #OF         Переполнение                        Trap        Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(dummy_handler))             // 5        #BR         Превышение предела                  Fault       Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(inval_opcode_handler))      // 6        #UD         Недопустимая команда                Fault       Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(dummy_handler))             // 7        #NM         Устройство недостпуно               Fault       Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(dummy_handler))             // 8        #DF         Двойная ошибка                      Abort       Да(ноль)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(dummy_handler))             // 9        -           Превышение сегмента сопроцессора    Fault       Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(inval_tss_handler))         // 10       #TS         Недопустимый TSS                    Fault       Да</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(seg_not_present_handler))   // 11       #NP         Сегмент отсутствует в памяти        Fault       Да</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(stack_seg_fault_handler))   // 12       #SS         Ошибка сегмента стека               Fault       Да</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(gen_prot_fault_handler))    // 13       #GP         Общее исключение защиты             Fault       Да</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(page_fault_handler))        // 14       #PF         Страничное нарушение                Fault       Да</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null_descr                                          // 15       -           Зарезервировано (не использовать)               Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(dummy_handler))             // 16       #MF         Ошибка плавающей точки в x87 FPU    Fault       Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(dummy_handler))             // 17       #AC         Проверка выравнивания               Fault       Да(ноль)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(dummy_handler))             // 18       #MC         Проверка оборудования               Abort       Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trap_gate   (CS, CS_OFF(dummy_handler))             // 19       #XM         Исключение плавающей точки в SIMD   Fault       Нет</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .rept   44                                          // 20-31    -           Зарезервировано (не использовать )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null_descr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .endr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Аппаратные прерывания ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interrupt_gate  (CS, CS_OFF(timer_ISR))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interrupt_gate  (CS, CS_OFF(keyboard_ISR))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .rept   62</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null_descr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .endr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Аппаратные прерывания ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interrupt_gate  (CS, CS_OFF(trap_handler))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IDT_size = . - IDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">idtdesc:    .word   IDT_size - 1    // предел IDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .long   IDT             // базовый адрес IDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">page_directory: .word 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Строки сообщений о исключениях ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Строки сообщений</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_PF: .asciz &quot;Page Fault! Error code = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_addr: .asciz &quot;Faulting address: &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_write: .asciz &quot;Write access&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_read: .asciz &quot;Read access&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_norecover: .asciz &quot;Cannot recover from page fault!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_recover: .asciz &quot;Successfully recovered from page fault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_new_table: .asciz &quot;Creating new page table&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_second: .asciz &quot;Access to the second page table successful&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_write_test: .asciz &quot;Testing memory mapping: &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_wrote: .asciz &quot;Wrote to 0x400100 (second table): &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_read1: .asciz &quot;Read from 0x100 (first table): &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_match: .asciz &quot;SUCCESS: Values match! Memory mapping works correctly.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_mismatch: .asciz &quot;ERROR: Values don&#x27;t match! Memory mapping failed.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_DE:    .asciz  &quot;Divide Error! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_DB:    .asciz  &quot;Debug Exception! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_DB2:   .asciz  &quot; EFLAGS = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_BP:    .asciz  &quot;Breakpoint! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_OF:    .asciz  &quot;Overflow! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_UD:    .asciz  &quot;Invalid Opcode! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_TS:    .asciz  &quot;Invalid TSS! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_NP:    .asciz  &quot;Segment Not Present! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_SS:    .asciz  &quot;Stack-Segment Fault! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_GP:    .asciz  &quot;General Protection Fault! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_NH:    .asciz  &quot;Exception is not handled!!! SP = &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg_time:  .asciz  &quot;TIMER&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keymap:     .asciz  &quot;\000\0001234567890-=\b\tqwertyuiop[]\n\000asdfghjkl;\&#x27;`\000\\zxcvbnm,./\000*\000 `&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  Текущая позиция на экране */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cur_row:    .word   6               // текущая строка</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cur_col:    .word   0               // текущий столбец</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timer_ticks: .word   0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timer_sec:  .word   0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_size = . - .data               // размер секции данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------- Секция стека ----------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .section    .stack, &quot;wa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .align 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .space  STACK_SIZE, &#x27;^&#x27;         // выделим место под стек и заполним его символом &#x27;^&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stack_size = . - .stack             // размер секции стека</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gdth">gdt.h<a href="#gdth" class="hash-link" aria-label="Прямая ссылка на gdt.h" title="Прямая ссылка на gdt.h">​</a></h3>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">EXEC_ONLY</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0x8</span><span class="token macro property expression" style="color:#36acaa">                     </span><span class="token macro property comment" style="color:#999988;font-style:italic">// сегмент кода, только выполнение</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">EXEC_READ</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0xA</span><span class="token macro property expression" style="color:#36acaa">                     </span><span class="token macro property comment" style="color:#999988;font-style:italic">// сегмент кода, чтение и исполнение</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">READ_ONLY</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0x0</span><span class="token macro property expression" style="color:#36acaa">                     </span><span class="token macro property comment" style="color:#999988;font-style:italic">// сегмент данных, только чтение</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">READ_WRITE</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0x2</span><span class="token macro property expression" style="color:#36acaa">                    </span><span class="token macro property comment" style="color:#999988;font-style:italic">// сегмент данных, чтение и запись</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">G_BYTE</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0x0</span><span class="token macro property expression" style="color:#36acaa">                        </span><span class="token macro property comment" style="color:#999988;font-style:italic">// байтовая гранулярность</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">G_PAGE</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0x80</span><span class="token macro property expression" style="color:#36acaa">                       </span><span class="token macro property comment" style="color:#999988;font-style:italic">// страничная гранулярность</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">SEG_16</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0x0</span><span class="token macro property expression" style="color:#36acaa">                        </span><span class="token macro property comment" style="color:#999988;font-style:italic">// 16-разрядный сегмент (D = 0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">SEG_32</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0x40</span><span class="token macro property expression" style="color:#36acaa">                       </span><span class="token macro property comment" style="color:#999988;font-style:italic">// 32-разрядный сегмент (D = 1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">descr</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">base</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> limit</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> type</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> attr</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property punctuation" style="color:#393A34">\</span><span class="token macro property" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token macro property" style="color:#36acaa">	</span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression function" style="color:#d73a49">word</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">limit </span><span class="token macro property expression operator" style="color:#393A34">&amp;</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0xFFFF</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token macro property expression" style="color:#36acaa"> \  </span><span class="token macro property comment" style="color:#999988;font-style:italic">// младшие 16 разрядов предела сегмента</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">word</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFFFF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> \  	</span><span class="token comment" style="color:#999988;font-style:italic">// младшие 16 разрядов базового адреса сегмента</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">byte</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> \	</span><span class="token comment" style="color:#999988;font-style:italic">// байт – третий байт базового адреса сегмента</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">byte</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x90</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> \ 		</span><span class="token comment" style="color:#999988;font-style:italic">// s = 1 сегмент памяти, p = 1 присутствует в ОП + тип сегмента</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">byte</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">attr </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">limit </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> \	</span><span class="token comment" style="color:#999988;font-style:italic">// байт атрибутов + старшие 4 разряда предела сегмента	</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">byte</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// старший байт базового адреса сегмента</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">CS_OFF</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">label</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">label </span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa"> _start</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa">	</span><span class="token macro property comment" style="color:#999988;font-style:italic">// смещение в сегменте кода относительно его начала</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">DS_OFF</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">label</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">label </span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression" style="color:#36acaa">data</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// смещение в сегменте данных относительно его начала</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="idth">idt.h<a href="#idth" class="hash-link" aria-label="Прямая ссылка на idt.h" title="Прямая ссылка на idt.h">​</a></h3>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/*------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    Макроопределение в С-стиле. Создает дескрипторы прерывания, ловушки и</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    задачи с заданными адресами процедур обработки (селектор, смещение)</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-------------------------------------------------------*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">interrupt_gate</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">selector</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> offset</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa">	</span><span class="token macro property punctuation" style="color:#393A34">\</span><span class="token macro property" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression function" style="color:#d73a49">word</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">offset </span><span class="token macro property expression operator" style="color:#393A34">&amp;</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0xFFFF</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token macro property expression" style="color:#36acaa">				\ </span><span class="token macro property comment" style="color:#999988;font-style:italic">// младшие 16 разрядов смещения</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">word</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selector </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFFFF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">			\ </span><span class="token comment" style="color:#999988;font-style:italic">// шестнадцатиразрядный селектор</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">word   </span><span class="token number" style="color:#36acaa">0x8E00</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">							\ </span><span class="token comment" style="color:#999988;font-style:italic">// p = 1 присутствует в ОП, s = 0 системный объект, E тип шлюз прерывания</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">word</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">offset </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFFFF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// старшие 16 разрядов смещения</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">trap_gate</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">selector</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> offset</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa">		</span><span class="token macro property punctuation" style="color:#393A34">\</span><span class="token macro property" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression function" style="color:#d73a49">word</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">offset </span><span class="token macro property expression operator" style="color:#393A34">&amp;</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0xFFFF</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token macro property expression" style="color:#36acaa">			\ </span><span class="token macro property comment" style="color:#999988;font-style:italic">// p = 1, s = 0, F тип шлюз ловушки</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">word</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selector </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFFFF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">		\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">word   </span><span class="token number" style="color:#36acaa">0x8F00</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">						\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">word</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">offset </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFFFF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">task_gate</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">selector</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> offset</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa">		</span><span class="token macro property punctuation" style="color:#393A34">\</span><span class="token macro property" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression" style="color:#36acaa">word   </span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token macro property expression" style="color:#36acaa">							\	</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">word   tss_selector</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">				\  </span><span class="token comment" style="color:#999988;font-style:italic">// селектор TSS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">word   </span><span class="token number" style="color:#36acaa">0x8500</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">						\ </span><span class="token comment" style="color:#999988;font-style:italic">// p = 1, s = 0, 5 тип шлюз задачи</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">word   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">						</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">null_descr</span><span class="token macro property" style="color:#36acaa">  </span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression" style="color:#36acaa">quad   </span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// нулевой дескриптор для GDT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="irqh">irq.h<a href="#irqh" class="hash-link" aria-label="Прямая ссылка на irq.h" title="Прямая ссылка на irq.h">​</a></h3>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">IRQ0</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x1</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Маска для IRQ0 (бит 0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">IRQ1</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x2</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Маска для IRQ1 (бит 1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">IRQ2</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x4</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Маска для IRQ2 (бит 2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">IRQ3</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x8</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Маска для IRQ3 (бит 3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">IRQ4</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x10</span><span class="token macro property expression" style="color:#36acaa">  </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Маска для IRQ4 (бит 4)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">IRQ5</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x20</span><span class="token macro property expression" style="color:#36acaa">  </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Маска для IRQ5 (бит 5)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">IRQ6</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x40</span><span class="token macro property expression" style="color:#36acaa">  </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Маска для IRQ6 (бит 6)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">IRQ7</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x80</span><span class="token macro property expression" style="color:#36acaa">  </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Маска для IRQ7 (бит 7)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">MASTER_PIC_COMMAND</span><span class="token macro property" style="color:#36acaa">      </span><span class="token macro property expression number" style="color:#36acaa">0x20</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// адрес порта ведущего контроллера приоритетных прерываний(КПП) для отправки команд</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">MASTER_PIC_DATA</span><span class="token macro property" style="color:#36acaa">         </span><span class="token macro property expression number" style="color:#36acaa">0x21</span><span class="token macro property expression" style="color:#36acaa">	</span><span class="token macro property comment" style="color:#999988;font-style:italic">// адрес порта ведущего КПП для отправки данных</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">SLAVE_PIC_COMMAND</span><span class="token macro property" style="color:#36acaa">       </span><span class="token macro property expression number" style="color:#36acaa">0xA0</span><span class="token macro property expression" style="color:#36acaa"> 	</span><span class="token macro property comment" style="color:#999988;font-style:italic">// адрес порта ведомого КПП для отправки команд</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">SLAVE_PIC_DATA</span><span class="token macro property" style="color:#36acaa">          </span><span class="token macro property expression number" style="color:#36acaa">0xA1</span><span class="token macro property expression" style="color:#36acaa">	</span><span class="token macro property comment" style="color:#999988;font-style:italic">// адрес порта ведомого КПП для отправки данных</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW1_ICW4_NEEDED</span><span class="token macro property" style="color:#36acaa">        </span><span class="token macro property expression number" style="color:#36acaa">0x1</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Требуется отправка ICW4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW1_SINGLE_MODE</span><span class="token macro property" style="color:#36acaa">        </span><span class="token macro property expression number" style="color:#36acaa">0x2</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Одиночный режим</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW1_INTERVAL4</span><span class="token macro property" style="color:#36acaa">          </span><span class="token macro property expression number" style="color:#36acaa">0x4</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Интервал между адресами векторов = 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW1_LEVEL</span><span class="token macro property" style="color:#36acaa">              </span><span class="token macro property expression number" style="color:#36acaa">0x8</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Уровень прерывания</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW1_INIT</span><span class="token macro property" style="color:#36acaa">               </span><span class="token macro property expression number" style="color:#36acaa">0x10</span><span class="token macro property expression" style="color:#36acaa">  </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Флаг инициализации контроллера</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW2_MASTER_BASE_VECTOR</span><span class="token macro property" style="color:#36acaa">     </span><span class="token macro property expression number" style="color:#36acaa">0x40</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">//  базовый вектор ведущего контроллера</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW2_SLAVE_BASE_VECTOR</span><span class="token macro property" style="color:#36acaa">      </span><span class="token macro property expression number" style="color:#36acaa">0x48</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// базовый вектор ведомого контроллера</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW3_MASTER</span><span class="token macro property" style="color:#36acaa">     </span><span class="token macro property expression number" style="color:#36acaa">0x4</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">//   ведомый подключён по 2 линии</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW3_SLAVE</span><span class="token macro property" style="color:#36acaa">      </span><span class="token macro property expression number" style="color:#36acaa">0x2</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// подключён ко второй линии ведущего</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW4_8086_MODE</span><span class="token macro property" style="color:#36acaa">     </span><span class="token macro property expression number" style="color:#36acaa">0x01</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// режим 8086</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW4_AUTO_EOT</span><span class="token macro property" style="color:#36acaa">      </span><span class="token macro property expression number" style="color:#36acaa">0x02</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">//   автоматическое завершение прерывания</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW4_BUF_SLAVE</span><span class="token macro property" style="color:#36acaa">     </span><span class="token macro property expression number" style="color:#36acaa">0x08</span><span class="token macro property expression" style="color:#36acaa">	</span><span class="token macro property comment" style="color:#999988;font-style:italic">// буферизированный режим ведущего</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW4_BUF_MASTER</span><span class="token macro property" style="color:#36acaa">    </span><span class="token macro property expression number" style="color:#36acaa">0x0C</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// буферизированный режим ведомого</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ICW4_SFNM</span><span class="token macro property" style="color:#36acaa">          </span><span class="token macro property expression number" style="color:#36acaa">0x10</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// специальный полностью вложенный режим</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">EOI</span><span class="token macro property" style="color:#36acaa">                </span><span class="token macro property expression number" style="color:#36acaa">0x20</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// код окончания прерывания, должен быть отправлен в КПП, для снятия  бита в регистре обслуживаемых прерывания</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="boots">boot.s<a href="#boots" class="hash-link" aria-label="Прямая ссылка на boot.s" title="Прямая ссылка на boot.s">​</a></h3>
<p>// программа загружает содержимое первого жёсткого диска(had) начиная со второго сектора диска в память по адресу 0x8000</p>
<div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.code16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.global _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorw %ax, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw %ax, %ds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw %ax, %es</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x8000, %bx       # Буфер для данных (ES:BX = 0x0000:0x8000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x08, %ah         # Функция 08h: Read Drive Parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x80, %dl         # Первый жёсткий диск (DL = 80)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x13 // используем ah = 0x08 для определения максимального номера сектора</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    andb $0x3F, %cl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sub $0x01, %cl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw %cx, %ax // в ax записали максимальный номер сектора (младшая часть ax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x8000, %bx       # Буфер для данных (ES:BX = 0x0000:0x8000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x80, %dl         # Первый жёсткий диск (DL = 80)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $2, %cl            # Начинаем с сектора 2 (CL хранит номер сектора)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load_sectors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pushw %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x02, %ah         # Функция чтения</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $1, %al            # Читаем 1 сектор за раз</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0, %ch            # Цилиндр 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0, %dh            # Головка 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x13               # Чтение сектора</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jc disk_error           # Если ошибка, переходим к обработке</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Вывод сообщения об успешном чтении</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $success_msg, %si  # Загружаем адрес сообщения в SI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print_string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addw $512, %bx          # Сдвигаем буфер на 512 байт</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incb %cl                # Увеличиваем номер сектора</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popw %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpb %al, %cl            # Проверяем, загрузили ли мы все секторы</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jl load_sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">long_jmp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ljmp $0x0000, $0x8000   # Переход к загруженному коду</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disk_error:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Смотрим на ah, если ah=12, то дальний переход на 0x8000, иначе ошибка</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpb $12, %ah</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    je long_jmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $error_msg, %si    # Загружаем адрес сообщения об ошибке в SI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print_string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hlt                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp disk_error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Функция для вывода строки на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_string:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x0E, %ah         # Функция BIOS для вывода символа</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_char:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lodsb                   # Загружаем следующий символ из строки в AL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmpb $0, %al            # Проверяем, достигнут ли конец строки</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    je print_done           # Если да, завершаем вывод</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x10               # Выводим символ на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp print_char          # Переходим к следующему символу</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_done:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Сообщения</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">success_msg: .asciz &quot;Sector read successfully!\r\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_msg: .asciz &quot;Disk read error!\r\n&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linkerld-для-сборки-загрузчика">linker.ld для сборки загрузчика<a href="#linkerld-для-сборки-загрузчика" class="hash-link" aria-label="Прямая ссылка на linker.ld для сборки загрузчика" title="Прямая ссылка на linker.ld для сборки загрузчика">​</a></h3>
<div class="language-ld codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ld codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Указываем точку входа в программу. В данном случае это функция _start. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRY(_start)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Определяем секции и их расположение в памяти. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Устанавливаем текущий адрес (счетчик местоположения) на 0x7C00.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Это стандартный адрес, по которому BIOS загружает загрузочный сектор. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    . = 0x7C00;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .text: содержит исполняемый код программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .text : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.text) /* Включаем все объектные файлы, которые содержат секцию .text. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .data: содержит инициализированные данные программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .data : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.data) /* Включаем все объектные файлы, которые содержат секцию .data. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .stack: выделяет память для стека программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .stack : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.stack) /* Включаем все объектные файлы, которые содержат секцию .stack. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция /DISCARD/: указывает компоновщику отбросить ненужные секции.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Это помогает уменьшить размер итогового бинарного файла. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /DISCARD/ : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.note*)  /* Отбрасываем все секции, начинающиеся с .note (например, отладочные метаданные). */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.comment) /* Отбрасываем секции с комментариями. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.gnu*)   /* Отбрасываем все секции, начинающиеся с .gnu (например, специфичные для GNU атрибуты). */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Перемещаем текущий адрес на 0x7DFE. Это предпоследний байт загрузочного сектора. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    . = 0x7DFE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .sig: добавляет сигнатуру загрузочного сектора.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       BIOS проверяет эту сигнатуру, чтобы убедиться, что сектор является загрузочным. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .sig : AT(0x7DFE) /* Указываем, что эта секция должна быть расположена по адресу 0x7DFE. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SHORT(0xAA55) /* Записываем два байта: 0x55 и 0xAA (в обратном порядке из-за little-endian). */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile-для-сборки-загрузчика">Makefile для сборки загрузчика<a href="#makefile-для-сборки-загрузчика" class="hash-link" aria-label="Прямая ссылка на Makefile для сборки загрузчика" title="Прямая ссылка на Makefile для сборки загрузчика">​</a></h3>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">all: boot.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ld -m elf_i386 -T linker.ld -o boot.elf boot.o # Связываем объектный файл boot.o с использованием скрипта линкера linker.ld, создавая ELF-файл boot.elf. Флаг --gc-sections удаляет неиспользуемые секции для оптимизации.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	objcopy -S -O binary boot.elf boot.img # Конвертируем ELF-файл boot.elf в чистый бинарный файл boot.bin. Флаг -S исключает символы и отладочную информацию, а -O binary указывает формат вывода.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boot.o: boot.S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	as --32 -o boot.o boot.S # Компилируем программу для архитектуры x86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm *.o *.elf  *.img # Удаляем всё лишнее</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/efremovnv/docs/edit/main/website/docs/peripheral-devices/lab4.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Отредактировать эту страницу</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Последнее обновление<!-- --> <b><time datetime="2025-11-22T17:49:14.000Z" itemprop="dateModified">22 нояб. 2025 г.</time></b></span></div></div></footer></article><div class="margin-top--lg"><button class="button button--secondary button--sm">📄 Скачать PDF</button></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/labs/peripheral-devices/lab3"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">Лабораторная работа №3</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/labs/computer-organization/lab7"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">Лабораторная работа №7</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#контекст" class="table-of-contents__link toc-highlight">Контекст</a></li><li><a href="#сокращения" class="table-of-contents__link toc-highlight">Сокращения</a></li><li><a href="#цель-работы" class="table-of-contents__link toc-highlight">Цель работы</a></li><li><a href="#необходимые-инструменты" class="table-of-contents__link toc-highlight">Необходимые инструменты</a></li><li><a href="#исходные-файлы-лабораторной-работы" class="table-of-contents__link toc-highlight">Исходные файлы лабораторной работы</a></li><li><a href="#материалы-для-подготовки-к-лабораторной-работе" class="table-of-contents__link toc-highlight">Материалы для подготовки к лабораторной работе</a><ul><li><a href="#страничная-организация-памяти" class="table-of-contents__link toc-highlight">Страничная организация памяти</a></li><li><a href="#таблицы-и-каталоги-страниц" class="table-of-contents__link toc-highlight">Таблицы и каталоги страниц</a></li><li><a href="#таблица-страниц" class="table-of-contents__link toc-highlight">Таблица страниц</a></li><li><a href="#каталог-страниц" class="table-of-contents__link toc-highlight">Каталог страниц</a></li><li><a href="#регистр-pdbr" class="table-of-contents__link toc-highlight">Регистр PDBR</a></li><li><a href="#включение-страничного-преобразования" class="table-of-contents__link toc-highlight">Включение страничного преобразования</a></li></ul></li><li><a href="#чеклист-выполнения" class="table-of-contents__link toc-highlight">Чеклист выполнения</a></li><li><a href="#выполнение-лабораторной-работы" class="table-of-contents__link toc-highlight">Выполнение лабораторной работы</a><ul><li><a href="#часть-1-подготовка-к-выполнению-лабораторной-работы" class="table-of-contents__link toc-highlight">Часть 1. Подготовка к выполнению лабораторной работы</a></li><li><a href="#часть-2-выполнение-лабораторной-работы-4" class="table-of-contents__link toc-highlight">Часть 2. Выполнение лабораторной работы 4</a></li><li><a href="#часть-3-индивидуальное-задание" class="table-of-contents__link toc-highlight">Часть 3. Индивидуальное задание</a></li></ul></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li><li><a href="#дополнительные-материалы" class="table-of-contents__link toc-highlight">Дополнительные материалы</a></li><li><a href="#приложение" class="table-of-contents__link toc-highlight">Приложение</a><ul><li><a href="#makefile" class="table-of-contents__link toc-highlight">Makefile</a></li><li><a href="#linkerld" class="table-of-contents__link toc-highlight">linker.ld</a></li><li><a href="#makefile-1" class="table-of-contents__link toc-highlight">Makefile</a></li><li><a href="#lab4s" class="table-of-contents__link toc-highlight">lab4.S</a></li><li><a href="#gdth" class="table-of-contents__link toc-highlight">gdt.h</a></li><li><a href="#idth" class="table-of-contents__link toc-highlight">idt.h</a></li><li><a href="#irqh" class="table-of-contents__link toc-highlight">irq.h</a></li><li><a href="#boots" class="table-of-contents__link toc-highlight">boot.s</a></li><li><a href="#linkerld-для-сборки-загрузчика" class="table-of-contents__link toc-highlight">linker.ld для сборки загрузчика</a></li><li><a href="#makefile-для-сборки-загрузчика" class="table-of-contents__link toc-highlight">Makefile для сборки загрузчика</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">efremovnv</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Начало</a></li></ul></div><div class="col footer__col"><div class="footer__title">Ресурсы</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 efremovnv. Создано с помощью Docusaurus.</div></div></div></footer></div>
</body>
</html>