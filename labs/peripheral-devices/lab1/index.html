<!doctype html>
<html lang="ru-RU" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-peripheral-devices/lab1" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Лабораторная работа №1 | efremovnv</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" name="twitter:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" property="og:url" content="https://efremovnv.github.io/docs/labs/peripheral-devices/lab1"><meta data-rh="true" property="og:locale" content="ru_RU"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Лабораторная работа №1 | efremovnv"><meta data-rh="true" name="description" content="Запуск программы в эмуляторе процессора i386 и её отладка."><meta data-rh="true" property="og:description" content="Запуск программы в эмуляторе процессора i386 и её отладка."><link data-rh="true" rel="icon" href="/docs/img/logo2.svg"><link data-rh="true" rel="canonical" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab1"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab1" hreflang="ru-RU"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab1" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.b2f4074e.css">
<script src="/docs/assets/js/runtime~main.f7f1290e.js" defer="defer"></script>
<script src="/docs/assets/js/main.647d6c6e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/logo.svg"><link rel="preload" as="image" href="/docs/img/logo-dark.svg"><div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo-dark.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">efremovnv</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/labs/intro">Методички</a><a class="navbar__item navbar__link" href="/docs/labs/contributing">Контрибьюция</a><a class="navbar__item navbar__link" href="/docs/labs/links">Ссылки</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-label="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/labs/intro">Учебные материалы по организации ЭВМ и систем</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/labs/peripheral-devices/lab1">Периферийные устройства</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/labs/peripheral-devices/lab1">Лабораторная работа №1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab2">Лабораторная работа №2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab3">Лабораторная работа №3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab4">Лабораторная работа №4</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/computer-organization/lab7">Организация ЭВМ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/course-work/rp-op-design">Курсовая работа</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Периферийные устройства</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Лабораторная работа №1</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><header><h1>Лабораторная работа №1</h1></header>
<p>Запуск программы в эмуляторе процессора i386 и её отладка.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="контекст">Контекст<a href="#контекст" class="hash-link" aria-label="Прямая ссылка на Контекст" title="Прямая ссылка на Контекст">​</a></h2>
<ul>
<li><strong>Для кого:</strong> Студенты курса &quot;Периферийные устройства&quot;, начинающие изучение низкоуровневого программирования.</li>
<li><strong>Цель:</strong> Научиться работать с инструментами разработки (ассемблер, линкер, make), эмулятором QEMU и отладчиком GDB. Понять, как взаимодействовать с BIOS для работы с диском.</li>
<li><strong>Необходимые знания:</strong> Базовое понимание командной строки Linux, систем счисления (двоичная, шестнадцатеричная).</li>
<li><strong>Расположение файлов:</strong> Исходный код и скрипты приведены в разделе &quot;Приложение&quot;.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="сокращения">Сокращения<a href="#сокращения" class="hash-link" aria-label="Прямая ссылка на Сокращения" title="Прямая ссылка на Сокращения">​</a></h2>
<ul>
<li><strong>BIOS</strong> – Base Input/Output System – базовая система ввода/вывода</li>
<li><strong>WSL</strong> – Windows Subsystem for Linux – подсистема Windows для Linux</li>
<li><strong>MBR</strong> – Master Boot Record – главная загрузочная запись</li>
<li><strong>CHS</strong> – Cylinder-Head-Sector – цилиндр-головка-сектор</li>
<li><strong>GPT</strong> – GUID (Globally Unique Identifier) Partition Table – таблица разделов глобальных уникальных идентификаторов</li>
<li><strong>LBA</strong> – Logical Block Addressing – логическая блочная адресация</li>
<li><strong>AT&amp;T</strong> – American Telephone and Telegraph</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="цель-работы">Цель работы<a href="#цель-работы" class="hash-link" aria-label="Прямая ссылка на Цель работы" title="Прямая ссылка на Цель работы">​</a></h2>
<p>Целью данной лабораторной работы является изучение низкоуровнего взаимодействия программы с аппаратным обеспечением, в частности, с дисковыми накопителями, через функции BIOS (Base Input-Output System)(int 13h).</p>
<p>В процессе выполнения работы студенты:</p>
<ul>
<li>Освоят инструменты низкоуровневой разработки</li>
<li>Научатся создавать и использовать утилиту Makefile для автоматизации сборки проекта</li>
<li>Овладеют навыками эмуляции работы программы на процессорах архитектуры X86 с помощью эмулятора QEMU</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="необходимые-инструменты">Необходимые инструменты<a href="#необходимые-инструменты" class="hash-link" aria-label="Прямая ссылка на Необходимые инструменты" title="Прямая ссылка на Необходимые инструменты">​</a></h2>
<ul>
<li>Любой дистрибутив GNU/Linux: рекомендуется Ubuntu, также можно использовать виртуальную машину, например, WSL (Windows Subsystem for Linux)</li>
<li>Ассемблер: <code>as</code></li>
<li>Компоновщик: <code>ld</code></li>
<li>Утилиты для анализа объектных файлов: <code>objdump</code>, <code>readelf</code></li>
<li>Утилита для работы с дисками: <code>dd</code></li>
<li>Отладчик: <code>gdb</code></li>
<li>Эмулятор: <code>qemu</code></li>
<li>Утилиты для автоматизации сборки проектов: <code>make</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="исходные-файлы-лабораторной-работы">Исходные файлы лабораторной работы<a href="#исходные-файлы-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Исходные файлы лабораторной работы" title="Прямая ссылка на Исходные файлы лабораторной работы">​</a></h2>
<p>Файлы, которые используются в первой лабораторной работе:</p>
<ul>
<li><strong>Makefile</strong> - скрипт для автоматизированной сборки проекта</li>
<li><strong>disk_device</strong> - образ виртуального диска, имитирующий внешний накопитель для чтения/записи данных</li>
<li><strong>linker.ld</strong> - скрипт линковщика</li>
<li><strong>lab1.s</strong> - содержит программу на ассемблере, реализующую низкоуровневое взаимодействие с диском через функции BIOS</li>
<li><strong>create_disk_device.sh</strong> - bash-скрипт для создания файла образа внешнего диска</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="материалы-для-подготовки-к-лабораторной-работе">Материалы для подготовки к лабораторной работе<a href="#материалы-для-подготовки-к-лабораторной-работе" class="hash-link" aria-label="Прямая ссылка на Материалы для подготовки к лабораторной работе" title="Прямая ссылка на Материалы для подготовки к лабораторной работе">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="блочные-устройства-внешней-памяти">Блочные устройства внешней памяти<a href="#блочные-устройства-внешней-памяти" class="hash-link" aria-label="Прямая ссылка на Блочные устройства внешней памяти" title="Прямая ссылка на Блочные устройства внешней памяти">​</a></h3>
<p>Это аппаратные компоненты, предназначенные для хранения данных, например, жёсткие диски, SSD, CD-ROM и другие накопители. Они обрабатывают данные блоками фиксированного размера.</p>
<p><img decoding="async" loading="lazy" alt="1763502560341" src="/docs/assets/images/1763502560341-c358cc0c4e904c1a615d0c8f4d118602.png" width="490" height="318" class="img_ev3q"></p>
<p><strong>Цилиндр</strong> — совокупность всех дорожек в заданном положении головок.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="загрузочный-сектор-mbr---master-boot-record">Загрузочный сектор (MBR - Master Boot Record)<a href="#загрузочный-сектор-mbr---master-boot-record" class="hash-link" aria-label="Прямая ссылка на Загрузочный сектор (MBR - Master Boot Record)" title="Прямая ссылка на Загрузочный сектор (MBR - Master Boot Record)">​</a></h3>
<p>Это первый сектор на диске (512 байт), который используется BIOS для запуска операционной системы. После включения компьютера BIOS выполняет следующие действия:</p>
<ol>
<li>Инициализация оборудования.</li>
<li>Считывание первого сектора выбранного загрузочного устройства (жесткого диска, USB, CD/DVD).</li>
<li>Загрузка содержимого этого сектора в оперативную память по фиксированному адресу (обычно 0x7C00).</li>
<li>Передача управления коду по этому адресу.</li>
</ol>
<p>Этот процесс работает на архитектуре x86, где процессор после включения питания запускается в режиме реальной адресации (real mode). В этом режиме обращение к памяти осуществляется с использованием двух шестнадцатиразрядных компонентов адреса — первый задает базовый адрес сегмента в ОП, второй смещение внутри сегмента.</p>
<p><strong>MBR состоит из:</strong></p>
<ul>
<li>Первоначального кода (обычно 446 байт).</li>
<li>Таблицы разделов (64 байта), которая содержит информацию о структуре разделов на диске.</li>
<li>Подписи (2 байта, значение 0x55AA), которая сообщает BIOS, что сектор является загрузочным.</li>
</ul>
<p>Процессоры семейства x86 (например, i386) поддерживают сегментную модель адресации памяти. Это значит, что адрес задается с помощью двух значений:</p>
<ul>
<li><strong>Сегмент</strong>: базовый адрес, указывающий на начало области памяти.</li>
<li><strong>Смещение</strong>: относительный адрес внутри сегмента.</li>
</ul>
<p>Когда BIOS загружает MBR в память, он устанавливает сегментные регистры (например, CS) так, чтобы код MBR был доступен по адресу 0x7C00. После этого выполнение кода продолжается с адреса 0x7C00.</p>
<p>Этот подход позволяет писать минимальные программы, которые будут сразу выполняться, так как BIOS гарантирует правильное размещение и передачу управления.</p>
<p>Подробнее о процессе загрузки MBR можно почитать: <a href="https://wiki.osdev.org/MBR" target="_blank" rel="noopener noreferrer">https://wiki.osdev.org/MBR</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bios">BIOS<a href="#bios" class="hash-link" aria-label="Прямая ссылка на BIOS" title="Прямая ссылка на BIOS">​</a></h3>
<p>Выполняет ключевую роль в начальной загрузке системы.</p>
<p><strong>Основные функции BIOS:</strong></p>
<ul>
<li>Проверка оборудования (POST — Power-On Self Test).</li>
<li>Настройка начального окружения для выполнения программ (установка сегментных регистров, загрузка MBR).</li>
<li>Обеспечение начального взаимодействия с памятью и устройствами ввода-вывода.</li>
</ul>
<p>BIOS предоставляет минимальное окружение для выполнения программ, что делает возможным выполнение даже простого машинного кода, записанного в MBR.</p>
<p>QEMU эмулирует поведение реального компьютера, включая BIOS и процессор.</p>
<p><strong>Функции BIOS int 13h</strong> предоставляют низкоуровневый интерфейс для работы с дисковыми накопителями. Они позволяют читать и записывать данные на диск, а также выполнять другие операции, такие как сброс диска (рекалибровку контроллера диска, в ходе которой головки устанавливаются на нулевую дорожку) и проверка его состояния.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="чтение-секторов-ah--02h">Чтение секторов (AH = 02h)<a href="#чтение-секторов-ah--02h" class="hash-link" aria-label="Прямая ссылка на Чтение секторов (AH = 02h)" title="Прямая ссылка на Чтение секторов (AH = 02h)">​</a></h4>
<p><strong>Параметры:</strong></p>
<ul>
<li><code>AH = 02h</code> - функция чтения</li>
<li><code>AL</code> - количество секторов для чтения</li>
<li><code>CH</code> - номер цилиндра</li>
<li><code>CL</code> - номер сектора</li>
<li><code>DH</code> - номер головки</li>
<li><code>DL</code> - номер диска</li>
<li><code>ES:BX</code> - адрес буфера для данных</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="запись-секторов-ah--03h">Запись секторов (AH = 03h)<a href="#запись-секторов-ah--03h" class="hash-link" aria-label="Прямая ссылка на Запись секторов (AH = 03h)" title="Прямая ссылка на Запись секторов (AH = 03h)">​</a></h4>
<p><strong>Параметры:</strong></p>
<ul>
<li><code>AH = 03h</code> - функция записи</li>
<li><code>AL</code> - количество секторов для записи</li>
<li><code>CH</code> - номер цилиндра</li>
<li><code>CL</code> - номер сектора</li>
<li><code>DH</code> - номер головки</li>
<li><code>DL</code> - номер диска</li>
<li><code>ES:BX</code> - адрес буфера в памяти, откуда будут взяты данные для записи</li>
</ul>
<p><strong>Примечание!</strong></p>
<p>Регистр CX содержит как номер цилиндра (10 бит, возможные значения от 0 до 1023), так и номер сектора (6 бит, возможные значения от 1 до 63). Биты цилиндра и сектора распределены следующим образом.</p>
<p><img decoding="async" loading="lazy" alt="1763502608199" src="/docs/assets/images/1763502608199-6873547e75d715d77205c273720a6cc8.png" width="339" height="90" class="img_ev3q"></p>
<p><strong>После выполнения функций AH=02h и AH=03h:</strong></p>
<ul>
<li>Флаг CF (0 - операция успешно выполнена или 1 - произошла ошибка)</li>
<li>AH - код ошибки (если CF = 1)</li>
<li>AL - количество записанных секторов</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="чтение-секторов-ah--42h">Чтение секторов (AH = 42h)<a href="#чтение-секторов-ah--42h" class="hash-link" aria-label="Прямая ссылка на Чтение секторов (AH = 42h)" title="Прямая ссылка на Чтение секторов (AH = 42h)">​</a></h4>
<p><strong>Параметры:</strong></p>
<ul>
<li><code>DL</code> - номер диска</li>
<li><code>DS:SI</code> - указатель на структуру DAP (Disk Address Packet)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="запись-секторов-ah--43h">Запись секторов (AH = 43h)<a href="#запись-секторов-ah--43h" class="hash-link" aria-label="Прямая ссылка на Запись секторов (AH = 43h)" title="Прямая ссылка на Запись секторов (AH = 43h)">​</a></h4>
<p><strong>Параметры:</strong></p>
<ul>
<li><code>AL</code> — нулевой бит сброшен - отключить проверку записи, нулевой бит установлен - включить проверку записи, остальные биты зарезервированы, должны быть сброшены</li>
<li><code>DL</code> - номер диска</li>
<li><code>DS:SI</code> - указатель на структуру DAP</li>
</ul>
<p><strong>После выполнения функций AH=42h и AH=43h:</strong></p>
<ul>
<li>Флаг CF (0 - операция успешно выполнена или 1 - произошла ошибка)</li>
<li>AH - код ошибки (если CF = 1)</li>
</ul>
<p><strong>Другие функции int 13h:</strong></p>
<ul>
<li>Сброс диска (AH = 00h)</li>
<li>Проверка состояния диска (AH = 01h)</li>
<li>Получение параметров диска (AH = 08h)</li>
</ul>
<p>Подробнее о процессе загрузки BIOS можно почитать: <a href="https://wiki.osdev.org/BIOS" target="_blank" rel="noopener noreferrer">https://wiki.osdev.org/BIOS</a></p>
<p>Подробнее о функциях можно почитать: <a href="https://en.wikipedia.org/wiki/INT_13H" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/INT_13H</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="адресация-дисков">Адресация дисков<a href="#адресация-дисков" class="hash-link" aria-label="Прямая ссылка на Адресация дисков" title="Прямая ссылка на Адресация дисков">​</a></h3>
<p>Для работы с дисками используются два основных метода адресации:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="chs-cylinder-head-sector">CHS (Cylinder-Head-Sector)<a href="#chs-cylinder-head-sector" class="hash-link" aria-label="Прямая ссылка на CHS (Cylinder-Head-Sector)" title="Прямая ссылка на CHS (Cylinder-Head-Sector)">​</a></h4>
<ul>
<li><strong>Цилиндр (Cylinder)</strong> - вертикальная координата</li>
<li><strong>Головка (Head)</strong> - горизонтальная координата</li>
<li><strong>Сектор (Sector)</strong> - угловая координата, выбирающая конкретный блок данных на дорожке</li>
</ul>
<p>Ранний метод предоставления адресов каждому физическому блоку данных на жёстком диске. В середине 1980-х годов CHS был заменён на LBA (Logical Block Addressing) - линейную адресацию.</p>
<p>В начале 2010-х годов ограничения MBR (связанные с CHS) стали проблематичными. GPT (GUID (Globally Unique Identifier) Partition Table) была разработана как замена MBR.</p>
<p>Современные компьютеры с UEFI (Unified Extensible Firmware Interface) больше не используют CHS, так как GPT и LBA полностью устранили необходимость в этом методе адресации.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="lba-logical-block-addressing">LBA (Logical Block Addressing)<a href="#lba-logical-block-addressing" class="hash-link" aria-label="Прямая ссылка на LBA (Logical Block Addressing)" title="Прямая ссылка на LBA (Logical Block Addressing)">​</a></h4>
<p>Линейная адресация блоков - это метод адресации данных на жёстком диске, который использует линейную (последовательную) нумерацию блоков вместо трёхмерной системы координат, как в CHS. LBA упрощает адресацию данных и устраняет необходимость знать физическую геометрию диска.</p>
<p>Каждому блоку данных на диске присваивается уникальный номер, начиная с 0. Например:</p>
<ul>
<li>Блок 0 - первый сектор на диске</li>
<li>Блок 1 - второй сектор</li>
<li>Блок N - (N+1)-й сектор</li>
</ul>
<p>Обычно размер одного блока (сектора) составляет 512 байт.</p>
<p>Контроллер диска автоматически преобразует линейный адрес (LBA) в физический адрес (CHS, если это необходимо).</p>
<p>Операционная система и программы работают только с линейными адресами, не заботясь о физической геометрии диска.</p>
<p><strong>Формулы преобразования LBA в CHS и обратно (для понимания):</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C = LBA / (HPC * SPT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">H = (LBA / SPT) % HPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S = (LBA % SPT) + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LBA = (C * HPC + H) * SPT + (S - 1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Где:</p>
<ul>
<li>C, H и S - номер цилиндра, номера головки и номер сектора</li>
<li>LBA - адрес логического блока</li>
<li>HPC - максимальное количество головок на цилиндр</li>
<li>SPT - максимальное количество секторов на дорожку</li>
</ul>
<p>Подробнее о CHS можно почитать: <a href="https://en.wikipedia.org/wiki/Cylinder-head-sector" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Cylinder-head-sector</a></p>
<p>Подробнее о LBA можно почитать: <a href="https://en.wikipedia.org/wiki/Logical_block_addressing" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Logical_block_addressing</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="синтаксис-att-american-telephone-and-telegraph">Синтаксис AT&amp;T (American Telephone and Telegraph)<a href="#синтаксис-att-american-telephone-and-telegraph" class="hash-link" aria-label="Прямая ссылка на Синтаксис AT&amp;T (American Telephone and Telegraph)" title="Прямая ссылка на Синтаксис AT&amp;T (American Telephone and Telegraph)">​</a></h3>
<p><strong>Порядок операндов:</strong> команда, источник, приёмник.</p>
<p>Размерность операндов указывается в суффиксах добавляемых к мнемоникам команд, например, <code>movb</code> соответствует <code>mov byte ptr</code> в синтаксисе intel. Суффикс <code>w</code> — слово (2 байта), <code>l</code> — двойное слово (4 байта).</p>
<p><strong>Регистровая адресация:</strong> Префикс <code>%</code> означает имя регистра</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Intel:  xor eax, eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AT&amp;T:   xorl %eax, %eax</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Непосредственная адресация:</strong> <code>$</code> - непосредственный операнд</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Intel:  mov edx, offset variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AT&amp;T:   movl $variable, %edx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Прямая адресация</strong> использует немодифицированное имя переменной</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Intel:  push dword ptr variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AT&amp;T:   pushl variable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Схема адресации:</strong> смещение (база, индекс, множитель) = база + индекс * множитель + смещение. Например, <code>base_addr(%ebx, %edi, 4)</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gnu-as">GNU as<a href="#gnu-as" class="hash-link" aria-label="Прямая ссылка на GNU as" title="Прямая ссылка на GNU as">​</a></h3>
<p>Ассемблер, который преобразует исходный код на языке ассемблера в объектный файл.</p>
<p><strong>Основные возможности:</strong></p>
<ul>
<li>Поддержка синтаксиса AT&amp;T.</li>
<li>Разделение кода на секции <code>.text</code> (код), <code>.data</code> (данные) и <code>.bss</code> (незанятая память).</li>
<li>Генерация объектного файла, который будет передан компоновщику.</li>
</ul>
<p>Подробнее про ассемблер: <a href="https://sourceware.org/binutils/docs/as/" target="_blank" rel="noopener noreferrer">https://sourceware.org/binutils/docs/as/</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gnu-ld">GNU ld<a href="#gnu-ld" class="hash-link" aria-label="Прямая ссылка на GNU ld" title="Прямая ссылка на GNU ld">​</a></h3>
<p>Компоновщик, который объединяет объектные файлы в исполняемый или бинарный файл.</p>
<p>Подробнее о компоновщике: <a href="https://sourceware.org/binutils/docs/ld/" target="_blank" rel="noopener noreferrer">https://sourceware.org/binutils/docs/ld/</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="objcopy">objcopy<a href="#objcopy" class="hash-link" aria-label="Прямая ссылка на objcopy" title="Прямая ссылка на objcopy">​</a></h3>
<p>Утилита для преобразования форматов файлов. В лабораторной работе используется для преобразования ELF-файла в плоский бинарный формат.</p>
<p><strong>ELF (Executable and Linkable Format)</strong> файл — формат исполняемых двоичных файлов, используемый во многих современных UNIX-подобных системах, таких как FreeBSD, GNU/Linux, Solaris и др.</p>
<p>Подробнее про ELF формат можно прочитать: <a href="http://www.sco.com/developers/gabi/latest/contents.html" target="_blank" rel="noopener noreferrer">http://www.sco.com/developers/gabi/latest/contents.html</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dd">dd<a href="#dd" class="hash-link" aria-label="Прямая ссылка на dd" title="Прямая ссылка на dd">​</a></h3>
<p>Утилита для работы с блочными устройствами. В лабораторной работе используется для записи бинарного файла в первый сектор образа диска.</p>
<p>Подробнее о dd: <a href="https://www.opennet.ru/man.shtml?topic=dd&amp;russian=1&amp;category=&amp;submit=%F0%CF%CB%C1%DA%C1%D4%D8+man" target="_blank" rel="noopener noreferrer">https://www.opennet.ru/man.shtml?topic=dd&amp;russian=1&amp;category=&amp;submit=%F0%CF%CB%C1%DA%C1%D4%D8+man</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="objdump">objdump<a href="#objdump" class="hash-link" aria-label="Прямая ссылка на objdump" title="Прямая ссылка на objdump">​</a></h3>
<p>Утилита для анализа объектных и бинарных файлов. Позволяет дизассемблировать файл и увидеть машинный код, соответствующий вашему ассемблерному коду.</p>
<p>Подробнее об objdump: <a href="https://www.opennet.ru/man.shtml?topic=objdump&amp;russian=1&amp;category=&amp;submit=%F0%CF%CB%C1%DA%C1%D4%D8+man" target="_blank" rel="noopener noreferrer">https://www.opennet.ru/man.shtml?topic=objdump&amp;russian=1&amp;category=&amp;submit=%F0%CF%CB%C1%DA%C1%D4%D8+man</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="readelf">readelf<a href="#readelf" class="hash-link" aria-label="Прямая ссылка на readelf" title="Прямая ссылка на readelf">​</a></h3>
<p>Утилита для анализа ELF-файлов. Отображает таблицы сегментов, секций, символов и другие метаданные.</p>
<p>Подробнее о readelf: <a href="https://www.opennet.ru/man.shtml?topic=readelf&amp;category=1&amp;russian=1" target="_blank" rel="noopener noreferrer">https://www.opennet.ru/man.shtml?topic=readelf&amp;category=1&amp;russian=1</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="qemu">QEMU<a href="#qemu" class="hash-link" aria-label="Прямая ссылка на QEMU" title="Прямая ссылка на QEMU">​</a></h3>
<p>Эмулятор архитектуры x86, который позволяет запускать программы на виртуальном оборудовании.</p>
<p>Подробнее о QEMU можно узнать по ссылке: <a href="https://www.qemu.org/documentation/" target="_blank" rel="noopener noreferrer">https://www.qemu.org/documentation/</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="как-работать-с-gdb">Как работать с GDB?<a href="#как-работать-с-gdb" class="hash-link" aria-label="Прямая ссылка на Как работать с GDB?" title="Прямая ссылка на Как работать с GDB?">​</a></h3>
<ul>
<li><code>b *адрес</code> - установить точку останова по адресу, b — от слова break(прервать).</li>
<li><code>x/40i</code> - дизассемблировать 40 инструкций, начиная с адреса, x — от слова examine(исследовать)</li>
<li><code>display/i $eip</code> - отображать следующую инструкцию при каждом шаге</li>
<li><code>c</code> - продолжить выполнение программы до следующей точки останова, c — от слова continue(продолжить)</li>
<li><code>stepi</code> - выполнить одну инструкцию (ассемблерный шаг)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="вопросы-для-самоконтроля">Вопросы для самоконтроля<a href="#вопросы-для-самоконтроля" class="hash-link" aria-label="Прямая ссылка на Вопросы для самоконтроля" title="Прямая ссылка на Вопросы для самоконтроля">​</a></h2>
<ol>
<li>Что такое BIOS?</li>
<li>Что такое MBR и какова его структура? Как BIOS определяет загрузочный сектор?</li>
<li>Объясните, что такое CHS и LBA. В чем их отличия?</li>
<li>Какие функции BIOS int 13h используются для чтения и записи данных на диск? Опишите их параметры.</li>
<li>Что означает режим реальной адресации (real mode) в архитектуре x86? Как BIOS передает управление коду, находящемуся по адресу 0x7C00?</li>
<li>Что такое GPT, и почему она была разработана как замена MBR?</li>
<li>Какие инструменты необходимы для сборки программы на ассемблере под архитектуру i386? Перечислите их и укажите их назначение.</li>
<li>Что такое Makefile, и для чего он используется? Приведите пример простого Makefile.</li>
<li>Объясните, как работает команда dd и для чего она используется в лабораторной работе.</li>
<li>Что такое ELF-формат файла? Для чего используется утилита objcopy?</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="выполнение-лабораторной-работы">Выполнение лабораторной работы<a href="#выполнение-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Выполнение лабораторной работы" title="Прямая ссылка на Выполнение лабораторной работы">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-1-подготовка-к-выполнению-лабораторной-работы">Часть 1. Подготовка к выполнению лабораторной работы<a href="#часть-1-подготовка-к-выполнению-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Часть 1. Подготовка к выполнению лабораторной работы" title="Прямая ссылка на Часть 1. Подготовка к выполнению лабораторной работы">​</a></h3>
<p>Установите все необходимые инструменты для выполнения первой лабораторной работы.</p>
<p>Для Ubuntu ввести следующую команду:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install qemu-system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>— установка эмулятора qemu, все остальные инструменты обычно присутствуют по-умолчанию.</p>
<p>Проверить наличие всех необходимых инструментов можно с помощью команды:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">whereis cpp as ld make objdump readelf gdb dd qemu-system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="1763502684981" src="/docs/assets/images/1763502684981-df77ff919a5c72c7194d20b33d5a5353.png" width="438" height="177" class="img_ev3q"></p>
<p>Если в выводе путь к исполняемому файлу отсутствует, введите команду:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install &lt;название_инструмента_который_отсутствует&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Для установки as, ld, objdump, readelf необходимо установить binutils:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install binutils</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>Создайте директорию для выполнения лабораторной работы <code>mkdir lab1</code> и перейти в неё <code>cd lab1</code></li>
<li>Создайте файл <code>lab1.S</code> и запишите в него код программы, предоставленный в приложении</li>
<li>Создайте файл <code>Makefile</code>, запишите в него скрипт сборки, предоставленный в приложении</li>
<li>Создайте файл <code>create_disk_device.sh</code>, запишите в него скрипт создания файла образа диска, предоставленный в приложении</li>
<li>Создайте файл <code>disk_device</code> используя скрипт <code>create_disk_device.sh</code>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./create_disk_device.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-2-ручная-сборка-и-запуск-программы">Часть 2. Ручная сборка и запуск программы<a href="#часть-2-ручная-сборка-и-запуск-программы" class="hash-link" aria-label="Прямая ссылка на Часть 2. Ручная сборка и запуск программы" title="Прямая ссылка на Часть 2. Ручная сборка и запуск программы">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-ассемблируем-исходный-код-программы-в-объектный-файл">2.1. Ассемблируем исходный код программы в объектный файл<a href="#21-ассемблируем-исходный-код-программы-в-объектный-файл" class="hash-link" aria-label="Прямая ссылка на 2.1. Ассемблируем исходный код программы в объектный файл" title="Прямая ссылка на 2.1. Ассемблируем исходный код программы в объектный файл">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">as --32 -o lab1.o lab1.S</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Ключи команды:</strong></p>
<ul>
<li><code>--32</code> - этот ключ указывает ассемблеру, что нужно генерировать 32 разрядный код</li>
<li><code>-o lab1.o</code> - этот ключ указывает имя выходного объектного файла</li>
<li><code>lab1.S</code> - исходный файл на ассемблере</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-скомпонуем-полученный-объектный-файл-в-исполняемый-elf-файл">2.2. Скомпонуем полученный объектный файл в исполняемый .elf файл<a href="#22-скомпонуем-полученный-объектный-файл-в-исполняемый-elf-файл" class="hash-link" aria-label="Прямая ссылка на 2.2. Скомпонуем полученный объектный файл в исполняемый .elf файл" title="Прямая ссылка на 2.2. Скомпонуем полученный объектный файл в исполняемый .elf файл">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ld -m elf_i386 -T linker.ld --gc-sections -o lab1.elf lab1.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Ключи команды:</strong></p>
<ul>
<li><code>-m elf_i386</code> - этот ключ указывает компоновщику, что нужно создать исполняемый файл для 32-разрядной архитектуры</li>
<li><code>-T linker.ld</code> - этот ключ указывает компоновщику использовать скрипт линковки linker.ld</li>
<li><code>--gc-sections</code> - этот ключ включает сборку мусора для неиспользуемых секций программы, т. е. удаляет ненужные нам секции программы</li>
<li><code>-o lab1.elf</code> - ключ указывает имя выходного файла</li>
<li><code>lab1.o</code> - этот объектный файл будет скомпонован в исполняемый файл</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="23-преобразуем-исполняемый-файл-lab1elf-в-бинарный-формат-lab1bin">2.3. Преобразуем исполняемый файл lab1.elf в бинарный формат lab1.bin<a href="#23-преобразуем-исполняемый-файл-lab1elf-в-бинарный-формат-lab1bin" class="hash-link" aria-label="Прямая ссылка на 2.3. Преобразуем исполняемый файл lab1.elf в бинарный формат lab1.bin" title="Прямая ссылка на 2.3. Преобразуем исполняемый файл lab1.elf в бинарный формат lab1.bin">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objcopy -S -O binary lab1.elf lab1.bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Ключи команды:</strong></p>
<ul>
<li><code>-S</code> - этот ключ удаляет все символы и отладочную информацию из выходного файла</li>
<li><code>-O binary</code> - этот ключ указывает, что выходной файл должен быть в бинарном формате</li>
<li><code>lab1.elf</code> - выходной файл в формате elf</li>
<li><code>lab1.bin</code> - выходной файл в бинарном формате</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="24-запишем-бинарный-файл-lab1bin-в-образ-загрузочного-диска-bootimg">2.4. Запишем бинарный файл lab1.bin в образ загрузочного диска boot.img<a href="#24-запишем-бинарный-файл-lab1bin-в-образ-загрузочного-диска-bootimg" class="hash-link" aria-label="Прямая ссылка на 2.4. Запишем бинарный файл lab1.bin в образ загрузочного диска boot.img" title="Прямая ссылка на 2.4. Запишем бинарный файл lab1.bin в образ загрузочного диска boot.img">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dd if=lab1.bin of=disk.img bs=512 conv=notrunc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Ключи команды:</strong></p>
<ul>
<li><code>if=lab1.bin</code> - указывает входной файл, который будет записан в образ диска</li>
<li><code>of=disk.img</code> - указывает выходной файл, в который будут записаны данные</li>
<li><code>bs=512</code> - этот ключ указывает размер блока в байтах, в данном случае блок равен 512, что соответствует размеру сектора на диске</li>
<li><code>conv=notrunc</code> - этот ключ указывает, что выходной файл не должен быть усечен, т.е. если файл boot.img уже существует, то будет перезаписана только та часть файла, которая соответствует размеру lab1.bin, остальная же часть останется неизменной</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="25-запуск-эмулятора">2.5. Запуск эмулятора<a href="#25-запуск-эмулятора" class="hash-link" aria-label="Прямая ссылка на 2.5. Запуск эмулятора" title="Прямая ссылка на 2.5. Запуск эмулятора">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-i386 -hda disk.img -fda disk_device</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Ключи команды:</strong></p>
<ul>
<li><code>-fda disk.img</code> - указывает QEMU использовать файл disk.img для загрузки программы</li>
<li><code>-hda disk_device</code> - указывает QEMU, что необходимо подключить disk_device, как внешнее блочное устройство памяти</li>
</ul>
<p><strong>Ожидаемый результат программы:</strong> программа должна вывести сообщения о чтении и записи секторов.
<img decoding="async" loading="lazy" alt="1763502728216" src="/docs/assets/images/1763502728216-8f6b94c18f06ac30a3d4fdf21d82e707.png" width="554" height="300" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-3-автоматизированная-сборка-и-запуск-программы">Часть 3. Автоматизированная сборка и запуск программы<a href="#часть-3-автоматизированная-сборка-и-запуск-программы" class="hash-link" aria-label="Прямая ссылка на Часть 3. Автоматизированная сборка и запуск программы" title="Прямая ссылка на Часть 3. Автоматизированная сборка и запуск программы">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="31-автоматизированная-сборка">3.1. Автоматизированная сборка<a href="#31-автоматизированная-сборка" class="hash-link" aria-label="Прямая ссылка на 3.1. Автоматизированная сборка" title="Прямая ссылка на 3.1. Автоматизированная сборка">​</a></h4>
<p>Для автоматизированного выполнения пунктов 2.1. - 2.4. можно ввести сначала команду:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make clean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>для удаления оставшихся файлов после сборки, а затем команду:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>для автоматизированной сборки проекта</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="32-запуск-эмулятора">3.2. Запуск эмулятора<a href="#32-запуск-эмулятора" class="hash-link" aria-label="Прямая ссылка на 3.2. Запуск эмулятора" title="Прямая ссылка на 3.2. Запуск эмулятора">​</a></h4>
<p>Запуск эмулятора происходит так же, как и в пункте 2.5.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-4-просмотр-объектного-кода-отладка-программы">Часть 4. Просмотр объектного кода, отладка программы<a href="#часть-4-просмотр-объектного-кода-отладка-программы" class="hash-link" aria-label="Прямая ссылка на Часть 4. Просмотр объектного кода, отладка программы" title="Прямая ссылка на Часть 4. Просмотр объектного кода, отладка программы">​</a></h3>
<p>Для просмотра машинного и дизассемблированного из него кода выполнить команду:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objdump --architecture=i386 --target=binary -D disk.img</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>или</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objdump -m i386 -D lab1.elf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Проанализируйте дизассемблированный код, предположите почему программа в дизассемблере выглядит не совсем так, как в изначальном файле.</p>
<p>Для запуска эмулятора с возможностью отладки введите команду:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-i386 -s -S -fda disk.img -hda disk_device</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Дополнительные ключи команды:</strong></p>
<ul>
<li><code>-s</code> - этот флаг включает встроенный сервер GDB на порту 1234</li>
<li><code>-S</code> - этот флаг приостанавливает выполнение процессора при старте виртуальной машины</li>
</ul>
<p>Для подключения к серверу GDB и отладки необходимо запустить <code>gdb</code> и подключиться к серверу:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target remote localhost:1234</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>
<p>Установите контрольную точку по адресу 0x7C00 - адрес в ОП с которого загружается программа, продолжите исполнение, отладчик остановится в самом начале программы (необходимые команды для выполнения лабораторной работы можно найти в разделе &quot;Как работать с GDB?&quot;)</p>
</li>
<li>
<p>Посмотрите некоторое количество дизассемблированных команд, начиная с начального адреса программы и сравните их с дизассембированными командами с помощью objdump</p>
</li>
<li>
<p>Выведите таблицу состояний регистров с помощью команды <code>info registers</code> или <code>i r</code></p>
</li>
<li>
<p>Выполните следующие три инструкции и снова выведите регистры, какие изменения вы заметили? Какие флаги были установлены и для чего?</p>
</li>
<li>
<p>Установите брейкпоинты на 0x7C15 и 0x7C17.</p>
</li>
<li>
<p>Прежде чем продолжить выполнение программы, введите команды <code>display $регистр</code>, перечислите наиболее интересующие, к примеру ah, al, ch, cl, dh, также будем выводить es и bx в 16-ричном виде <code>display/x $регистр</code>, можно выводить также флаги <code>display $eflags</code></p>
</li>
<li>
<p>Продолжите выполнение программы до 0x7C15. Обратите внимание на ah, на что влияет это значение. Выведите 20 строк в 16-ричном виде с помощью команды <code>x/20x 0x8000</code>. Что вы наблюдаете?</p>
</li>
<li>
<p>Продолжим выполнение программы. Снова выведите 20 строк в 16-ричном виде с помощью команды <code>x/20x 0x8000</code>. Что изменилось? Попробуйте найти самостоятельно команду в GDB с помощью которой можно просмотреть эти данные в текстовом формате.</p>
</li>
<li>
<p>Дизассемблируйте 40 инструкций, начиная с адреса 0x7C00. Поставьте брейкпоинты до вызова функции BIOS и сразу после.</p>
</li>
<li>
<p>Продолжите выполнение. Откройте ещё один терминал и зайдите в папку с проектом, выполните команду <code>xxd disk_device | less</code>, определите где находится 3 сектор.</p>
</li>
<li>
<p>Продолжите выполнение. Снова выполните команду <code>xxd disk_device | less</code>, что изменилось?</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="защита-лабораторной-работы">Защита лабораторной работы<a href="#защита-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Защита лабораторной работы" title="Прямая ссылка на Защита лабораторной работы">​</a></h2>
<ol>
<li>Какими командами GDB вы пользовались во время выполнения лабораторной работы? Какие флаги нужно прописать для QEMU, чтобы появилась возможность отладки?</li>
<li>Какое значение передаётся в регистр CL при записи на диск? Почему именно это значение?</li>
<li>Измените код так, чтобы программа читала не 3, а 2 сектора с диска, а также чтобы она записывала данные не в 3-ий сектор, а в 4-ый сектор</li>
<li>Измените текст для записи на диск и убедитесь, что всё корректно работает</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="чеклист-выполнения">Чеклист выполнения<a href="#чеклист-выполнения" class="hash-link" aria-label="Прямая ссылка на Чеклист выполнения" title="Прямая ссылка на Чеклист выполнения">​</a></h2>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Установлен QEMU и binutils</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Созданы файлы проекта (<code>lab1.S</code>, <code>Makefile</code>, <code>linker.ld</code>, <code>create_disk_device.sh</code>)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Проект успешно собирается через <code>make</code></li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Программа запускается в QEMU и выводит сообщения о чтении/записи</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Проведена отладка с помощью GDB, изучены регистры и память</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнены задания из раздела &quot;Защита лабораторной работы&quot;</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="часто-задаваемые-вопросы-faq">Часто задаваемые вопросы (FAQ)<a href="#часто-задаваемые-вопросы-faq" class="hash-link" aria-label="Прямая ссылка на Часто задаваемые вопросы (FAQ)" title="Прямая ссылка на Часто задаваемые вопросы (FAQ)">​</a></h2>
<p><strong>Q: При запуске <code>make</code> появляется ошибка &quot;missing separator&quot;.</strong>
A: В Makefile для отступов обязательно использовать TAB, а не пробелы.</p>
<p><strong>Q: GDB пишет &quot;Remote communication error&quot;.</strong>
A: Убедитесь, что QEMU запущен с флагами <code>-s -S</code> и вы подключаетесь командой <code>target remote localhost:1234</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="связанные-материалы">Связанные материалы<a href="#связанные-материалы" class="hash-link" aria-label="Прямая ссылка на Связанные материалы" title="Прямая ссылка на Связанные материалы">​</a></h2>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html" target="_blank" rel="noopener noreferrer">Intel® 64 and IA-32 Architectures Software Developer Manuals</a></li>
<li><a href="https://wiki.osdev.org/Real_Mode" target="_blank" rel="noopener noreferrer">OSDev Wiki: Real Mode</a></li>
<li><a href="https://www.sourceware.org/gdb/documentation/" target="_blank" rel="noopener noreferrer">GDB Documentation</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="приложение">Приложение<a href="#приложение" class="hash-link" aria-label="Прямая ссылка на Приложение" title="Прямая ссылка на Приложение">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile">Makefile<a href="#makefile" class="hash-link" aria-label="Прямая ссылка на Makefile" title="Прямая ссылка на Makefile">​</a></h3>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">all: lab1.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	dd if=lab1.bin of=disk.img # Записываем программу в disk.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lab1.o: lab1.S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	as --32 -o lab1.o lab1.S # Компилируем программу для архитектуры x86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lab1.bin: lab1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ld -m elf_i386 -T linker.ld --gc-sections -o lab1.elf lab1.o # Связываем объектный файл lab1.o с использованием скрипта линкера linker.ld, создавая ELF-файл lab1.elf. Флаг --gc-sections удаляет неиспользуемые секции для оптимизации.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	objcopy -S -O binary lab1.elf lab1.bin # Конвертируем ELF-файл lab1.elf в чистый бинарный файл lab1.bin. Флаг -S исключает символы и отладочную информацию, а -O binary указывает формат вывода.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm *.o *.elf *.bin *.img # Удаляем всё лишнее</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create_disk_devicesh">create_disk_device.sh<a href="#create_disk_devicesh" class="hash-link" aria-label="Прямая ссылка на create_disk_device.sh" title="Прямая ссылка на create_disk_device.sh">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Указываем запускать файл как bash-скрипт </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Скрипт для создания тестового файла disk_device с тремя секторами</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Каждый сектор имеет размер 512 байт и содержит различные данные:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1. Первый сектор - байты по возрастанию от 0 до 255 (и повторение)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. Второй сектор - байты по убыванию от 255 до 0 (и повторение)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. Третий сектор - нулевые байты</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Создаем временные файлы для каждого сектора</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEMP_ASC=$(mktemp)   # Временный файл для сектора с возрастающими байтами</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEMP_DESC=$(mktemp)  # Временный файл для сектора с убывающими байтами</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEMP_ZEROS=$(mktemp) # Временный файл для сектора с нулевыми байтами</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Формируем первый сектор - байты по возрастанию</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Создание первого сектора: байты по возрастанию (0-255)...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Создаем первую половину сектора</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for ((i=0; i&lt;=256; i++)); do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Преобразуем значение в шестнадцатеричную запись для команды printf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # %02x форматирует число как шестнадцатеричное с ведущими нулями до 2 цифр</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf &quot;\x$(printf &#x27;%02x&#x27; $byte_value)&quot; &gt;&gt; $TEMP_ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Создаем вторую половину сектора (повторяем последовательность)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for ((i=0; i&lt;=256; i++)); do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Преобразуем значение в шестнадцатеричную запись для команды printf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # %02x форматирует число как шестнадцатеричное с ведущими нулями до 2 цифр</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf &quot;\x$(printf &#x27;%02x&#x27; $byte_value)&quot; &gt;&gt; $TEMP_ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Формируем второй сектор - байты по убыванию</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Создание второго сектора: байты по убыванию (255-0)...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Создаем первую половину сектора</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for ((i=255; i&gt;=0; i--)); do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf &quot;\x$(printf &#x27;%02x&#x27; $i)&quot; &gt;&gt; $TEMP_DESC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Создаем вторую половину сектора (повторяем последовательность)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for ((i=255; i&gt;=0; i--)); do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf &quot;\x$(printf &#x27;%02x&#x27; $i)&quot; &gt;&gt; $TEMP_DESC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Отрезаем до точного размера в 512 байт</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dd if=$TEMP_DESC of=$TEMP_DESC.tmp bs=512 count=1 2&gt;/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv $TEMP_DESC.tmp $TEMP_DESC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Формируем третий сектор - нулевые байты</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Создание третьего сектора: нулевые байты...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Используем /dev/zero как источник нулевых байтов</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dd if=/dev/zero of=$TEMP_ZEROS bs=512 count=1 2&gt;/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Объединяем все секторы в один файл</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Объединение секторов в один файл disk_device...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $TEMP_ASC $TEMP_DESC $TEMP_ZEROS &gt; disk_device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Проверяем размер созданного файла</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Создан файл disk_device размером $(stat -c %s disk_device) байт&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Выводим первые несколько байт каждого сектора для проверки</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Содержимое первого сектора (первые 16 байт):&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hexdump -C -n 16 disk_device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Содержимое второго сектора (первые 16 байт):&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hexdump -C -n 16 -s 512 disk_device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Содержимое третьего сектора (первые 16 байт):&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hexdump -C -n 16 -s 1024 disk_device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Очищаем временные файлы</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Удаление временных файлов...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm $TEMP_ASC $TEMP_DESC $TEMP_ZEROS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Готово!&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linkerld">linker.ld<a href="#linkerld" class="hash-link" aria-label="Прямая ссылка на linker.ld" title="Прямая ссылка на linker.ld">​</a></h3>
<div class="language-ld codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ld codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Указываем точку входа в программу. В данном случае это функция _start. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRY(_start)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Определяем секции и их расположение в памяти. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Устанавливаем текущий адрес (счетчик местоположения) на 0x7C00.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Это стандартный адрес, по которому BIOS загружает загрузочный сектор. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    . = 0x7C00;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .text: содержит исполняемый код программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .text : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.text) /* Включаем все объектные файлы, которые содержат секцию .text. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .data: содержит инициализированные данные программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .data : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.data) /* Включаем все объектные файлы, которые содержат секцию .data. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .stack: выделяет память для стека программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .stack : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.stack) /* Включаем все объектные файлы, которые содержат секцию .stack. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция /DISCARD/: указывает компоновщику отбросить ненужные секции.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Это помогает уменьшить размер итогового бинарного файла. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /DISCARD/ : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.note*)  /* Отбрасываем все секции, начинающиеся с .note (например, отладочные метаданные). */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.comment) /* Отбрасываем секции с комментариями. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.gnu*)   /* Отбрасываем все секции, начинающиеся с .gnu (например, специфичные для GNU атрибуты). */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Перемещаем текущий адрес на 0x7DFE. Это предпоследний байт загрузочного сектора. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    . = 0x7DFE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .sig: добавляет сигнатуру загрузочного сектора.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       BIOS проверяет эту сигнатуру, чтобы убедиться, что сектор является загрузочным. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .sig : AT(0x7DFE) /* Указываем, что эта секция должна быть расположена по адресу 0x7DFE. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SHORT(0xAA55) /* Записываем два байта: 0x55 и 0xAA. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lab1s">lab1.S<a href="#lab1s" class="hash-link" aria-label="Прямая ссылка на lab1.S" title="Прямая ссылка на lab1.S">​</a></h3>
<div class="language-asm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-asm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Лабораторная работа 1: Тестирование операций ввода/вывода на диск</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Программа демонстрирует чтение и запись секторов диска через BIOS прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Настройка режима 16-бит для совместимости с BIOS */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.code16                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Определение глобальной точки входа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.global _start              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Начало секции кода */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Точка входа программы */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Инициализация сегментных регистров */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xorw %ax, %ax          /* Обнуляем регистр AX */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw %ax, %ds          /* Устанавливаем регистр DS (регистр сегмента данных) в 0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw %ax, %es          /* Устанавливаем регистр ES (регистр дополнительного сегмента) в 0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Вывод приветственного сообщения */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $hello_msg, %si    /* Загружаем адрес строки в SI */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print              /* Вызываем функцию печати */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Чтение 3 секторов с диска */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x8000, %bx       /* Буфер для записи данных в ОП (ES:BX = 0:8000h) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x80, %dl         /* Номер диска: 80h = первый жесткий диск (HDA) */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x02, %ah         /* Функция 02h - чтение секторов */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $3, %al            /* Количество секторов для чтения: 3 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0, %ch            /* Номер цилиндра: 0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $1, %cl            /* Начальный сектор: 1 (нумерация с 1) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0, %dh            /* Номер головки: 0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x13               /* Вызов прерывания BIOS для чтения с диска */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jc error                /* Если CF=1, произошла ошибка */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Вывод сообщения об успешном чтении */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $read_ok, %si      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Вывод содержимого первого сектора (первые 8 байт) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $sector1, %si      /* Загружаем метку сектора */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print              /* Печатаем метку */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x8000, %si       /* Адрес начала первого сектора в памяти */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $8, %cx            /* Количество байт для отображения */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print_bytes        /* Вызываем функцию отображения байтов */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Вывод содержимого второго сектора (первые 8 байт) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $sector2, %si      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x8200, %si       /* Адрес начала второго сектора (0x8000 + 512) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $8, %cx           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print_bytes     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Вывод содержимого третьего сектора (первые 8 байт) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $sector3, %si      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x8400, %si       /* Адрес начала третьего сектора (0x8200 + 512) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $8, %cx           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print_bytes     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Запись тестовых данных на диск */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Подготовка данных в буфере для последующей записи в на диск */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $test_data, %si    /* Источник данных (адрес текстового сообщения в нашем коде) */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x9000, %di       /* Адрес буфера назначения */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $(test_end - test_data), %cx           /* Количество байт для копирования */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rep movsb               /* Повторяем инструкцию MOVSB CX раз */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Запись данных в третий сектор диска */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x9000, %bx       /* Адрес буфера с данными в ОП */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x80, %dl         /* Номер диска: 80h = первый жесткий диск */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x03, %ah         /* Функция 03h - запись секторов */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $1, %al            /* Количество секторов: 1 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0, %ch            /* Номер цилиндра: 0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $3, %cl            /* Номер сектора: 3 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0, %dh            /* Номер головки: 0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x13               /* Вызов прерывания BIOS для записи на диск */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jc error                /* Проверка на ошибку */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Вывод сообщения об успешной записи */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $write_ok, %si     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Проверка успешности записи путем чтения записанного сектора */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x9200, %bx       /* Новый буфер для чтения данных */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x80, %dl         /* Номер диска */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x02, %ah         /* Функция чтения */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $1, %al            /* Количество секторов: 1 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0, %ch            /* Цилиндр 0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $3, %cl            /* Сектор 3 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0, %dh            /* Головка 0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x13               /* Чтение данных */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jc error                /* Проверка на ошибку */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Вывод данных из прочитанного сектора для проверки */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $verify, %si       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $0x9200, %si       /* Адрес буфера с прочитанными данными */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $8, %cx            /* Отображаем первые 8 байт */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print_bytes       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Вывод сообщения о завершении теста */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $complete, %si     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Остановка процессора */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hlt                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    l: // необходимо, т.к. qemu не останавливает процессор по команде hlt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* ========================================================================= */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Вспомогательные функции */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* ========================================================================= */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Функция print_bytes - выводит заданное количество байт в шестнадцатеричном формате</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Входные параметры:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   SI - адрес начала данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   CX - количество байт для вывода</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_bytes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push %cx                /* Сохраняем счетчик */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push %si                /* Сохраняем адрес */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1:  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb (%si), %al         /* Загружаем байт из памяти по адресу SI */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print_hex          /* Печатаем байт в шестнадцатеричном формате */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $&#x27; &#x27;, %al          /* Загружаем пробел */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x0E, %ah         /* Функция BIOS для вывода символа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x10               /* Вызов BIOS для вывода символа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inc %si                 /* Переходим к следующему байту */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dec %cx                 /* Уменьшаем счетчик */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jnz 1b                  /* Если счетчик не 0, продолжаем цикл */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $newline, %si      /* Загружаем адрес строки переноса строки */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print              /* Печатаем перенос строки */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop %si                 /* Восстанавливаем адрес */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop %cx                 /* Восстанавливаем счетчик */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret                     /* Возврат из функции */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Функция print_hex - выводит байт в шестнадцатеричном формате (2 символа)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Входной параметр:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   AL - байт для вывода</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_hex:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push %ax                /* Сохраняем AX */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Обработка старшей цифры (старшие 4 бита) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov %al, %ah            /* Копируем байт в AH */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shr $4, %ah             /* Сдвигаем вправо на 4 бита */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add $&#x27;0&#x27;, %ah           /* Преобразуем в ASCII символ (0-9) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmp $&#x27;9&#x27;, %ah           /* Сравниваем с &#x27;9&#x27; */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jle 1f                  /* Если &lt;= &#x27;9&#x27;, переходим на метку 1 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add $7, %ah             /* Иначе добавляем 7 для преобразования в A-F */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1:  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov %ah, %al            /* Перемещаем символ в AL для вывода */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov $0x0E, %ah          /* Функция BIOS для вывода символа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x10               /* Вызов BIOS для вывода символа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Восстанавливаем исходное значение и подготавливаем младшую цифру */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop %ax                 /* Восстанавливаем исходный байт в AX */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push %ax                /* Сохраняем его снова */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Обработка младшей цифры (младшие 4 бита) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    and $0x0F, %al          /* Маскируем старшие 4 бита */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add $&#x27;0&#x27;, %al           /* Преобразуем в ASCII символ (0-9) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmp $&#x27;9&#x27;, %al           /* Сравниваем с &#x27;9&#x27; */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jle 2f                  /* Если &lt;= &#x27;9&#x27;, переходим на метку 2 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add $7, %al             /* Иначе добавляем 7 для преобразования в A-F */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2:  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov $0x0E, %ah          /* Функция BIOS для вывода символа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x10               /* Вызов BIOS для вывода символа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop %ax                 /* Восстанавливаем AX */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret                     /* Возврат из функции */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Функция error - обработчик ошибок</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movw $error_msg, %si    /* Загружаем адрес сообщения об ошибке */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    call print              /* Печатаем сообщение */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hlt                     /* Останавливаем процессор */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Функция print - выводит строку, заканчивающуюся нулевым байтом</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Входной параметр:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   SI - указатель на начало строки</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lodsb                   /* Загружаем байт из [SI] в AL и увеличиваем SI */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orb %al, %al            /* Проверка на конец строки (нулевой байт) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jz 1f                   /* Если AL = 0, переходим к концу функции */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    movb $0x0E, %ah         /* Функция 0Eh - вывод символа с использованием текущего TTY */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int $0x10               /* Вызов BIOS прерывания 10h */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jmp print               /* Переходим к обработке следующего символа */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1:  ret                     /* Возврат из функции */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* ========================================================================= */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Данные программы */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* ========================================================================= */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Текстовые строки */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello_msg: .asciz &quot;Disk I/O test\r\n&quot;           /* Приветственное сообщение */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">read_ok:   .asciz &quot;Read OK\r\n&quot;                 /* Сообщение об успешном чтении */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write_ok:  .asciz &quot;Write OK\r\n&quot;                /* Сообщение об успешной записи */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_msg: .asciz &quot;Error!\r\n&quot;                  /* Сообщение об ошибке */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sector1:   .asciz &quot;Sector 1: &quot;                  /* Метка для первого сектора */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sector2:   .asciz &quot;Sector 2: &quot;                  /* Метка для второго сектора */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sector3:   .asciz &quot;Sector 3: &quot;                  /* Метка для третьего сектора */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">verify:    .asciz &quot;Verify: &quot;                    /* Метка для проверки записи */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">complete:  .asciz &quot;Complete!\r\n&quot;               /* Сообщение о завершении теста */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newline:   .asciz &quot;\r\n&quot;                        /* Символы перевода строки и возврата каретки */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_data: .ascii &quot;WRITE TEST DATA!&quot;            /* Тестовые данные для записи на диск */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_end:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/efremovnv/docs/edit/main/website/docs/peripheral-devices/lab1.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Отредактировать эту страницу</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Последнее обновление<!-- --> <b><time datetime="2025-11-22T17:49:14.000Z" itemprop="dateModified">22 нояб. 2025 г.</time></b></span></div></div></footer></article><div class="margin-top--lg"><button class="button button--secondary button--sm">📄 Скачать PDF</button></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/labs/intro"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">Учебные материалы по организации ЭВМ и систем</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/labs/peripheral-devices/lab2"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">Лабораторная работа №2</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#контекст" class="table-of-contents__link toc-highlight">Контекст</a></li><li><a href="#сокращения" class="table-of-contents__link toc-highlight">Сокращения</a></li><li><a href="#цель-работы" class="table-of-contents__link toc-highlight">Цель работы</a></li><li><a href="#необходимые-инструменты" class="table-of-contents__link toc-highlight">Необходимые инструменты</a></li><li><a href="#исходные-файлы-лабораторной-работы" class="table-of-contents__link toc-highlight">Исходные файлы лабораторной работы</a></li><li><a href="#материалы-для-подготовки-к-лабораторной-работе" class="table-of-contents__link toc-highlight">Материалы для подготовки к лабораторной работе</a><ul><li><a href="#блочные-устройства-внешней-памяти" class="table-of-contents__link toc-highlight">Блочные устройства внешней памяти</a></li><li><a href="#загрузочный-сектор-mbr---master-boot-record" class="table-of-contents__link toc-highlight">Загрузочный сектор (MBR - Master Boot Record)</a></li><li><a href="#bios" class="table-of-contents__link toc-highlight">BIOS</a></li><li><a href="#адресация-дисков" class="table-of-contents__link toc-highlight">Адресация дисков</a></li><li><a href="#синтаксис-att-american-telephone-and-telegraph" class="table-of-contents__link toc-highlight">Синтаксис AT&amp;T (American Telephone and Telegraph)</a></li><li><a href="#gnu-as" class="table-of-contents__link toc-highlight">GNU as</a></li><li><a href="#gnu-ld" class="table-of-contents__link toc-highlight">GNU ld</a></li><li><a href="#objcopy" class="table-of-contents__link toc-highlight">objcopy</a></li><li><a href="#dd" class="table-of-contents__link toc-highlight">dd</a></li><li><a href="#objdump" class="table-of-contents__link toc-highlight">objdump</a></li><li><a href="#readelf" class="table-of-contents__link toc-highlight">readelf</a></li><li><a href="#qemu" class="table-of-contents__link toc-highlight">QEMU</a></li><li><a href="#как-работать-с-gdb" class="table-of-contents__link toc-highlight">Как работать с GDB?</a></li></ul></li><li><a href="#вопросы-для-самоконтроля" class="table-of-contents__link toc-highlight">Вопросы для самоконтроля</a></li><li><a href="#выполнение-лабораторной-работы" class="table-of-contents__link toc-highlight">Выполнение лабораторной работы</a><ul><li><a href="#часть-1-подготовка-к-выполнению-лабораторной-работы" class="table-of-contents__link toc-highlight">Часть 1. Подготовка к выполнению лабораторной работы</a></li><li><a href="#часть-2-ручная-сборка-и-запуск-программы" class="table-of-contents__link toc-highlight">Часть 2. Ручная сборка и запуск программы</a></li><li><a href="#часть-3-автоматизированная-сборка-и-запуск-программы" class="table-of-contents__link toc-highlight">Часть 3. Автоматизированная сборка и запуск программы</a></li><li><a href="#часть-4-просмотр-объектного-кода-отладка-программы" class="table-of-contents__link toc-highlight">Часть 4. Просмотр объектного кода, отладка программы</a></li></ul></li><li><a href="#защита-лабораторной-работы" class="table-of-contents__link toc-highlight">Защита лабораторной работы</a></li><li><a href="#чеклист-выполнения" class="table-of-contents__link toc-highlight">Чеклист выполнения</a></li><li><a href="#часто-задаваемые-вопросы-faq" class="table-of-contents__link toc-highlight">Часто задаваемые вопросы (FAQ)</a></li><li><a href="#связанные-материалы" class="table-of-contents__link toc-highlight">Связанные материалы</a></li><li><a href="#приложение" class="table-of-contents__link toc-highlight">Приложение</a><ul><li><a href="#makefile" class="table-of-contents__link toc-highlight">Makefile</a></li><li><a href="#create_disk_devicesh" class="table-of-contents__link toc-highlight">create_disk_device.sh</a></li><li><a href="#linkerld" class="table-of-contents__link toc-highlight">linker.ld</a></li><li><a href="#lab1s" class="table-of-contents__link toc-highlight">lab1.S</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">efremovnv</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Начало</a></li></ul></div><div class="col footer__col"><div class="footer__title">Ресурсы</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 efremovnv. Создано с помощью Docusaurus.</div></div></div></footer></div>
</body>
</html>