<!doctype html>
<html lang="ru-RU" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-peripheral-devices/lab3" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Лабораторная работа №3 | efremovnv</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" name="twitter:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" property="og:url" content="https://efremovnv.github.io/docs/labs/peripheral-devices/lab3"><meta data-rh="true" property="og:locale" content="ru_RU"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Лабораторная работа №3 | efremovnv"><meta data-rh="true" name="description" content="Контекст"><meta data-rh="true" property="og:description" content="Контекст"><link data-rh="true" rel="icon" href="/docs/img/logo2.svg"><link data-rh="true" rel="canonical" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab3"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab3" hreflang="ru-RU"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab3" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.b2f4074e.css">
<script src="/docs/assets/js/runtime~main.f7f1290e.js" defer="defer"></script>
<script src="/docs/assets/js/main.647d6c6e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/logo.svg"><link rel="preload" as="image" href="/docs/img/logo-dark.svg"><div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo-dark.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">efremovnv</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/labs/intro">Методички</a><a class="navbar__item navbar__link" href="/docs/labs/contributing">Контрибьюция</a><a class="navbar__item navbar__link" href="/docs/labs/links">Ссылки</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-label="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/labs/intro">Учебные материалы по организации ЭВМ и систем</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/labs/peripheral-devices/lab1">Периферийные устройства</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab1">Лабораторная работа №1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab2">Лабораторная работа №2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/labs/peripheral-devices/lab3">Лабораторная работа №3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab4">Лабораторная работа №4</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/computer-organization/lab7">Организация ЭВМ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/course-work/rp-op-design">Курсовая работа</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Периферийные устройства</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Лабораторная работа №3</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><header><h1>Лабораторная работа №3</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="контекст">Контекст<a href="#контекст" class="hash-link" aria-label="Прямая ссылка на Контекст" title="Прямая ссылка на Контекст">​</a></h2>
<p>Данная лабораторная работа посвящена изучению механизмов обработки прерываний и исключений в защищённом режиме процессора x86. Студенты научатся работать с таблицей дескрипторов прерываний (IDT), программируемым контроллером прерываний (PIC) и писать собственные обработчики для различных событий, таких как деление на ноль, прерывания клавиатуры и таймера.</p>
<p>Исключения и прерывания в защищённом режиме процессора X86 их обработка.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="сокращения">Сокращения<a href="#сокращения" class="hash-link" aria-label="Прямая ссылка на Сокращения" title="Прямая ссылка на Сокращения">​</a></h2>
<ul>
<li><strong>BIOS</strong> – Base Input/Output System – базовая система ввода/вывода</li>
<li><strong>WSL</strong> – Windows Subsystem for Linux – подсистема Windows для Linux</li>
<li><strong>MBR</strong> – Master Boot Record – главная загрузочная запись</li>
<li><strong>CHS</strong> – Cylinder-Head-Sector – цилиндр-головка-сектор</li>
<li><strong>GPT</strong> – GUID (Globally Unique Identifier) Partition Table – таблица разделов глобальных уникальных идентификаторов</li>
<li><strong>LBA</strong> – Logical Block Addressing – логическая блочная адресация</li>
<li><strong>AT&amp;T</strong> – American Telephone and Telegraph</li>
<li><strong>GDT</strong> – Global Descriptor Table – глобальная таблица дескрипторов</li>
<li><strong>LDT</strong> – Local Descriptor Table – локальная таблица дескрипторов</li>
<li><strong>GDTR</strong> – Global Descriptor Table Register – регистр глобальной таблицы дескрипторов</li>
<li><strong>IDT</strong> – Interrupt Descriptor Table – дескрипторная таблица прерываний</li>
<li><strong>IDTR</strong> – Interrupt Descriptor Table Register – регистр дескрипторной таблицы прерываний</li>
<li><strong>PIC</strong> – Programmable Interrupt Controller – программируемый контроллер прерываний</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="цель-работы">Цель работы<a href="#цель-работы" class="hash-link" aria-label="Прямая ссылка на Цель работы" title="Прямая ссылка на Цель работы">​</a></h2>
<p>Целью данной лабораторной работы является изучение механизма работы обработчика исключений и прерываний, а также написание собственных обработчиков.</p>
<p>В процессе выполнения работы студенты:</p>
<ul>
<li>Изучат основные виды исключений и прерываний, их классификацию и особенности</li>
<li>Поймут причины возникновения исключений и способы их обработки</li>
<li>Напишут и протестируют собственные обработчики исключений и прерываний</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="необходимые-инструменты">Необходимые инструменты<a href="#необходимые-инструменты" class="hash-link" aria-label="Прямая ссылка на Необходимые инструменты" title="Прямая ссылка на Необходимые инструменты">​</a></h2>
<ul>
<li>Любой дистрибутив GNU/Linux: рекомендуется Ubuntu, также можно использовать виртуальную машину, например, WSL</li>
<li>Ассемблер: <code>as</code></li>
<li>Компоновщик: <code>ld</code></li>
<li>Утилиты для анализа объектных файлов: <code>objdump</code>, <code>readelf</code></li>
<li>Препроцессор: <code>cpp</code></li>
<li>Утилита для работы с дисками: <code>dd</code></li>
<li>Отладчик: <code>gdb</code></li>
<li>Эмулятор: <code>qemu</code></li>
<li>Утилиты для автоматизации сборки проектов: <code>make</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="исходные-файлы-лабораторной-работы">Исходные файлы лабораторной работы<a href="#исходные-файлы-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Исходные файлы лабораторной работы" title="Прямая ссылка на Исходные файлы лабораторной работы">​</a></h2>
<p>Файлы, которые используются в лабораторной работе:</p>
<ul>
<li><strong>linker.ld</strong> - скрипт линковщика</li>
<li><strong>Makefile</strong> - необходимый для автоматизированной сборки проекта</li>
<li><strong>lab3_1.s</strong> - содержит программу с обработчиками различных исключений</li>
<li><strong>lab3_2.s</strong> - содержит программу с обработчиками прерываний клавиатуры и таймера</li>
<li><strong>gdt.h, idt.h, irq.h</strong> – макросы и константы</li>
<li><strong>boot.S</strong> - содержит программу загрузчика</li>
<li><strong>Makefile</strong> (для загрузчика) - для автоматизированной сборки загрузчика</li>
<li><strong>linker.ld</strong> (для загрузчика) - для сборки загрузчика</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="материалы-для-подготовки-к-лабораторной-работе">Материалы для подготовки к лабораторной работе<a href="#материалы-для-подготовки-к-лабораторной-работе" class="hash-link" aria-label="Прямая ссылка на Материалы для подготовки к лабораторной работе" title="Прямая ссылка на Материалы для подготовки к лабораторной работе">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="понятие-прерывания-и-исключения">Понятие прерывания и исключения<a href="#понятие-прерывания-и-исключения" class="hash-link" aria-label="Прямая ссылка на Понятие прерывания и исключения" title="Прямая ссылка на Понятие прерывания и исключения">​</a></h3>
<p><strong>Прерывание (англ. Interrupt)</strong> – это событие, вызывающее прекращение работы основной программы и переход к выполнению процедуры или подпрограммы, предназначенной для его обработки.</p>
<p>Практически все системы ввода/вывода в компьютере работают с использованием прерываний. В частности, когда вы нажимаете клавиши или щёлкаете мышью, аппаратура вырабатывает прерывания. В ответ на них система считывает код нажатой клавиши или запоминает координаты курсора мыши. Прерывания вырабатываются контроллером диска, портами последовательной передачи данных, звуковым адаптером и другими устройствами.</p>
<p>Подробнее о скан-коде можно прочитать: <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BA%D0%B0%D0%BD-%D0%BA%D0%BE%D0%B4" target="_blank" rel="noopener noreferrer">Скан-код на Википедии</a></p>
<p>Основная цель введения прерываний - реализация асинхронного режима работы и распараллеливания работы отдельных устройств вычислительного комплекса. Механизм прерываний реализуется аппаратно-программными средствами. Прерывание непременно ведёт за собой изменение порядка выполнения команд процессором.</p>
<p><strong>Главные функции механизма прерывания:</strong></p>
<ol>
<li>Распознавание или классификация прерывания</li>
<li>Передача управления обработчику прерывания</li>
<li>Корректное возвращение к прерванной программе
<img decoding="async" loading="lazy" alt="Выполнение прерывания в компьютере" src="/docs/assets/images/1763549011157-1e6708f91d130183a194d1443fbf4e77.png" width="554" height="232" class="img_ev3q"></li>
</ol>
<p><em>tр</em> - время реакции процессора на запрос прерывания; <em>tс</em> - время сохранения состояния прерываемой программы и вызова обработчика прерывания; <em>tв</em> - время восстановления прерванной программы</p>
<p><strong>Виды прерываний:</strong></p>
<ul>
<li><strong>аппаратные прерывания</strong>, которые инициируются внешними устройствами с помощью запросов на прерывания.</li>
<li><strong>программные прерывания</strong>, которые инициируются специальными командами (например, int21h для х86).</li>
<li><strong>особые случаи или исключения</strong>, вызванные возникновением особых условий (случаев) при выполнении текущей команды.</li>
</ul>
<p><strong>Типы внешних прерываний:</strong></p>
<ul>
<li><strong>Немаскируемые</strong> - обрабатываются всегда, независимо от запретов на другие прерывание. К примеру, такое прерывание может вызвать сбой в микросхеме памяти</li>
<li><strong>Маскируемые</strong> - которые можно запрещать установкой соответствующих битов в регистре маскирования прерываний (сбросом флага IF в регистре флагов). Они генерируются контроллером прерываний по заявке определённых периферийных устройств</li>
</ul>
<p><strong>Классификация исключений в защищённом режиме:</strong></p>
<ul>
<li><strong>Нарушение (Fault)</strong> - такой особый случай, который обнаруживается процессором до возникновения фактической ошибки. После устранения обработчиком причины должен быть выполнен рестарт текущей команды.</li>
<li><strong>Ловушка (Trap)</strong> - такой особый случай, который обнаруживается процессором после выполнения виновной команды. То есть команда сама инициирует переход к обработчику и после его завершения выполнение прерванной программы продолжается со следующей команды.</li>
<li><strong>Аварийное завершение (Abort)</strong> - такой особый случай, при котором нельзя установить его причину и выполнить рестарт команды.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="1763549054045" src="/docs/assets/images/1763549054045-c0c39bf754fd95d888ea09438fe0831a.png" width="569" height="417" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="основные-исключения-процессора-x86">Основные исключения процессора X86<a href="#основные-исключения-процессора-x86" class="hash-link" aria-label="Прямая ссылка на Основные исключения процессора X86" title="Прямая ссылка на Основные исключения процессора X86">​</a></h3>
<ul>
<li><strong>Ошибка деления (0)</strong> – автоматически формируется, когда в команде DIV или IDIV делитель равен нулю или частное слишком велико для получателя (AL, AX, EAX).</li>
<li><strong>Отладка (1)</strong> – формируется в следующих случаях:<!-- -->
<ul>
<li>Нарушение к.т. по адресу команды;</li>
<li>Нарушение к.т. по адресу данных;</li>
<li>Ловушка покомандной работы (TF = 1);</li>
<li>Ловушка контрольной точки по переключению задачи (бит Т=1 в сегменте TSS).</li>
</ul>
</li>
<li><strong>Немаскируемое прерывание NMI (2)</strong> – единственное внешнее радиальное прерывание.</li>
<li><strong>Контрольная точка (3)</strong> – формируется при выполнении однобайтной команды INT3 (код 0cch).</li>
<li><strong>Переполнение (4)</strong> – возникает при выполнении команды INT0 при условии, что OF=1.</li>
<li><strong>Нарушение границы массива (5)</strong> – возникает при выполнении команды BOUND, если контрольная проверка дает отрицательный результат, т.е. проверяемый (первый) операнд не попадает в диапазон значений, определенных вторым и третьим операндами команды.</li>
<li><strong>Недействительный код операции (6)</strong> – генерируется, когда операционное устройство процессора обнаруживает неверный код операции.</li>
<li><strong>Устройство недоступно (7)</strong> – возникает в двух случаях:<!-- -->
<ul>
<li>Процессор выполняет команду ESC и бит ЕМ=1 в CR0.</li>
<li>Процессор выполняет команду wait или ESC и бит TS=1 в CR1.</li>
</ul>
</li>
<li><strong>Двойное нарушение (8)</strong> – когда процессор обнаруживает особый случай при попытке вызвать обработчик предыдущего особого случая, два особых случая обрабатываются последовательно. Если процессор не может их обработать последовательно, формируется особый случай.</li>
<li><strong>Недействительный сегмент TSS (10)</strong> – возникает при попытке переключения на задачу с неверным TSS.</li>
<li><strong>Неприсутствие сегмента (11)</strong> – формируется, когда бит Р=0 в дескрипторе сегмента.</li>
<li><strong>Нарушение стека (12)</strong> – возникает в двух ситуациях:<!-- -->
<ul>
<li>Нарушение предела сегмента при обращении к регистру SS (POP, PUSH, ENTER, MOV AX, [BP+6]);</li>
<li>При попытке загрузить в регистр SS дескриптор, который отмечен как неприсутствующий.</li>
</ul>
</li>
<li><strong>Нарушение общей защиты (13)</strong> – все нарушения защиты, которые не служат причиной конкретного особого случая:<!-- -->
<ul>
<li>Превышение предела сегмента (кроме стека);</li>
<li>Передача управления сегменту, который не является выполняемым;</li>
<li>Запись в защищенный от записи сегмент;</li>
<li>Считывание из выполняемого сегмента;</li>
<li>Загрузка в SS селектора сегмента, защищенного от записи;</li>
<li>Загрузка в SS, DS, ES, FS, GS селектора системного сегмента;</li>
<li>Загрузка в SS, DS, ES, FS, GS селектора выполняемого сегмента;</li>
<li>Переключение на занятую задачу;</li>
<li>Нарушение правила привилегий и др.</li>
</ul>
</li>
<li><strong>Страничное нарушение (14)</strong> – возникает, когда разрешено страничное преобразование и имеет место одна из ситуаций:<!-- -->
<ul>
<li>В элементе PDE или PTE сброшен бит Р;</li>
<li>Процедура не имеет достаточного уровня привилегий для доступа к адресуемой странице.</li>
</ul>
</li>
<li><strong>Ошибка операции с плавающей точкой (16)</strong> – сигнализирует об ошибке, возникшей при выполнении команды FPU.</li>
<li><strong>Контроль выравнивания (17)</strong> – возникает при нарушении выравнивания операндов. Для реализации контроля выравнивания должны выполняться условия:<!-- -->
<ul>
<li>AM=1 в CR3;</li>
<li>AC=1 в EFLAGS;</li>
<li>PL=3 для выполняемой программы.</li>
</ul>
</li>
</ul>
<p>Подробнее можно почитать:</p>
<ul>
<li><a href="https://osdev.fandom.com/ru/wiki/IAM:%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_5" target="_blank" rel="noopener noreferrer">OSDev Wiki - Глава 5</a></li>
<li><a href="https://habr.com/ru/companies/timeweb/articles/780082/" target="_blank" rel="noopener noreferrer">Хабр - Прерывания и исключения</a></li>
<li><a href="https://clck.ru/3GDKjo" target="_blank" rel="noopener noreferrer">Дополнительные материалы</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="таблица-прерываний-и-исключений-защищённого-режима">Таблица прерываний и исключений защищённого режима<a href="#таблица-прерываний-и-исключений-защищённого-режима" class="hash-link" aria-label="Прямая ссылка на Таблица прерываний и исключений защищённого режима" title="Прямая ссылка на Таблица прерываний и исключений защищённого режима">​</a></h3>
<p>Таблица прерываний защищённого режима называется дескрипторной таблицей прерываний IDT (Interrupt Descriptor Table).</p>
<p>Также как и таблицы GDT и LDT, таблица IDT содержит 8-байтовые дескрипторы.</p>
<p>Её расположение определяется содержимым 6-байтового внутреннего регистра процессора IDTR. Формат регистра IDTR полностью аналогичен формату регистра GDTR, для его загрузки используется команда LIDT.</p>
<p><strong>Формат регистра IDTR:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549237847" src="/docs/assets/images/1763549237847-a469a8925e06150cbea0d14a96b15504.png" width="554" height="315" class="img_ev3q"></p>
<p>Таблица дескрипторов прерываний (IDT) связывает каждый вектор исключения или прерывания с дескриптором шлюза для процедуры или задачи, которая используется для обработки соответствующего исключения или прерывания. Как и GDT (глобальная таблица дескрипторов) и LDT (локальные таблицы дескрипторов), IDT представляет собой массив 8-байтовых дескрипторов (в защищённом режиме). В отличие от GDT, первая запись в IDT может содержать дескриптор. Для формирования индекса в IDT процессор умножает вектор исключения или прерывания на восемь (количество байтов в дескрипторе шлюза). Поскольку существует только 256 векторов прерываний или исключений, в IDT должно находиться не более 256 дескрипторов. Все пустые слоты дескрипторов в IDT должны иметь флаг присутствия (present flag) установленным в 0.</p>
<p><strong>Структура дескрипторов шлюзов прерываний:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549285900" src="data:image/png;base64,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" width="484" height="113" class="img_ev3q"></p>
<p><strong>Формат шлюза задачи:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549290883" src="data:image/png;base64,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" width="484" height="113" class="img_ev3q"></p>
<p><strong>Формат шлюза прерывания:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549294481" src="data:image/png;base64,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" width="484" height="113" class="img_ev3q"></p>
<p><strong>Формат шлюза ловушки:</strong></p>
<p>Перед тем, как передать управление обработчику исключения, для многих зарезервированных прерываний аппаратные средства процессора помещают в стек 16-битовый код ошибки. Этот код ошибки программа может проанализировать и тем самым получить некоторую дополнительную информацию об ошибке.</p>
<p><strong>Формат кода ошибки:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549337819" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYkAAABDCAIAAADmu26MAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAK8SURBVHhe7dzRkqMgEAXQZf//n90Hq1gKCImK2DM55ykxKkTbKyaWadu2PwDB/K0nAAQgm4CIZBMQkWwCIpJNQESyCYhINgERpaP3N6VUL5JSKt8eXSEcVZbcmnpb3+In2oPxKfv2mduZw9+t3RztFLhPVW8Lym99ix8K0pPcjbn9OXBNl1KqhkjTewN8onswPqJMgG3bJvbqQDZt2yaGeNz6Ilzf4lvfcDAeyKZX9giPE+R8g1xyv/4Q/VoTsmmP8J14Yo2nSk4aLnM1m+wnvoRh2mJXswkWWzxQ2u2pJJhWuppNjxQKrGS4NFBeVs/dUIfX1TYf87Y0frHFJdeegBc0+on2YHxKiHsvARa4ek0HcAfZBEQkm4CIZBMQkWwCIur8T9f+YwqwRk6kfja1E+EnilbM+jNW9sc1HRCRbAIikk1ndH+S607kJ/r/QLJC/qie+yH39aT+5inlie2c3fnbOU+QTVDLD4eqXn+P/K3zd2+3QP5tqJotv75INs0x5UQBkd33yIEu2TRBtZ+qnCrfjse97cRq2fL1q5XAfVY+aFQ2XXX0BPJq0JufXtbd92Urec7B/HCfozV/jmy6ZNZOKtfTxs24lcFHcE45MH/q5CebzhtExon9+mqRQStwk3JgXv1esWy0LptOGkdGd7+OlYuUS72tg/GncIe3ZXmdbDrp89DJBnFW7elqr1efLigLaA0K+A6yaZE9TaoLtzZxdm0FdOPp1cxwUa6uXTeY7j5H1u11O8F13a3anchE0baw/oyV/TFuAiKSTYt0z07diYBsAoKSTUBEsgmISDYBEckmICLZBETUufPq1ns9AQZyInWyCeBxrumAiGQTEJFsAiKSTUBEsgmISDYBEckmICLZBEQkm4CIZBMQkWwCIpJNQESyCYhINgERySYgItkERCSbgIhkExDRP5gWtshzcaH5AAAAAElFTkSuQmCC" width="393" height="67" class="img_ev3q"></p>
<p>Поле индекса содержит индекс дескриптора, при обращении к которому произошла ошибка. Поле I, равное 1, означает, что этот индекс относится к таблице IDT. В этом случае произошла ошибка при обработке прерывания или исключения.</p>
<p>Если бит I равен 0, поле TI выбирает таблицу дескрипторов (GDT или LDT) по аналогии с соответствующим полем селектора.</p>
<p>Бит EXT устанавливается в том случае, когда ошибка произошла не в результате выполнения текущей команды, а по внешним относительно выполняемой программы причинам. Например, при обработке аппаратного прерывания от устройства ввода/вывода произошло обращение к отсутствующему в памяти сегменту (у которого в дескрипторе сброшен бит присутствия P).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="программируемый-контроллер-прерываний">Программируемый контроллер прерываний<a href="#программируемый-контроллер-прерываний" class="hash-link" aria-label="Прямая ссылка на Программируемый контроллер прерываний" title="Прямая ссылка на Программируемый контроллер прерываний">​</a></h3>
<p>Программируемый контроллер прерываний (Programmable Interrupt Controller, PIC) отвечает за приём запросов прерываний от различных устройств, их хранение в ожидании обработки, выделение наиболее приоритетного из одновременно присутствующих запросов и выдачу его вектора в процессор, когда последний пожелает обработать прерывание.</p>
<p><strong>Источники запросов прерываний:</strong></p>
<ul>
<li>IRQ0 - программируемый интервальный таймер или высокоточный таймер событий №0</li>
<li>IRQ1 - клавиатура PS/2</li>
<li>IRQ2 - запрос прерывания от ведомого контроллера прерываний</li>
<li>IRQ3 - произвольное устройство (в IBM PC/AT - последовательный порт COM2 и COM4)</li>
<li>IRQ4 - произвольное устройство (в IBM PC/AT - последовательный порт COM1 и COM3)</li>
<li>IRQ5 - произвольное устройство (в IBM PC/AT - параллельный порт LPT2)</li>
<li>IRQ6 - произвольное устройство (в IBM PC/AT - контроллер гибких дисков)</li>
<li>IRQ7 - произвольное устройство (в IBM PC/AT - параллельный порт LPT1)</li>
<li>IRQ8 - часы реального времени или высокоточный таймер событий №1</li>
<li>IRQ9 - произвольное устройство</li>
<li>IRQ10 - произвольное устройство</li>
<li>IRQ11 - произвольное устройство или высокоточный таймер событий №2</li>
<li>IRQ12 - произвольное устройство, обычно мышь PS/2, либо высокоточный таймер событий №3</li>
<li>IRQ13 - ошибка арифметического сопроцессора</li>
<li>IRQ14 - произвольное устройство, обычно первый контроллер ATA (или контроллер Serial ATA в режиме совместимости)</li>
<li>IRQ15 - произвольное устройство, обычно второй контроллер ATA (или контроллер Serial ATA в режиме совместимости)</li>
</ul>
<p>Контроллер прерываний (8259A) имеет следующие регистры:</p>
<ul>
<li><strong>IMR</strong> - регистр масок, установленные биты указывают, какие номера прерываний запретить обрабатывать</li>
<li><strong>IRR</strong> - регистр запросов на прерывание, содержит номера поступивших запросов на прерывание, бит соответствующему запросу сбрасывается после подтверждения прерывания (IMR на IRR не влияет)</li>
<li><strong>ISR</strong> - регистр обслуживаемых прерываний, указывает номера обслуживаемых прерываний</li>
</ul>
<p>Прерывания от отдельных устройств можно запретить, устанавливая в регистре масок IMR контроллера, соответствующие им биты. Запретить прерывания от всех устройств можно очисткой бита IF в регистре флагов центрального процессора.</p>
<p>Микросхема 8259A позволяет подключать к себе до восьми устройств. Чтобы расширить количество обрабатываемых прерываний, в IBM PC/AT контроллеры прерываний включены каскадом. Один из КП играет роль ведущего (Master), а второй — ведомого (Slave). Выход INTR ведомого контроллера подключён к одному из входов ведущего, а выход INTR ведущего — к соответствующему входу ЦП (см. структуру подключений). Получив от ЦП подтверждение прерывания (по общей для обоих КП шине INTA), если оно относится к ведомому КП, ведущий по локальной шине cas0–cas2 сообщает ведомому, что ведомый должен выдавать вектор прерываний на шину D0–D7.</p>
<p>Перед использованием контроллеров прерываний необходимо выполнить их настройку вначале ведущего КП, а затем ведомого. В процессе настройки ведущего КП нужно, в частности, указать к каким его входам подключены ведомые КП, а ведомого — к какому входу ведущего КП она подключена. К ведущему КП, может подключаться до восьми ведомых КП (в IBM PC используется только один), что в принципе позволяет обрабатывать до 64 запросов прерываний. После того, как ведущий КП передаёт в ЦП запрос на прерывание от ведомого КП и получает подтверждение, он выдаёт на локальную шину cas0–cas2 номер входа, к которому подключён ведомый контроллер. Ведомый контроллер отслеживает состояние входов на шине cas0–cas2, и когда обнаруживает свой номер, обрабатывает подтверждение своего запроса прерывания.</p>
<p><strong>Структура подключения контроллеров прерываний в IBM AT:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549859894" src="/docs/assets/images/1763549859894-bb432e4118550326d007e1aa5637a60d.png" width="624" height="344" class="img_ev3q"></p>
<p>Команды контроллера делятся на:</p>
<ul>
<li><strong>команды настройки (ICW)</strong></li>
<li><strong>рабочие команды (OCW)</strong>
Вначале рассмотрим команды настройки (командные слова ICW1, ICW2, ICW3 и ICW4). Слово ICW1 начинает процесс настройки КП. Оно задаёт по фронту или по уровню сигнала на входе КП нужно генерировать запрос на прерывание; работает ли контроллер в каскадном режиме (Master или Slave) или самостоятельно, а также имеется ли слово ICW4.</li>
</ul>
<p>Бит A0 в команде задаётся адресом порта в который она посылается.</p>
<p><strong>Структура командного слова ICW1:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549852179" src="data:image/png;base64,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" width="527" height="155" class="img_ev3q"></p>
<p>Слово ICW1 должно выводиться в порт 20h для ведущего контроллера и в порт 0A0h для ведомого.</p>
<p>Слово ICW2 указывает первый номер вектора прерываний, с которого генерируются все остальные. Этот номер должен быть кратен восьми. Векторы располагаются подряд, начиная с указанного, соответствующего IRQ0, и кончая &quot;указанный+7&quot;, соответствующим вектору IRQ7.</p>
<p><strong>Структура командного слова ICW2:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549841563" src="data:image/png;base64,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" width="448" height="154" class="img_ev3q"></p>
<p>Слово ICW2 должно выводиться в порт 21h для ведущего контроллера или в порт 0A1h для ведомого.</p>
<p><strong>Структура командного слова ICW3:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549834482" src="data:image/png;base64,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" width="420" height="156" class="img_ev3q"></p>
<p>Слово ICW3 должно выводиться в порт 21h для ведущего контроллера в порт 0A1h для ведомого.</p>
<p><strong>Структура командного слова ICW4:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549830191" src="/docs/assets/images/1763549830191-ce60fd3cd003135cfe09bd2a3f80bd44.png" width="554" height="164" class="img_ev3q"></p>
<p>Слово ICW4 должно выводиться в порт 21h ведущего КП и в порт 0A1h ведомого.</p>
<p><strong>Порядок настройки контроллера прерываний:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549820978" src="/docs/assets/images/1763549820978-c3c715440d5c21dcf917ece2097951ab.png" width="554" height="477" class="img_ev3q"></p>
<p><strong>Регистр маски</strong></p>
<p>Регистр IMR доступен для чтения всегда, ISR и IRR — только после выдачи соответствующих команд.</p>
<p>Теперь рассмотрим рабочие команды (OCW1, OCW2 и OCW3).</p>
<p><strong>Командное слово OCW1</strong></p>
<p>Для управления регистром маски IMR контроллера прерываний используется командное слово OCW1. Команда OCW1 маскирует отдельные запросы на прерывания. Единичные значения битов указывают, что поступающие запросы на прерывание с соответствующими им номерами игнорируются.</p>
<p>Слово OCW1 должно выводиться в порт 21h ведущего КП и 0A1h ведомого.</p>
<p><img decoding="async" loading="lazy" alt="1763549814826" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO4AAABACAIAAACSmtzrAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMMSURBVHhe7dzBctswDEXRpiv9/9d64UUWaBkGIDmkAFk0fM+io6GlV4p6tpXE46/n8/kHeH9/9QDwnqgykvi6/QbjOA418ng81MiSEng6R03pdI6QNE+I/4xEVI44jsOZU6+zM2qXKten4Vwg5+EiJERIlCewPnaHnKinROx13+IGw3kCNf9yxAqZjz9BROVIVGBalPurXPNf++M//cCiqJwoMhnn4oionN3sVWU/ecGQ93T92LQS4smRA8vz4XSOcE6myNrjvaqcbJXr50Ps+/tpyVZY2ajKm/C/8sWKmo/6sU8//P7u/w1GEfKaEfXDddn25Aj/lPwJtr47RMWu80ZVBjy4wUASVBlJUGUkQZWRBFVGElQZSVBlJEGVkQRVRhJUGUlQZSTx6s9gpPxMFl6p98GjG6rcm8oScsY+MIcbDCRBlZEEVUYSVBlJUGUkQZWRBFVGElQZSVBlJEGVkYT+w3Xv20Pst2/UezaPav6N0Q72cuynNcbhzWPVIc3B+ZzBV5ks5dQ72KPsiGzYnGasuCWn7ODMqdfZHmXDxa9XZdnPftNePV4GZdv+K/urqz5gZ1ZGyn9q97HsPnZ9Z6LsDuqsQ3IGl0Sxu8lI72L1XJ0Tdd3r+UxOSfxUWS1uSbHjZbtHJqFHF/kTivnevEbIfPwJIion6rqfFnCvPP+8GZBnTm8hBg8pvZx/35Y8PdWrc1b1cmQydrynl7O0yOOcJVE5MVV+CyfesKwS4skp73VlQ++xwjmZIqpPN9qoyr2lXF3lpZ0HLsqpnw/20YH5PcdszuoKixOHNEXl/FS5+aNec7xsf5TdTjxqPnWPozJvsfzLODtub3fUiqiHbIJs1M+Z8SHNwXGOHSnjdkQ2bE59XvYoOyIbNsfuUA/O5zQTxHxOfVI2aj5HrU/Iec3Mp9BVvtpgKkvIGfvAnI3ulQEPqowkqDKSoMpIgiojCaqMJKgykqDKSIIqIwmqjCSoMpK44TMYeghY0fsMxqurDFyEGwwkQZWRBFVGElQZSVBlJEGVkQRVRhLfAAgxAkWCR+8AAAAASUVORK5CYII=" width="238" height="64" class="img_ev3q"></p>
<p><strong>Командное слово OCW2:</strong></p>
<p><img decoding="async" loading="lazy" alt="1763549810318" src="/docs/assets/images/1763549810318-9fc8b95bd60f0291ad34fa9939fbc737.png" width="555" height="223" class="img_ev3q"></p>
<p><strong>Назначение битов командного слова OCW2:</strong></p>
<table><thead><tr><th>Бит</th><th>Назначение</th></tr></thead><tbody><tr><td>R=1</td><td>Управляет операциями, связанными с ротацией приоритетов</td></tr><tr><td>SL=1</td><td>Указывает, что команда относится к конкретному прерыванию, а не к последнему, подтверждённому на обслуживание (специальное в смысле заданное)</td></tr><tr><td>EOI=1</td><td>Окончание прерывания (сброс разряда в ISR)</td></tr><tr><td>L0-L2</td><td>Номер запроса на прерывание, для которого выполняется команда, используется совместно с SL=1</td></tr></tbody></table>
<p>Изменение уровней приоритетов вступает в силу только по завершении обработки прерывания (после команды EOI, например).</p>
<p>Когда уровни приоритетов не изменяются, достаточно обычного EOI, когда используются команды ротации приоритетов в обработчике прерываний, нужно использовать специальную команду EOI, явно указывая номер завершаемого прерывания. На использование автоматического завершения прерывания можно программировать контроллер только тогда, когда частота прерываний не очень велика, иначе может возникнуть ситуация сверхвложения (когда одно и то же прерывание вызывается на столько часто, что обработчик не успевает его отработать, при этом оно блокирует вызов всех остальных, и может возникнуть переполнение стека). Если производится ротация приоритетов прерываний, во время обработки прерывания, то приоритеты будут только после окончания обработки (выдачи команды EOI). Т. е. если после ротации приоритетов если, вдруг оказался запрос с более высоким приоритетом, чем у обрабатываемого, то оно обрабатываться не будет до тех пор, пока текущий обработчик прерываний не выдаст команду EOI.
Все возможные варианты расположения уровней приоритетов при ротации:</p>
<table><thead><tr><th>Вход микросхемы</th><th>Статус уровня приоритета</th></tr></thead><tbody><tr><td>IRQ0</td><td>7 6 5 4 3 2 1 0</td></tr><tr><td>IRQ1</td><td>0 7 6 5 4 3 2 1</td></tr><tr><td>IRQ2</td><td>1 0 7 6 5 4 3 2</td></tr><tr><td>IRQ3</td><td>2 1 0 7 6 5 4 3</td></tr><tr><td>IRQ4</td><td>3 2 1 0 7 6 5 4</td></tr><tr><td>IRQ5</td><td>4 3 2 1 0 7 6 5</td></tr><tr><td>IRQ6</td><td>5 4 3 2 1 0 7 6</td></tr><tr><td>IRQ7</td><td>6 5 4 3 2 1 0 7</td></tr></tbody></table>
<p>Слово OCW2 должно выводиться в порт 20h для ведущего КП и в порт 0A0h для ведомого. Команда OCW3 используется для выдачи различных режимов и команд в 8259A. OCW3 имеет две функции:</p>
<p>- <strong>Выдаёт состояния прерываний</strong>
- <strong>Управляет маскированием прерываний</strong></p>
<ul>
<li><strong>Выдаёт состояния прерываний</strong></li>
<li><strong>Управляет маскированием прерываний</strong></li>
</ul>
<p><img decoding="async" loading="lazy" alt="1763549748287" src="/docs/assets/images/1763549748287-00120e9f353ebe84ebff3c45856e2319.png" width="547" height="187" class="img_ev3q"></p>
<p><strong>Назначение битов:</strong></p>
<p>| Бит | Назначение |
|-----|------------|
| RR=1 | Выполняется команда чтения регистра |
| RIS=0 | Читать IRR; RIS=1 — читать ISR |
| ESMM=1 | Включается или выключается режим специального маскирования |
| SMM=1 | Включить; SMM=0 — выключить |
| P | Выдаётся команда опроса |</p>
<p>Режим опроса необходим, когда устройства имеют общую программу-обработчик прерываний, а также при количестве запросов больше 64. Инициатором опроса является команда, посылающая слово OCW3, по которой микропроцессор блокирует свой вход INTR и подготавливает цепи в КП (контроллере прерываний), необходимые для опроса. Затем в контроллер передаётся команда чтения порта 20h (для ведущего) или A0h (для ведомого КП), по которой по наиболее приоритетному запросу устанавливается соответствующий разряд ISR и сбрасывается одноимённый разряд IRR) и на шину X выдаётся слово опроса прерываний, структура которого следующая:</p>
<p><img decoding="async" loading="lazy" alt="1763549740207" src="data:image/png;base64,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" width="430" height="131" class="img_ev3q"></p>
<p>По полученной информации программа либо перейдёт на программу-обработчик приоритетного прерывания, либо ликвидирует следы обслуживаемого прерывания командой EOI. При необходимости операции опроса может повторяться до тех пор, пока разряд I (D7) не станет равным нулю.</p>
<p>Слово OCW3 выводится в порт 20h ведущего контроллера и в порт 0A0h ведомого контроллера.</p>
<p>Подробнее можно почитать: <a href="https://ibzh.eko3.ru/asm/irq.htm" target="_blank" rel="noopener noreferrer">Программируемый контроллер прерываний</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="как-работать-с-gdb">Как работать с GDB?<a href="#как-работать-с-gdb" class="hash-link" aria-label="Прямая ссылка на Как работать с GDB?" title="Прямая ссылка на Как работать с GDB?">​</a></h3>
<ul>
<li><code>b *адрес</code> - установить точку останова по адресу</li>
<li><code>x/40i</code> - дизассемблировать 40 инструкций, начиная с адреса</li>
<li><code>display/i $eip</code> - отображать следующую инструкцию при каждом шаге</li>
<li><code>c</code> - продолжить выполнения программы до следующей точки останова</li>
<li><code>stepi</code> - выполнить одну инструкцию (ассемблерный шаг)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="чеклист-выполнения">Чеклист выполнения<a href="#чеклист-выполнения" class="hash-link" aria-label="Прямая ссылка на Чеклист выполнения" title="Прямая ссылка на Чеклист выполнения">​</a></h2>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Подготовлена директория <code>lab3</code> и созданы необходимые файлы (<code>lab3_1.s</code>, <code>lab3_2.s</code>, <code>boot.S</code>, заголовки).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Программа <code>lab3_1</code> успешно собрана и запущена.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнен тест исключения деления на ноль.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Проведен анализ стека до и после исключения в GDB.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнены тесты для несуществующей инструкции (UD2), <code>int 3</code> и других исключений.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Реализован и протестирован обработчик для индивидуального задания (остаток от деления номера группы на 17).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Программа <code>lab3_2</code> успешно собрана и запущена.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Протестирована работа с прерываниями клавиатуры и таймера.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Проведены эксперименты с флагом прерываний (IF) и маскированием в PIC.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Проверен эффект отсутствия сигнала EOI.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнено дополнительное задание (убрать вывод <code>^</code> при отжатии клавиши).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="вопросы-для-самоконтроля">Вопросы для самоконтроля<a href="#вопросы-для-самоконтроля" class="hash-link" aria-label="Прямая ссылка на Вопросы для самоконтроля" title="Прямая ссылка на Вопросы для самоконтроля">​</a></h2>
<ol>
<li>Что такое прерывание и как оно работает в процессоре?</li>
<li>Какие виды прерываний существуют (аппаратные, программные, исключения)?</li>
<li>В чём разница между немаскируемыми и маскируемыми прерываниями?</li>
<li>Какие типы исключений существуют (сбой, ловушка, аварийное завершение)?</li>
<li>Что такое IDT (Interrupt Descriptor Table) и как она используется в защищённом режиме?</li>
<li>Как процессор определяет, какой обработчик вызвать при возникновении прерывания или исключения?</li>
<li>Какие данные хранятся в дескрипторе шлюза прерывания?</li>
<li>Как загружается и настраивается IDT?</li>
<li>Как процессор обрабатывает исключения, такие как деление на ноль или недопустимый код операции?</li>
<li>Что происходит с регистрами и стеком при возникновении исключения?</li>
<li>Как написать собственный обработчик исключения на ассемблере?</li>
<li>Как установить точку останова в GDB?</li>
<li>Как просмотреть состояние регистров и стека в GDB?</li>
<li>Как дизассемблировать код в GDB и сравнить его с исходным ассемблерным кодом?</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="выполнение-лабораторной-работы">Выполнение лабораторной работы<a href="#выполнение-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Выполнение лабораторной работы" title="Прямая ссылка на Выполнение лабораторной работы">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-1-подготовка-к-выполнению-лабораторной-работы">Часть 1. Подготовка к выполнению лабораторной работы<a href="#часть-1-подготовка-к-выполнению-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Часть 1. Подготовка к выполнению лабораторной работы" title="Прямая ссылка на Часть 1. Подготовка к выполнению лабораторной работы">​</a></h3>
<ol>
<li>Создайте директорию для выполнения лабораторной работы <code>mkdir lab3</code> и перейти в неё <code>cd lab3</code>, создайте директорию <code>img</code>, в ней будут храниться файлы необходимые для загрузчика.</li>
<li>Создайте по примеру лабораторной работы №1 необходимые для данной лабораторной работы файлы упомянутые в разделе исходные файлы. Скопируйте код предоставленный в приложении.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-2-выполнение-лабораторной-работы-3_1">Часть 2. Выполнение лабораторной работы 3_1<a href="#часть-2-выполнение-лабораторной-работы-3_1" class="hash-link" aria-label="Прямая ссылка на Часть 2. Выполнение лабораторной работы 3_1" title="Прямая ссылка на Часть 2. Выполнение лабораторной работы 3_1">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-запуск-программы">2.1. Запуск программы<a href="#21-запуск-программы" class="hash-link" aria-label="Прямая ссылка на 2.1. Запуск программы" title="Прямая ссылка на 2.1. Запуск программы">​</a></h4>
<p>Запустите программу, наблюдайте успешное выполнение.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-тест-деления-на-ноль">2.2. Тест деления на ноль<a href="#22-тест-деления-на-ноль" class="hash-link" aria-label="Прямая ссылка на 2.2. Тест деления на ноль" title="Прямая ссылка на 2.2. Тест деления на ноль">​</a></h4>
<p>Отредактируйте файл <code>lab3_1.S</code>: расскомментируйте строки кода, где производится деление на 0</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="23-сборка">2.3. Сборка<a href="#23-сборка" class="hash-link" aria-label="Прямая ссылка на 2.3. Сборка" title="Прямая ссылка на 2.3. Сборка">​</a></h4>
<p>Соберите программу, используя команду <code>make 1</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="24-запуск-с-исключением">2.4. Запуск с исключением<a href="#24-запуск-с-исключением" class="hash-link" aria-label="Прямая ссылка на 2.4. Запуск с исключением" title="Прямая ссылка на 2.4. Запуск с исключением">​</a></h4>
<p>Запустите программу с помощью команды <code>qemu-system-i386 -hda boot.img -m 32</code>. Посмотрите на вывод текста об исключении</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="25-анализ-адресов">2.5. Анализ адресов<a href="#25-анализ-адресов" class="hash-link" aria-label="Прямая ссылка на 2.5. Анализ адресов" title="Прямая ссылка на 2.5. Анализ адресов">​</a></h4>
<p>С помощью команды <code>objdump -m i386 -D lab3_1.elf</code> вы можете найти адрес обработчика исключений, а также адрес начала стека</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="26-отладка">2.6. Отладка<a href="#26-отладка" class="hash-link" aria-label="Прямая ссылка на 2.6. Отладка" title="Прямая ссылка на 2.6. Отладка">​</a></h4>
<p>Запустите отладчик GDB. Не забудьте добавить флаги <code>-s -S</code> в команду <code>qemu-system-i386 -hda boot.img -m 32</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="27-анализ-стека">2.7. Анализ стека<a href="#27-анализ-стека" class="hash-link" aria-label="Прямая ссылка на 2.7. Анализ стека" title="Прямая ссылка на 2.7. Анализ стека">​</a></h4>
<p>Покажите стек до и после появления исключения, опишите, что в нём присутствует.</p>
<p><strong>Подсказка:</strong></p>
<ul>
<li>Перейдите на адрес инструкции, которая вызывает исключение</li>
<li>Вы можете распечатать стек с помощью команды <code>x/16x $esp+адрес_начала_стека</code></li>
<li>Сделайте шаг в программе с помощью <code>stepi</code> (попадёте в обработчик исключения)</li>
</ul>
<p><strong>Задание для lab3_1:</strong></p>
<p>Проведите действия пункта 2.1. - 2.5. для несуществующей инструкции(ud2), int nop nop nop, несуществующего селектора.</p>
<p>Выберите исключение в IDT равное остатку от деления вашего номера в группе на 17 (исключения с null_descr в IDT пропускать), добавьте в код программы действия которые его вызовут и проанализируйте его также, как и предыдущие.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-3-выполнение-лабораторной-работы-3_2">Часть 3. Выполнение лабораторной работы 3_2<a href="#часть-3-выполнение-лабораторной-работы-3_2" class="hash-link" aria-label="Прямая ссылка на Часть 3. Выполнение лабораторной работы 3_2" title="Прямая ссылка на Часть 3. Выполнение лабораторной работы 3_2">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="31-сброс-флага-прерываний">3.1. Сброс флага прерываний<a href="#31-сброс-флага-прерываний" class="hash-link" aria-label="Прямая ссылка на 3.1. Сброс флага прерываний" title="Прямая ссылка на 3.1. Сброс флага прерываний">​</a></h4>
<p>Сбросьте флаг прерываний в обработчике прерывания int 80 (trap_handler).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="32-сборка">3.2. Сборка<a href="#32-сборка" class="hash-link" aria-label="Прямая ссылка на 3.2. Сборка" title="Прямая ссылка на 3.2. Сборка">​</a></h4>
<p>Соберите программу, используя команду <code>make 2</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="33-запуск-и-тестирование">3.3. Запуск и тестирование<a href="#33-запуск-и-тестирование" class="hash-link" aria-label="Прямая ссылка на 3.3. Запуск и тестирование" title="Прямая ссылка на 3.3. Запуск и тестирование">​</a></h4>
<p>Запустите программу с помощью команды <code>qemu-system-i386 -hda boot.img -m 32</code>.</p>
<p>Попробуйте ввести текст с клавиатуры, а также обратите внимание на таймер (пока выводится текст на зелёном фоне, если нужно, увеличьте задержку вывода текста).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="34-тест-с-флагом-прерываний">3.4. Тест с флагом прерываний<a href="#34-тест-с-флагом-прерываний" class="hash-link" aria-label="Прямая ссылка на 3.4. Тест с флагом прерываний" title="Прямая ссылка на 3.4. Тест с флагом прерываний">​</a></h4>
<p>Сбросьте флаг прерываний в обработчике прерываний клавиатуры (keyboard_ISR), установите флаг прерываний, пересоберите программу, запустите её.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="35-проверка-работы">3.5. Проверка работы<a href="#35-проверка-работы" class="hash-link" aria-label="Прямая ссылка на 3.5. Проверка работы" title="Прямая ссылка на 3.5. Проверка работы">​</a></h4>
<p>Попробуйте вводить текст с клавиатуры, обратите внимание на вывод текста на зелёном фоне, таймер.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="36-запрет-прерываний-клавиатуры">3.6. Запрет прерываний клавиатуры<a href="#36-запрет-прерываний-клавиатуры" class="hash-link" aria-label="Прямая ссылка на 3.6. Запрет прерываний клавиатуры" title="Прямая ссылка на 3.6. Запрет прерываний клавиатуры">​</a></h4>
<p>Запретите прерывания клавиатуры в инициализации регистра маски первого КП, пересоберите программу, запустите её.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="37-проверка-запрета">3.7. Проверка запрета<a href="#37-проверка-запрета" class="hash-link" aria-label="Прямая ссылка на 3.7. Проверка запрета" title="Прямая ссылка на 3.7. Проверка запрета">​</a></h4>
<p>Проверьте, что действительно обработки прерываний при нажатии клавиш не происходит.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="38-тест-без-eoi">3.8. Тест без EOI<a href="#38-тест-без-eoi" class="hash-link" aria-label="Прямая ссылка на 3.8. Тест без EOI" title="Прямая ссылка на 3.8. Тест без EOI">​</a></h4>
<p>Верните флаги прерываний, разрешите прерывания клавиатуры, отключите отправку EOI в обработчике прерывания клавиатуры, пересоберите и запустите программу, наблюдайте эффект.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="39-отладка">3.9. Отладка<a href="#39-отладка" class="hash-link" aria-label="Прямая ссылка на 3.9. Отладка" title="Прямая ссылка на 3.9. Отладка">​</a></h4>
<p>Включив отправку EOI, пересоберите программу, запустите её с поддержкой GDB/</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="310-исследование-обработчиков">3.10. Исследование обработчиков<a href="#310-исследование-обработчиков" class="hash-link" aria-label="Прямая ссылка на 3.10. Исследование обработчиков" title="Прямая ссылка на 3.10. Исследование обработчиков">​</a></h4>
<p>Подключившись по GDB исследуйте работу обработчиков прерываний (клавиатуры, таймера, int 80h).</p>
<p><strong>Дополнительно задание для lab3_2:</strong></p>
<p>Измените код так, чтобы при отжатии клавиатуры не выводился циркумфлекс (символ <code>^</code>)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="защита">Защита<a href="#защита" class="hash-link" aria-label="Прямая ссылка на Защита" title="Прямая ссылка на Защита">​</a></h2>
<ol>
<li>Объясните, как процессор обрабатывает прерывания и исключения в защищённом режиме.</li>
<li>Какие данные помещаются в стек при возникновении исключения? Как эти данные используются для восстановления состояния программы?</li>
<li>В чём разница между сбоем (Fault), ловушкой (Trap) и аварийным завершением (Abort)?</li>
<li>Перепишите обработчик прерывания для клавиатуры, так, чтобы он выводил скан-код нажатой клавиши на экран.</li>
<li>После возникновения исключения, проверьте содержимое стека. Какие данные были помещены в стек, и как они связаны с состоянием программы до исключения?</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Прямая ссылка на FAQ" title="Прямая ссылка на FAQ">​</a></h2>
<p><strong>Q: В чем разница между прерыванием и исключением?</strong>
A: <strong>Прерывание (Interrupt)</strong> — это асинхронное событие, инициируемое внешним устройством (например, клавиатурой). <strong>Исключение (Exception)</strong> — это синхронное событие, возникающее в результате выполнения инструкции процессора (например, деление на ноль или ошибка страницы).</p>
<p><strong>Q: Что такое IDT?</strong>
A: <strong>IDT (Interrupt Descriptor Table)</strong> — это таблица дескрипторов прерываний, которая связывает номер вектора прерывания с адресом его обработчика.</p>
<p><strong>Q: Зачем нужен контроллер прерываний (PIC)?</strong>
A: <strong>PIC (Programmable Interrupt Controller)</strong> управляет аппаратными прерываниями от внешних устройств, приоритизирует их и передает процессору.</p>
<p><strong>Q: Что такое EOI?</strong>
A: <strong>EOI (End of Interrupt)</strong> — это команда, которую обработчик прерывания должен отправить контроллеру прерываний, чтобы сообщить о завершении обработки текущего запроса. Без этого контроллер не будет отправлять новые прерывания.</p>
<p><strong>Q: Что сохраняется в стеке при возникновении исключения?</strong>
A: При возникновении исключения процессор автоматически сохраняет в стек регистр флагов (EFLAGS), сегмент кода (CS) и указатель инструкции (EIP). Для некоторых исключений также сохраняется код ошибки.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="дополнительные-материалы">Дополнительные материалы<a href="#дополнительные-материалы" class="hash-link" aria-label="Прямая ссылка на Дополнительные материалы" title="Прямая ссылка на Дополнительные материалы">​</a></h2>
<ul>
<li><a href="https://osdev.fandom.com/ru/wiki/IAM:%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_5" target="_blank" rel="noopener noreferrer">OSDev Wiki - Глава 5</a></li>
<li><a href="https://habr.com/ru/companies/timeweb/articles/780082/" target="_blank" rel="noopener noreferrer">Хабр - Прерывания и исключения</a></li>
<li><a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BA%D0%B0%D0%BD-%D0%BA%D0%BE%D0%B4" target="_blank" rel="noopener noreferrer">Скан-код на Википедии</a></li>
<li><a href="https://ibzh.eko3.ru/asm/irq.htm" target="_blank" rel="noopener noreferrer">Программируемый контроллер прерываний</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="приложение">Приложение<a href="#приложение" class="hash-link" aria-label="Прямая ссылка на Приложение" title="Прямая ссылка на Приложение">​</a></h2>
<p>Полный код программ, Makefile, linker.ld и другие файлы находятся в исходных документах лабораторной работы.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/efremovnv/docs/edit/main/website/docs/peripheral-devices/lab3.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Отредактировать эту страницу</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Последнее обновление<!-- --> <b><time datetime="2025-11-22T17:49:14.000Z" itemprop="dateModified">22 нояб. 2025 г.</time></b></span></div></div></footer></article><div class="margin-top--lg"><button class="button button--secondary button--sm">📄 Скачать PDF</button></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/labs/peripheral-devices/lab2"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">Лабораторная работа №2</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/labs/peripheral-devices/lab4"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">Лабораторная работа №4</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#контекст" class="table-of-contents__link toc-highlight">Контекст</a></li><li><a href="#сокращения" class="table-of-contents__link toc-highlight">Сокращения</a></li><li><a href="#цель-работы" class="table-of-contents__link toc-highlight">Цель работы</a></li><li><a href="#необходимые-инструменты" class="table-of-contents__link toc-highlight">Необходимые инструменты</a></li><li><a href="#исходные-файлы-лабораторной-работы" class="table-of-contents__link toc-highlight">Исходные файлы лабораторной работы</a></li><li><a href="#материалы-для-подготовки-к-лабораторной-работе" class="table-of-contents__link toc-highlight">Материалы для подготовки к лабораторной работе</a><ul><li><a href="#понятие-прерывания-и-исключения" class="table-of-contents__link toc-highlight">Понятие прерывания и исключения</a></li><li><a href="#основные-исключения-процессора-x86" class="table-of-contents__link toc-highlight">Основные исключения процессора X86</a></li><li><a href="#таблица-прерываний-и-исключений-защищённого-режима" class="table-of-contents__link toc-highlight">Таблица прерываний и исключений защищённого режима</a></li><li><a href="#программируемый-контроллер-прерываний" class="table-of-contents__link toc-highlight">Программируемый контроллер прерываний</a></li><li><a href="#как-работать-с-gdb" class="table-of-contents__link toc-highlight">Как работать с GDB?</a></li></ul></li><li><a href="#чеклист-выполнения" class="table-of-contents__link toc-highlight">Чеклист выполнения</a></li><li><a href="#вопросы-для-самоконтроля" class="table-of-contents__link toc-highlight">Вопросы для самоконтроля</a></li><li><a href="#выполнение-лабораторной-работы" class="table-of-contents__link toc-highlight">Выполнение лабораторной работы</a><ul><li><a href="#часть-1-подготовка-к-выполнению-лабораторной-работы" class="table-of-contents__link toc-highlight">Часть 1. Подготовка к выполнению лабораторной работы</a></li><li><a href="#часть-2-выполнение-лабораторной-работы-3_1" class="table-of-contents__link toc-highlight">Часть 2. Выполнение лабораторной работы 3_1</a></li><li><a href="#часть-3-выполнение-лабораторной-работы-3_2" class="table-of-contents__link toc-highlight">Часть 3. Выполнение лабораторной работы 3_2</a></li></ul></li><li><a href="#защита" class="table-of-contents__link toc-highlight">Защита</a></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li><li><a href="#дополнительные-материалы" class="table-of-contents__link toc-highlight">Дополнительные материалы</a></li><li><a href="#приложение" class="table-of-contents__link toc-highlight">Приложение</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">efremovnv</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Начало</a></li></ul></div><div class="col footer__col"><div class="footer__title">Ресурсы</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 efremovnv. Создано с помощью Docusaurus.</div></div></div></footer></div>
</body>
</html>