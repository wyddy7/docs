<!doctype html>
<html lang="ru-RU" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-peripheral-devices/lab2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Лабораторная работа №2 | efremovnv</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" name="twitter:image" content="https://efremovnv.github.io/docs/img/docusaurus.png"><meta data-rh="true" property="og:url" content="https://efremovnv.github.io/docs/labs/peripheral-devices/lab2"><meta data-rh="true" property="og:locale" content="ru_RU"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Лабораторная работа №2 | efremovnv"><meta data-rh="true" name="description" content="Реальный и защищённый режимы работы процессора X86. Переключение между режимами и сегментная адресация."><meta data-rh="true" property="og:description" content="Реальный и защищённый режимы работы процессора X86. Переключение между режимами и сегментная адресация."><link data-rh="true" rel="icon" href="/docs/img/logo2.svg"><link data-rh="true" rel="canonical" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab2"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab2" hreflang="ru-RU"><link data-rh="true" rel="alternate" href="https://efremovnv.github.io/docs/labs/peripheral-devices/lab2" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.b2f4074e.css">
<script src="/docs/assets/js/runtime~main.f7f1290e.js" defer="defer"></script>
<script src="/docs/assets/js/main.647d6c6e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/logo.svg"><link rel="preload" as="image" href="/docs/img/logo-dark.svg"><div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo-dark.svg" alt="Логотип" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">efremovnv</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/labs/intro">Методички</a><a class="navbar__item navbar__link" href="/docs/labs/contributing">Контрибьюция</a><a class="navbar__item navbar__link" href="/docs/labs/links">Ссылки</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-label="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/labs/intro">Учебные материалы по организации ЭВМ и систем</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/labs/peripheral-devices/lab1">Периферийные устройства</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab1">Лабораторная работа №1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/labs/peripheral-devices/lab2">Лабораторная работа №2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab3">Лабораторная работа №3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/labs/peripheral-devices/lab4">Лабораторная работа №4</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/computer-organization/lab7">Организация ЭВМ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/labs/course-work/rp-op-design">Курсовая работа</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Периферийные устройства</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Лабораторная работа №2</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><header><h1>Лабораторная работа №2</h1></header>
<p>Реальный и защищённый режимы работы процессора X86. Переключение между режимами и сегментная адресация.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="контекст">Контекст<a href="#контекст" class="hash-link" aria-label="Прямая ссылка на Контекст" title="Прямая ссылка на Контекст">​</a></h2>
<ul>
<li><strong>Для кого:</strong> Студенты курса &quot;Периферийные устройства&quot;, освоившие основы работы с инструментами разработки в Лабораторной работе №1.</li>
<li><strong>Цель:</strong> Изучить архитектуру защищённого режима процессора x86, механизм сегментной адресации, структуру GDT и процесс переключения между реальным и защищённым режимами.</li>
<li><strong>Необходимые знания:</strong> Понимание принципов работы процессора, регистров, ассемблера AT&amp;T.</li>
<li><strong>Расположение файлов:</strong> Исходный код и скрипты приведены в разделе &quot;Приложение&quot;.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="сокращения">Сокращения<a href="#сокращения" class="hash-link" aria-label="Прямая ссылка на Сокращения" title="Прямая ссылка на Сокращения">​</a></h2>
<ul>
<li><strong>BIOS</strong> – Base Input/Output System – базовая система ввода/вывода</li>
<li><strong>WSL</strong> – Windows Subsystem for Linux – подсистема Windows для Linux</li>
<li><strong>MBR</strong> – Master Boot Record – главная загрузочная запись</li>
<li><strong>CHS</strong> – Cylinder-Head-Sector – цилиндр-головка-сектор</li>
<li><strong>GPT</strong> – GUID (Globally Unique Identifier) Partition Table – таблица разделов глобальных уникальных идентификаторов</li>
<li><strong>LBA</strong> – Logical Block Addressing – логическая блочная адресация</li>
<li><strong>AT&amp;T</strong> – American Telephone and Telegraph</li>
<li><strong>GDT</strong> – Global Descriptor Table – глобальная таблица дескрипторов</li>
<li><strong>LDT</strong> – Local Descriptor Table – локальная таблица дескрипторов</li>
<li><strong>GDTR</strong> – Global Descriptor Table Register – регистр глобальной таблицы дескрипторов</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="цель-работы">Цель работы<a href="#цель-работы" class="hash-link" aria-label="Прямая ссылка на Цель работы" title="Прямая ссылка на Цель работы">​</a></h2>
<p>Целью данной лабораторной работы является изучение механизма сегментной адресации памяти в реальном и защищённом режимах работы процессора X86, структуры дескрипторов памяти и дескрипторных таблиц, практическая реализация перехода между реальным и защищённым режимами, а также изучение архитектуры машинных команд.</p>
<p>В процессе выполнения работы студенты:</p>
<ul>
<li>Познакомятся со структурой дескрипторов сегментов памяти</li>
<li>Узнают о преимуществах и ограничениях каждого режима, а также когда и почему используется тот или иной режим</li>
<li>Начнут понимать принцип кодирования и форматы машинных команд</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="необходимые-инструменты">Необходимые инструменты<a href="#необходимые-инструменты" class="hash-link" aria-label="Прямая ссылка на Необходимые инструменты" title="Прямая ссылка на Необходимые инструменты">​</a></h2>
<ul>
<li>Любой дистрибутив GNU/Linux: рекомендуется Ubuntu, также можно использовать виртуальную машину, например, WSL</li>
<li>Ассемблер: <code>as</code></li>
<li>Компоновщик: <code>ld</code></li>
<li>Утилиты для анализа объектных файлов: <code>objdump</code>, <code>readelf</code></li>
<li>Препроцессор: <code>cpp</code></li>
<li>Утилита для работы с дисками: <code>dd</code></li>
<li>Отладчик: <code>gdb</code></li>
<li>Утилита для автоматизации сборки проектов: <code>make</code></li>
<li>Эмулятор: <code>qemu</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="исходные-файлы-лабораторной-работы">Исходные файлы лабораторной работы<a href="#исходные-файлы-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Исходные файлы лабораторной работы" title="Прямая ссылка на Исходные файлы лабораторной работы">​</a></h2>
<p>Файлы, которые используются в лабораторной работе:</p>
<ul>
<li><strong>linker.ld</strong> - скрипт линковщика</li>
<li><strong>Makefile</strong> - необходимый для автоматизированной сборки проекта</li>
<li><strong>lab2.S</strong> - содержит программу для подготовки и перехода из реального режима в защищённый и обратно</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="материалы-для-подготовки-к-лабораторной-работе">Материалы для подготовки к лабораторной работе<a href="#материалы-для-подготовки-к-лабораторной-работе" class="hash-link" aria-label="Прямая ссылка на Материалы для подготовки к лабораторной работе" title="Прямая ссылка на Материалы для подготовки к лабораторной работе">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="реальный-режим-работы-процессора-x86">Реальный режим работы процессора X86<a href="#реальный-режим-работы-процессора-x86" class="hash-link" aria-label="Прямая ссылка на Реальный режим работы процессора X86" title="Прямая ссылка на Реальный режим работы процессора X86">​</a></h3>
<p>Режим реальных адресов - это модель памяти, которая поддерживается для обеспечения совместимости с программами, написанными для работы на процессоре X86.</p>
<p>Память разделена на блоки (сегменты) которые могут иметь размер от 16 Байт до 64 КБ. Каждый блок должен начинаться на 16-байтной границе (она называется параграфом), т.е. сегмент может начинаться только по адресу 0, 16, 32, 48 и т.д. В режиме реальных адресов объём памяти составляет 1 МБ (это адреса в диапазоне от 00000h до FFFFFh), чтобы использовать память выше 1МБ (HiMemory), нужно включить линию А20, которая позволяет адресовать больше памяти.</p>
<p>Чтобы получить доступ к памяти, процессор использует два числа: сегмент и смещение. Каждый раз перед тем как процессор обратится к памяти по адресу указанному в паре сегмент:смещение, он вычисляет адрес памяти по следующей схеме:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Физический адрес = Сегмент × 16 + Смещение</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Примечание!</strong> Умножение на 16 соответствует сдвигу влево на 4 разряда.</p>
<p><strong>Формирование адреса в реальном режиме:</strong></p>
<p><img decoding="async" loading="lazy" alt="Формирование адреса в реальном режиме" src="/docs/assets/images/real-mode-address-formation-441b5abcdfcb79d23bf45c0ca728c272.png" width="553" height="138" class="img_ev3q"></p>
<p>В этом режиме не доступны основные достоинства процессора - виртуальная память, мультизадачность, уровни привилегий и другие технологии.</p>
<p>Подробнее о реальном режиме можно почитать здесь: <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html" target="_blank" rel="noopener noreferrer">https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="защищённый-режим-работы-процессора-x86">Защищённый режим работы процессора X86<a href="#защищённый-режим-работы-процессора-x86" class="hash-link" aria-label="Прямая ссылка на Защищённый режим работы процессора X86" title="Прямая ссылка на Защищённый режим работы процессора X86">​</a></h3>
<p>Защищённый режим - это основной режим работы процессора. При работе в защищённом режиме процессор контролирует практически все действия программ и позволяет разделить операционную систему, драйвера и прикладные программы разными уровнями привилегий. В защищённом режиме максимально доступны все ресурсы процессора.</p>
<p>В этом режиме процессор следит за правильным выполнением текущей программой ряда условий, например, программа не должна обращаться по определённым адресам портов ввода/вывода, запрещённых для неё. Если всё же происходит нарушение, процессор генерирует специальный тип прерывания, так называемое исключение, передаёт информацию описывающую где произошло нарушение и как оно произошло обработчику исключения. Далее специальная процедура обрабатывает это прерывание и решает, что сделать с программой, например, прекратить её выполнение.</p>
<p><strong>Оптимальная схема работы программ по уровням привилегий:</strong></p>
<ul>
<li>Уровень 0: ядро операционной системы</li>
<li>Уровень 1: драйвера ОС</li>
<li>Уровень 2: интерфейс ОС</li>
<li>Уровень 3: прикладные программы</li>
</ul>
<p>Уровень привилегий 1, 2, и 3 подчиняются условиям, установленным на уровне 0.</p>
<p>В защищённом режиме процессора X86 в сегментных регистрах хранятся селекторы дескрипторов, которые являются индексами в таблицах дескрипторов GDT (глобальной таблице дескрипторов) или LDT (локальной таблице дескрипторов). Эти селекторы указывают на конкретные дескрипторы, содержащие полную информацию о сегменте, включая базовый адрес, предел, права доступа и другие атрибуты соответствующего сегмента памяти.</p>
<p><img decoding="async" loading="lazy" alt="Защищённый режим" src="/docs/assets/images/protected-mode-3128cd0e545d2d38b821811c820c4377.png" width="554" height="258" class="img_ev3q"></p>
<p>Подробнее о защищённом режиме можно почитать:</p>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html" target="_blank" rel="noopener noreferrer">https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html</a></li>
<li><a href="https://www.sasm.narod.ru/docs/pm/pm_in/main.htm" target="_blank" rel="noopener noreferrer">https://www.sasm.narod.ru/docs/pm/pm_in/main.htm</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="структура-и-организация-дескрипторов-и-селекторов-памяти-дескрипторные-таблицы">Структура и организация дескрипторов и селекторов памяти. Дескрипторные таблицы<a href="#структура-и-организация-дескрипторов-и-селекторов-памяти-дескрипторные-таблицы" class="hash-link" aria-label="Прямая ссылка на Структура и организация дескрипторов и селекторов памяти. Дескрипторные таблицы" title="Прямая ссылка на Структура и организация дескрипторов и селекторов памяти. Дескрипторные таблицы">​</a></h3>
<p>При адресации памяти в защищённом режиме команды ссылаются на сегменты, указывая не их адреса (как в режиме реальных адресов), а описания сегментов (их дескрипторы). Указатель на описание сегмента, т. е. на дескриптор называется селектор. Другими словами, селектор - это номер дескриптора в таблице и указатель в какой таблице он размещен, или в глобальной, или в локальной.</p>
<p>Селектор представляет собой 16-битное значение и имеет следующую структуру:</p>
<p><img decoding="async" loading="lazy" alt="Структура селектора" src="/docs/assets/images/selector-structure-4f70f34820ded1bb8d12f8bda2f659a0.png" width="306" height="145" class="img_ev3q"></p>
<ul>
<li><strong>Index</strong> - это номер дескриптора в таблице, от 0 до 8191</li>
<li><strong>TI</strong> - определяет таблицу, из которой выбирается нужный дескриптор. Если бит установлен в 0, то обращение производится к глобальной таблице дескрипторов, а если в 1, то к текущей локальной дескрипторной таблице</li>
<li><strong>RPL</strong> - двухбитовое поле, которое содержит запрашиваемый уровень привилегий</li>
</ul>
<p>Чтобы программа могла использовать сегмент, его селектор должен быть загружен в один из сегментных регистров. Процессор предоставляет 6 таких регистров. Каждый из этих сегментных регистров поддерживает определённый тип обращения к памяти (код, стек или данные). Для выполнения практически любой программы как минимум понадобятся регистры сегмента кода (CS), сегмента данных (DS) и сегмента стека (SS) и, следовательно, они должны быть загружены. Остальные три дополнительных регистра сегмента данных (ES, FS и GS) могут использоваться для предоставления дополнительных сегментов данных текущей выполняемой программе. Таким образом, хотя система может определять тысячи сегментов, только 6 из них могут быть доступны для немедленного использования. Другие сегменты могут стать доступными путём загрузки их селекторов в эти регистры, но только уже во время выполнения программы.</p>
<p><strong>Дескриптор сегмента</strong> - это структура данных в GDT (глобальной таблице дескрипторов) или LDT (локальной таблице дескрипторов), которая предоставляет процессору информацию о размере и местоположении сегмента, а также другие данные.</p>
<p>Структура дескриптора представляет собой:</p>
<p><img decoding="async" loading="lazy" alt="Структура дескриптора" src="/docs/assets/images/descriptor-structure-63166500804f9a9b1ab60ad2e8a4c452.png" width="545" height="174" class="img_ev3q"></p>
<ul>
<li><strong>Адрес сегмента или базовый адрес</strong> - определяет расположение сегмента в линейном адресном пространстве объёмом 4 ГБ. Процессор объединяет три поля базового адреса в одно 32-битное значение. Другими словами, по этому адресу размещается байт сегмента со смещением ноль.</li>
<li><strong>Предел сегмента</strong> - указывает размер сегмента. Процессор объединяет два поля предела сегмента, чтобы получить 20-битное значение. Интерпретация предела сегмента зависит от состояния флага G.<!-- -->
<ul>
<li>Если флаг гранулярности сброшен, размер сегмента указывается в байтах. Он может варьироваться от 1 байта до 1МБ, с шагом в 1 байт.</li>
<li>Если флаг гранулярности установлен, размер сегмента указывается в страницах. Он может варьироваться от одной страницы (4 КБ) до 4 ГБ, с шагом в 4 КБ. То есть один сегмент может включать всё адресное пространство ПК.</li>
</ul>
</li>
<li><strong>Флаг G</strong> - гранулярность. Если 0, то предел сегмента определяется в байтах, иначе если 1, то в 4 КБ страницах. (Этот флаг не влияет на гранулярность базового адреса - она всегда в байтах)</li>
<li><strong>Поле DPL</strong> - указывает уровень привилегий дескрипторов. Другими словами, уровень привилегий объекта, описываемого дескриптором. От 0 до 3, где 0 - это самый привилегированный уровень</li>
<li><strong>Поле S</strong> - указывает, является ли дескриптор системным (1 = дескриптор не системный).</li>
</ul>
<p><strong>Тип сегмента</strong> - трёхбитовое поле, где каждый бит типа сегмента имеет следующие значения:</p>
<ul>
<li>Старший бит (3-ий): если 0, то это сегмент данных, если 1 - то кода</li>
<li>Средний бит (2-ой) W (write-enable): если 0, то запись запрещена, если 1 - то разрешена</li>
<li>Младший бит (1-ый) E (expansion-description): направление расширения сегмента если 0, то вверх (в сторону старших адресов) - как обычно, если 1, то вниз (в сторону младших адресов) - как в стеке</li>
<li>0-й бит поля type — бит A в зависимости от поля S означает было ли обращение к сегменту(в случае S=1) или выступает как дополнительный бит в описании типа сегмента(в случае S=1)</li>
</ul>
<p>Для сегментов кода значения битов W и E интерпретируются несколько иначе.</p>
<table><thead><tr><th>Биты</th><th>11</th><th>10(E)</th><th>9(W)</th><th>Описание</th></tr></thead><tbody><tr><td><strong>данные</strong></td><td>0</td><td>0</td><td>0</td><td>Сегмент данных только для чтения</td></tr><tr><td></td><td>0</td><td>0</td><td>1</td><td>Сегмент данных для чтения/записи</td></tr><tr><td></td><td>0</td><td>1</td><td>0</td><td>Сегмент данных только для чтения, растёт вниз</td></tr><tr><td></td><td>0</td><td>1</td><td>1</td><td>Сегмент данных для чтения/записи, растёт вниз</td></tr><tr><td><strong>код</strong></td><td>1</td><td>0</td><td>0</td><td>Сегмент кода только для выполнения</td></tr><tr><td></td><td>1</td><td>0</td><td>1</td><td>Сегмент кода для выполнения/чтения</td></tr><tr><td></td><td>1</td><td>1</td><td>0</td><td>Согласованный сегмент кода только для выполнения</td></tr><tr><td></td><td>1</td><td>1</td><td>1</td><td>Согласованный сегмент кода для выполнения/чтения</td></tr></tbody></table>
<p><strong>Поле P</strong> - присутствие сегмента в памяти. Если этот бит установлен, то сегмент есть в памяти, если сброшен, то его нет. Этот бит применяется при реализации механизма виртуальной памяти - если программе понадобится память, то она сохранит содержимое какого-либо сегмента на диск и сбросит бит P. Если любая программа в дальнейшем обратится к этому сегменту, то процессор сгенерирует исключение неприсутствующего сегмента и запустит обработчик этой ситуации, который должен будет подгрузить содержимое сегмента с диска и установить бит P. После этого управление снова передаётся команде, обратившейся к этому сегменту (производится повторное выполнение команды, вызвавшей сбой) и работа программы будет продолжена. Бит P устанавливается и сбрасывается программами, сам процессор его только считывает</p>
<p><strong>Поле D</strong> - размер операндов по умолчанию.</p>
<ul>
<li>Если бит сброшен, по процессор использует объект, описываемый данным дескриптором, как 16-разрядный</li>
<li>Если бит установлен - то как 32-разрядный.</li>
</ul>
<p>Если ваша программа имеет 32-разрядный код, то он должен размещаться в 32-разрядном сегменте кода (т.е. в дескрипторе такого сегмента бит D должен быть равен 1).</p>
<p>Каждая система должна иметь одну определённую GDT (глобальную таблицу дескрипторов), которая может использоваться для всех программ в системе. Дополнительно могут быть определены одна или несколько LDT (локальных таблиц дескрипторов). Например, LDT может быть определена для каждой отдельной задачи, выполняемой в системе, или несколько программ могут совместно использовать одну и ту же LDT.</p>
<p>GDT не является сегментом, она представляет структуру данных в линейном адресном пространстве. Базовый линейный адрес и граница GDT должны быть загружены в регистр GDTR. Поскольку дескрипторы сегментов всегда имеют длину 8 байт, граница GDT всегда должна быть на единицу меньше числа, кратного 8 (т.е. 8N - 1).</p>
<p>Первый дескриптор в GDT не используется процессором, селектор сегмента, указывающий на &quot;нулевой дескриптор&quot; всегда вызывает исключение общей защиты.</p>
<p>LDT (локальная дескрипторная таблица) располагается в системном(бит S=0) сегменте типа LDT. GDT должна содержать дескриптор сегмента для этого сегмента LDT. Если система поддерживает несколько LDT, каждая из таблиц должна иметь отдельный селектор сегмента и дескриптор в GDT.</p>
<p>Глобальная и локальная дескрипторные таблицы:</p>
<p><img decoding="async" loading="lazy" alt="Глобальная и локальная дескрипторные таблицы" src="/docs/assets/images/gdt-ldt-f5898bc6902d04c13f43adf988bb809f.png" width="554" height="508" class="img_ev3q">
Подробнее можно почитать: <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html" target="_blank" rel="noopener noreferrer">https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html</a> PROTECTED-MODE MEMORY MANAGEMENT</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="разбор-машинных-команд">Разбор машинных команд<a href="#разбор-машинных-команд" class="hash-link" aria-label="Прямая ссылка на Разбор машинных команд" title="Прямая ссылка на Разбор машинных команд">​</a></h3>
<p>Машинная команда - это инструкция, которую выполняет процессор. Каждая машинная команда может содержать от одного байта до 15 байт.</p>
<p><strong>Структура машинной команды:</strong></p>
<p><img decoding="async" loading="lazy" alt="Структура машинной команды" src="/docs/assets/images/machine-command-structure-16f347fb4ccdeedf9930f30a60faf64d.png" width="554" height="103" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Префиксы] [Код операции] [modR/M] [SIB] [Смещение] [Непосредственный операнд]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Кроме поля кода операции все остальные поля являются необязательными, т.е. в одних командах могут присутствовать, а в других нет.</p>
<p><strong>Префиксы делятся на 4 группы:</strong></p>
<p><strong>Блокировки и повторения:</strong></p>
<ul>
<li><code>0xF0h</code> - LOCK префикс</li>
<li><code>0xF2h</code> - REPNZ (только для строковых инструкций)</li>
<li><code>0xF3h</code> - REP (только для строковых инструкций)</li>
</ul>
<p><strong>Переопределения сегмента:</strong></p>
<ul>
<li><code>0x2Eh</code> - CS:</li>
<li><code>0x36h</code> - SS:</li>
<li><code>0x3Eh</code> - DS:</li>
<li><code>0x26h</code> - ES:</li>
<li><code>0x64h</code> - FS:</li>
<li><code>0x65h</code> - GS:</li>
</ul>
<p><strong>Переопределения размеров операндов:</strong></p>
<ul>
<li><code>0x66h</code></li>
</ul>
<p><strong>Переопределение размеров адреса:</strong></p>
<ul>
<li><code>0x67h</code></li>
</ul>
<p><strong>Код операции</strong> чаще всего имеет следующую структуру:</p>
<p><img decoding="async" loading="lazy" alt="Структура кода операции" src="data:image/png;base64,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" width="411" height="96" class="img_ev3q"></p>
<p>Поле кода операции занимает 8 бит.</p>
<ul>
<li>Поле размера указывает на размер операндов<!-- -->
<ul>
<li>0 - операнды имеют размер 1 Байт</li>
<li>1 - операнды имеют размер в слово (двойное слово в 32-битном режиме или 16-битном режиме с префиксом 0x66)</li>
</ul>
</li>
<li>Поле направления обозначает, какой из операндов будет приёмником<!-- -->
<ul>
<li>0 - приёмник правый операнд</li>
<li>1 - приёмник левый операнд</li>
</ul>
</li>
</ul>
<p><strong>Байт modR/M:</strong></p>
<p><img decoding="async" loading="lazy" alt="Структура байта modR/M" src="data:image/png;base64,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" width="340" height="75" class="img_ev3q"></p>
<ul>
<li>Поле reg задаёт регистр общего назначения</li>
<li>Поле r/m задаёт либо регистр, либо память</li>
<li>Действует совместно с полем mod</li>
<li>Даёт возможность указать 8 регистров и 24 варианта для задания формы и режима адресации памяти</li>
</ul>
<p>Если mod содержит 11b, то два следующих поля будут представлять собой регистры. Но по байту modR/M нельзя точно установить регистры, в зависимости от кода операции и префиксов размера операндов, результат может коренным образом измениться.</p>
<p><strong>Байт SIB:</strong></p>
<p>Возможен в команде только в 32-битном режиме, и только в том случает, когда в команде уже есть байт MRM.</p>
<p>Байт SIB позволяет применять ещё более сложные формы для задания адреса в памяти.</p>
<p>Подробнее о сокращённой форме можно прочитать: <a href="https://looch-disasm.narod.ru/refe09.htm" target="_blank" rel="noopener noreferrer">https://looch-disasm.narod.ru/refe09.htm</a></p>
<p>Пример №1 разбора команды:</p>
<p><img decoding="async" loading="lazy" alt="Пример №1 разбора команды" src="/docs/assets/images/command-disassembly-example1-4e2842fe26d02fcd92df257cb71d1213.png" width="345" height="178" class="img_ev3q"></p>
<p>Пример №2 разбора команды:</p>
<p><img decoding="async" loading="lazy" alt="Пример №2 разбора команды" src="/docs/assets/images/command-disassembly-example2-340b37126508c12d85abd1e524ca5e0b.png" width="554" height="152" class="img_ev3q"></p>
<p>Пример №3 разбора команды:</p>
<p><img decoding="async" loading="lazy" alt="Пример №3 разбора команды" src="/docs/assets/images/command-disassembly-example3-b4853d3add919b81a14aba346b35c071.png" width="554" height="189" class="img_ev3q"></p>
<p>Преобразуем машинный код EA 36 00 08 00 в инструкцию:</p>
<ol>
<li>Зайдём на сайт: <a href="https://looch-disasm.narod.ru/refe09.htm" target="_blank" rel="noopener noreferrer">https://looch-disasm.narod.ru/refe09.htm</a></li>
<li>Открываем вкладку &quot;Первый байт кода операции&quot;, находим EA в таблице</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Таблица кодов операций" src="/docs/assets/images/opcode-table-da60b257d8d571e2f8cdb43d577aa099.png" width="542" height="123" class="img_ev3q"></p>
<ol start="3">
<li>Переходим по ссылке &quot;Переход и процедуры&quot;. Определяем команду</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Команда перехода" src="/docs/assets/images/jump-command-a9b100a7a3290f10c58ec61bd8542304.png" width="524" height="234" class="img_ev3q"></p>
<p>Ниже на этом сайте сказано, что в варианте 3 (который нам нужен) выполняется дальний FAR переход. В 16-битном режиме полный указатель (ptr16:16) занимает четыре байта. 16 бит для смещения и 16 бит для сегмента кода.</p>
<p>Т.е. команда выполняет дальний переход по адресу 0008:0036. Вы можете самостоятельно определить физический адрес с помощью формулы указанной в разделе &quot;Реальный режим работы процессора X86&quot;.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="вопросы-для-самоконтроля">Вопросы для самоконтроля<a href="#вопросы-для-самоконтроля" class="hash-link" aria-label="Прямая ссылка на Вопросы для самоконтроля" title="Прямая ссылка на Вопросы для самоконтроля">​</a></h2>
<ol>
<li>Что такое реальный режим работы процессора X86?</li>
<li>Что такое защищённый режим? Какие преимущества он представляет по сравнению с реальным режимом?</li>
<li>Что такое дескриптор сегмента? Какие поля он содержит и для чего они используются?</li>
<li>Что такое GDT и LDT? В чём их отличия?</li>
<li>Как процессор переключается между реальным и защищённым режимами?</li>
<li>Что такое селектор? Как он связан с дескриптором?</li>
<li>Какие уровни привилегий существуют и как они распределяются?</li>
<li>Что такое машинная команды? Какие префиксы могут использоваться в машинных командах X86?</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="выполнение-лабораторной-работы">Выполнение лабораторной работы<a href="#выполнение-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Выполнение лабораторной работы" title="Прямая ссылка на Выполнение лабораторной работы">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-1-подготовка-к-выполнению-лабораторной-работы">Часть 1. Подготовка к выполнению лабораторной работы<a href="#часть-1-подготовка-к-выполнению-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Часть 1. Подготовка к выполнению лабораторной работы" title="Прямая ссылка на Часть 1. Подготовка к выполнению лабораторной работы">​</a></h3>
<ol>
<li>Создайте файлы <code>lab2.S</code>, <code>linker.ld</code> и <code>Makefile</code>. Скопируйте код предоставленный в приложении</li>
<li>Соберите программу, используя <code>make</code> и запустите её с помощью команды <code>qemu-system-i386 -hda boot.img -m 32</code>. Как работать с make подробно рассказывается в Лабораторной работе №1.</li>
<li>Наблюдайте постепенный вывод таблицы ASCII, а затем сообщение о возврате в реальный режим</li>
<li>Замените выводимый при переходе в реальный режим текст (метка <code>.mesg</code>) на &quot;ФИО вернулся в реальный режим&quot; и запустите программу, чтобы убедиться в её нормальной работе</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-2-анализ-программы">Часть 2. Анализ программы<a href="#часть-2-анализ-программы" class="hash-link" aria-label="Прямая ссылка на Часть 2. Анализ программы" title="Прямая ссылка на Часть 2. Анализ программы">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-запуск-с-отладкой">2.1. Запуск с отладкой<a href="#21-запуск-с-отладкой" class="hash-link" aria-label="Прямая ссылка на 2.1. Запуск с отладкой" title="Прямая ссылка на 2.1. Запуск с отладкой">​</a></h4>
<p>Запустите эмулятор с поддержкой отладки, затем в отладчике перейдите к инструкции по адресу 0x7C3A</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-анализ-регистров">2.2. Анализ регистров<a href="#22-анализ-регистров" class="hash-link" aria-label="Прямая ссылка на 2.2. Анализ регистров" title="Прямая ссылка на 2.2. Анализ регистров">​</a></h4>
<p>Выведите все регистры, обратите своё внимание на регистр cr0, проанализируйте значения сегментных регистров</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="23-вывод-таблицы-дескрипторов">2.3. Вывод таблицы дескрипторов<a href="#23-вывод-таблицы-дескрипторов" class="hash-link" aria-label="Прямая ссылка на 2.3. Вывод таблицы дескрипторов" title="Прямая ссылка на 2.3. Вывод таблицы дескрипторов">​</a></h4>
<p>Выведите всю таблицу дескрипторов: <code>x/20x адрес GDT</code>, адрес GDT определите сами используя команду <code>readelf -a lab2.elf</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="24-сравнение-дескрипторов">2.4. Сравнение дескрипторов<a href="#24-сравнение-дескрипторов" class="hash-link" aria-label="Прямая ссылка на 2.4. Сравнение дескрипторов" title="Прямая ссылка на 2.4. Сравнение дескрипторов">​</a></h4>
<p>Сравните дескрипторы хранящиеся в памяти, с дескрипторами описанными в коде программы, проверьте их правильность (например, верно ли записан предел)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="часть-3-выполнение-действий-в-защищённом-режиме">Часть 3. Выполнение действий в защищённом режиме<a href="#часть-3-выполнение-действий-в-защищённом-режиме" class="hash-link" aria-label="Прямая ссылка на Часть 3. Выполнение действий в защищённом режиме" title="Прямая ссылка на Часть 3. Выполнение действий в защищённом режиме">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="31-тест-с-несуществующим-селектором">3.1. Тест с несуществующим селектором<a href="#31-тест-с-несуществующим-селектором" class="hash-link" aria-label="Прямая ссылка на 3.1. Тест с несуществующим селектором" title="Прямая ссылка на 3.1. Тест с несуществующим селектором">​</a></h4>
<p>В программе после перехода в защищённый режим запишите в сегментный регистр GS селектор 0x30 и попробуйте запустить получившуюся программу. Наблюдайте неработоспособность программы. Объясните причину</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="32-тест-с-неправильным-селектором">3.2. Тест с неправильным селектором<a href="#32-тест-с-неправильным-селектором" class="hash-link" aria-label="Прямая ссылка на 3.2. Тест с неправильным селектором" title="Прямая ссылка на 3.2. Тест с неправильным селектором">​</a></h4>
<p>Отредактируйте программу так, чтобы в сегментный регистр данных был записан селектор сегмента кода. Наблюдайте неправильную работу программы. Объясните причину и исправьте программу, чтобы процессор сбрасывался при попытке чтения из сегмента кода</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="33-создание-алиаса">3.3. Создание алиаса<a href="#33-создание-алиаса" class="hash-link" aria-label="Прямая ссылка на 3.3. Создание алиаса" title="Прямая ссылка на 3.3. Создание алиаса">​</a></h4>
<p>Создайте новый дескриптор, который будет дублировать дескриптор сегмента кода (алиас), но будет иметь возможность чтения/записи. Запишите селектор этого алиас в сегментный регистр GS и запишите какое-нибудь число в начало сегмента кода. Проверьте работоспособность программы. В режиме отладки проверьте, действительно ли число было записано в начало сегмента кода</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="34-тест-с-правами-только-на-чтение">3.4. Тест с правами только на чтение<a href="#34-тест-с-правами-только-на-чтение" class="hash-link" aria-label="Прямая ссылка на 3.4. Тест с правами только на чтение" title="Прямая ссылка на 3.4. Тест с правами только на чтение">​</a></h4>
<p>Поменяйте права алиаса на только чтение, попробуйте запустить полученную программу, однако эмулятору добавьте ключ <code>-enable-kvm</code>, который позволит использовать аппаратную виртуализацию процессора, также попробуйте без данного ключа.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="35-перестановка-дескрипторов">3.5. Перестановка дескрипторов<a href="#35-перестановка-дескрипторов" class="hash-link" aria-label="Прямая ссылка на 3.5. Перестановка дескрипторов" title="Прямая ссылка на 3.5. Перестановка дескрипторов">​</a></h4>
<p>Поменяйте местами 2 дескриптора, исправьте программу, чтобы она сохранила работоспособность.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="защита-лабораторной-работы">Защита лабораторной работы<a href="#защита-лабораторной-работы" class="hash-link" aria-label="Прямая ссылка на Защита лабораторной работы" title="Прямая ссылка на Защита лабораторной работы">​</a></h2>
<ol>
<li>Выберите любую машинную команду из лабораторной работы №2 и разберите её</li>
<li>Объясните назначение и использование макроса descr в коде программы. Какие параметры дескриптора задаются через этот макрос?</li>
<li>Почему в GDT используются сегменты с разными правами доступа (EXEC_READ, READ_WRITE)? Как это влияет на выполнение программы?</li>
<li>Как происходит переключение процессора в защищённый режим? Расскажите, какие команды для этого используются в коде.</li>
<li>В коде используется переход <code>ljmp $0x8, $CS_OFF(goto_64k_segment)</code>. Объясните, почему именно эта команда используется для перехода в реальный режим. Что произойдёт, если её заменить на jmp?</li>
<li>Как добавлять новые дескрипторы в таблицу дескрипторов?</li>
<li>Какие ошибки могут возникнуть при загрузке селектора в сегментный регистр?</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="чеклист-выполнения">Чеклист выполнения<a href="#чеклист-выполнения" class="hash-link" aria-label="Прямая ссылка на Чеклист выполнения" title="Прямая ссылка на Чеклист выполнения">​</a></h2>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Созданы файлы <code>lab2.S</code>, <code>linker.ld</code>, <code>Makefile</code></li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Программа успешно собирается через <code>make</code></li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Программа запускается в QEMU, наблюдается вывод символов и возврат в реальный режим</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнено изменение сообщения в коде</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Проведен анализ регистров и GDT в отладчике GDB</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнены эксперименты с селекторами (несуществующий, неправильный, алиас)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Выполнены задания по защите лабораторной работы</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="часто-задаваемые-вопросы-faq">Часто задаваемые вопросы (FAQ)<a href="#часто-задаваемые-вопросы-faq" class="hash-link" aria-label="Прямая ссылка на Часто задаваемые вопросы (FAQ)" title="Прямая ссылка на Часто задаваемые вопросы (FAQ)">​</a></h2>
<p><strong>Q: Почему мы используем <code>ljmp</code> для перехода в защищённый режим?</strong>
A: Инструкция <code>ljmp</code> (long jump) позволяет одновременно обновить регистр CS (сегмент кода) и EIP (указатель инструкции). При переходе в защищённый режим в CS нужно загрузить селектор сегмента кода из GDT, что невозможно сделать командой <code>mov</code>.</p>
<p><strong>Q: Зачем нужен макрос <code>descr</code>?</strong>
A: Структура дескриптора сегмента сложна и биты &quot;разбросаны&quot; по 8 байтам. Макрос упрощает создание дескриптора, автоматически формируя правильную битовую структуру из понятных параметров (база, лимит, атрибуты).</p>
<p><strong>Q: Почему программа &quot;падает&quot; при неправильном селекторе?</strong>
A: В защищённом режиме процессор проверяет права доступа при каждой загрузке сегментного регистра. Если селектор некорректен (индекс за пределами таблицы, неправильный RPL) или дескриптор запрещает операцию (например, запись в кодовый сегмент), процессор генерирует исключение (обычно #GP - General Protection Fault). Если обработчик исключений не установлен (как в нашей лабораторной), происходит &quot;тройной сбой&quot; (Triple Fault) и перезагрузка.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="связанные-материалы">Связанные материалы<a href="#связанные-материалы" class="hash-link" aria-label="Прямая ссылка на Связанные материалы" title="Прямая ссылка на Связанные материалы">​</a></h2>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html" target="_blank" rel="noopener noreferrer">Intel® 64 and IA-32 Architectures Software Developer Manuals</a></li>
<li><a href="https://wiki.osdev.org/Global_Descriptor_Table" target="_blank" rel="noopener noreferrer">OSDev Wiki: Global Descriptor Table</a></li>
<li><a href="https://wiki.osdev.org/Protected_Mode" target="_blank" rel="noopener noreferrer">OSDev Wiki: Protected Mode</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="приложение">Приложение<a href="#приложение" class="hash-link" aria-label="Прямая ссылка на Приложение" title="Прямая ссылка на Приложение">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile">Makefile<a href="#makefile" class="hash-link" aria-label="Прямая ссылка на Makefile" title="Прямая ссылка на Makefile">​</a></h3>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">all: lab2.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	dd if=lab2.bin of=boot.img # Записываем программу в disk.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lab2.o: lab2.S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	cpp -o lab2.s lab2.S # Разворачиваем макрорасширения</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	as --32 -o lab2.o lab2.s # Компилируем программу для архитектуры x86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lab2.bin: lab2.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ld -m elf_i386 -T linker.ld --gc-sections -o lab2.elf lab2.o # Связываем объектный файл lab2.o с использованием скрипта линкера linker.ld, создавая ELF-файл lab2.elf. Флаг --gc-sections удаляет неиспользуемые секции для оптимизации.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	objcopy -S -O binary lab2.elf lab2.bin # Конвертируем ELF-файл lab2.elf в чистый бинарный файл lab2.bin. Флаг -S исключает символы и отладочную информацию, а -O binary указывает формат вывода.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm *.o *.elf *.bin *.s *.img #Удаляем всё лишнее</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linkerld">linker.ld<a href="#linkerld" class="hash-link" aria-label="Прямая ссылка на linker.ld" title="Прямая ссылка на linker.ld">​</a></h3>
<div class="language-ld codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ld codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Указываем точку входа в программу. В данном случае это функция _start. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRY(_start)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Определяем секции и их расположение в памяти. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Устанавливаем текущий адрес (счетчик местоположения) на 0x7C00.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Это стандартный адрес, по которому BIOS загружает загрузочный сектор. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    . = 0x7C00;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .text: содержит исполняемый код программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .text : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.text) /* Включаем все объектные файлы, которые содержат секцию .text. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .data: содержит инициализированные данные программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .data : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.data) /* Включаем все объектные файлы, которые содержат секцию .data. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .stack: выделяет память для стека программы. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .stack : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.stack) /* Включаем все объектные файлы, которые содержат секцию .stack. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция /DISCARD/: указывает компоновщику отбросить ненужные секции.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Это помогает уменьшить размер итогового бинарного файла. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /DISCARD/ : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.note*)  /* Отбрасываем все секции, начинающиеся с .note (например, отладочные метаданные). */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.comment) /* Отбрасываем секции с комментариями. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *(.gnu*)   /* Отбрасываем все секции, начинающиеся с .gnu (например, специфичные для GNU атрибуты). */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Перемещаем текущий адрес на 0x7DFE. Это предпоследний байт загрузочного сектора. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    . = 0x7DFE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Секция .sig: добавляет сигнатуру загрузочного сектора.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       BIOS проверяет эту сигнатуру, чтобы убедиться, что сектор является загрузочным. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .sig : AT(0x7DFE) /* Указываем, что эта секция должна быть расположена по адресу 0x7DFE. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SHORT(0xAA55) /* Записываем два байта: 0x55 и 0xAA (в обратном порядке из-за little-endian). */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lab2s">lab2.S<a href="#lab2s" class="hash-link" aria-label="Прямая ссылка на lab2.S" title="Прямая ссылка на lab2.S">​</a></h3>
<div class="language-asm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-asm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define EXEC_ONLY 0x8                     // сегмент кода, только исполнение</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define EXEC_READ 0xA                     // сегмент кода, исполнение и чтение</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define READ_ONLY 0x0                     // сегмент данных, только чтение</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define READ_WRITE 0x2                    // сегмент данных, чтение и запись</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define G_BYTE 0x0                        // байтовая гранулярность</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define G_PAGE 0x80                       // страничная гранулярность</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define SEG_16 0x0                        // 16-разрядный сегмент</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define SEG_32 0x40                       // 32-разрядный сегмент</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define STACK_SIZE 0x10                   // размер стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Макроопределение в С-стиле. Создает дескриптор с заданными параметрами</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   base, limit, type, attr. Для задания типа и атрибутов использовать макроопределения выше.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define descr(base, limit, type, attr) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .word (limit &amp; 0xFFFF); \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .word (base &amp; 0xFFFF); \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .byte ((base &gt;&gt; 16) &amp; 0xFF); \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .byte (0x90 | (type)); \ // поля P и S – присутутствует в ОП, не является системным сегментов</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .byte (attr | ((limit &gt;&gt; 16) &amp; 0xF)); \ // записываем 4 старших разряда из предела сегмента и attr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .byte ((base &gt;&gt; 24) &amp; 0xFF) // старшие 8 байтов базы сегмента</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**********************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Компоновщик GNU ld умеет работать только с моделью памяи FLAT.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Для прямой адресации использовать следующие макросы.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define CS_OFF(label) (label - _start) // смещение относительно начала сегмента кода</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define DS_OFF(label) (label - .data) // смещение относительно начала сегмента данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**********************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Процессор загружает первый сектор диска (512 байт) по адресу 0x0:0x7C00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  и передает на него управление: ip = 0x7C00.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Процессор находится в реальном режиме.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Значения сегментных регистров: перед выполнением кода</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cs = 0x0    ds = 0x0    es = 0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ss = 0x0    fs = 0x0    gs = 0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************** Начало секции Кода *******************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.code16                                 // указание ассемблеру генерировать 16-разрядный код</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.global _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0x3, %ax                        // очистка экрана: задаем режим видеоадаптера (80x25, 16-цветный)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int $0x10                             // используем 0x10 прерывание BIOS (ah = 0, al = 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $.data, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $seg_data, %bx                   // записываем базовый адрес семента данных в соответствующий дескриптор</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, 2(%bx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $.stack, %ax                     // записываем базовый адрес сегмента стека в соответствующий дескриптор</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $seg_stack, %bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, 2(%bx)                      // (для кода и видеобуфера базовые адреса известны)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cli                                   // запрещаем аппаратные прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movb $0x80, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outb %al, $0x70                       // запрещаем NMI (немаскируемые прерывания)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inb $0x92, %al                        // включаем А20 адресную линию</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orb $0x2, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outb %al, $0x92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lgdt gdtdesc                          // загружаем значение GDTR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movl %cr0, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orl $1, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movl %eax, %cr0                       // устанавливаем бит PE в регистре CR0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        //  Эти инструкции должны выполняться   непосредственно друг за другом</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ljmp $0x8, $CS_OFF(goto_prot)         // переходим в новый сегмент кода (cs, ip) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**********************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Теперь процессор работает в защищенном режиме</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.code32                                 // указание компилятору генерировать 32-разрядный код</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goto_prot:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0x10, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %ds                         // загружаем новый селектор сегмента данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0x18, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %ss				// загружаем новый селектор сегмента стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movl $STACK_SIZE, %esp		// устанавливаем указатель стека на значение &quot;дна&quot; стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0x20, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %es				// загружаем селектор сегмента видеобуфера</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Обращение за пределы GDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#	movw $0x30, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#	movw %ax, %gs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Селектор сегмента кода в сегмент данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#	movw $0x8, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#	movw %ax, %ds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Протестируем запись символов ascii в видеопамять */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movl $320, %ebx			// начальное смещение на экране</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movl $110, %ecx			// число выводимых символов</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ds:DS_OFF(symbol), %ax		// загружаем начальный символ с атрибутом (обращение к сегменту данных!)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_pm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %es:(%ebx)			// записываем очередной символ в видеопамять (обращение к сегменту видеопамяти!)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  addl $2, %ebx				// смещаемся в видеобуфере</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  incw %ax				// код следующего символа</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pushl %ecx				// сохраняем ecx в стеке (обращение к сегменту стека!)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movl $0xFFFFFF, %ecx			// добавим паузу для наглядности</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">idle:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loop idle				// цикл паузы</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  popl %ecx				// возвращаем ecx из стека</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loop print_pm				// цикл вывода на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stop:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jmp stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Подготовим переход в реальный режим. Сперва надо сформировать дескрипторы для реального режима.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Для этого модифицируем соответствующие дескрипторы в GDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0xFFFF, %ds:DS_OFF(seg_text)		// требуется сегмент кода с лимитом 64k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movb $0, %ds:DS_OFF(seg_text) + 6 // обнуляем старшую часть предела</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orb $EXEC_READ, %ds:DS_OFF(seg_text) + 5	// и доступный для чтения</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						// Для остальных сегментов требования следующие</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0xFFFF, %ds:DS_OFF(seg_data)		// 	Limit = 64k (0xFFFF)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movb $0, %ds:DS_OFF(seg_data) + 6		// 	Byte granularity (G = 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orb $READ_WRITE, %ds:DS_OFF(seg_data) + 5	// 	Expand up (E = 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						// 	Writable (W = 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0xFFFF, %ds:DS_OFF(seg_stack)		// 	Present (P = 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movb $0, %ds:DS_OFF(seg_stack) + 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orb $READ_WRITE, %ds:DS_OFF(seg_stack) + 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0xFFFF, %ds:DS_OFF(seg_videomem)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movb $0, %ds:DS_OFF(seg_videomem) + 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orb $READ_WRITE, %ds:DS_OFF(seg_videomem) + 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0x10, %ax			// загрузим теневые регистры сегментов, т. к. изменились сами дескрипторы</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %ds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0x18, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %ss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $0x20, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %es</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ljmp $0x8, $CS_OFF(goto_64k_segment)	// выполним дальний переход, чтобы снова загрузить селектор</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					// в CS и модифицировать его теневой регистр</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goto_64k_segment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .code16				// снова генерируем 16-разрядный код</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movl %cr0, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  andl $0xFFFFFFFE, %eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movl %eax, %cr0			// сбросим бит PE в регистре CR0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ljmp $0x7C00, $CS_OFF(goto_real)	// переходим в реальный режим</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 	Теперь процессор снова работает в реальном режиме</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goto_real:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $.data, %ax			// возвращаем значения сегментных регистров реального режима</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shrw $4, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %ds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %es</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $.stack, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shrw $4, %ax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw %ax, %ss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sti					// разрешим аппаратные и немаскируемые прерывания</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movb $0, %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outb %al, $0x70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Проверяем работоспособность сервиса BIOS */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movb $0x0E, %ah			// вывод символа в режиме телетайпа (атрибут текущий):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  xorw %bx, %bx				// 0-ая страница видеопамяти</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movw $DS_OFF(mesg), %si		// смещение строки символов в регистр si</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_rm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movb (%si), %al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cmpb $0, %al				// пока не встретился &#x27;\0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  je hang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inc %si</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int $0x10				// выводим символы строки на экран</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loop print_rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hang:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  jmp hang				// зацикливание</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text_size = . - _start 			// размер секции кода</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/********************** Начало секции Данных ***********************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*---------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 	Глобальная таблица дескрипторов</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.align 16								// процессор быстрее обращается с выровненной таблицей</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GDT:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_null: .quad 0							// нулевой дескриптор - 8 байт</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_text: descr (0x7C00, (text_size - 1), EXEC_READ, G_BYTE | SEG_32)	// дескриптор сегмента кода 	(селектор 0x8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_data: descr (0, (data_size - 1), READ_WRITE, G_BYTE | SEG_32)	// дескриптор сегмента данных	(селектор 0x10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_stack: descr (0, (stack_size - 1), READ_WRITE, G_BYTE | SEG_32)	// дескриптор сегмента стека	(селектор 0x18)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seg_videomem: descr (0xB8000, 0xFFF, READ_WRITE, G_BYTE | SEG_32)	// дескриптор видеобуфера	(селектор 0x20)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GDT_size = . - GDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*-------------------------------------------------------------------------------*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gdtdesc:  .word GDT_size - 1		// предел GDT 2 байта</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         .long GDT			// базовый адрес GDT 4 байта</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">symbol:   .byte 1			// начальный код символа для вывода на экран в защищенном режиме</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym_attr: .byte 0x1e			// атрибут символа</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesg:     .asciz &quot;Back to real mode!!!&quot;	// сообщение при возращении в реальный режим</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_size = . - .data			// размер секции данных</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/************************* Секция Стека ***********************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.section .stack, &quot;wa&quot; //  w  – разрешена запись, а-  разрешено динамическое  выделение памяти</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.align 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.space STACK_SIZE, &#x27;^&#x27;			// выделим место под стек и заполним его символом &#x27;^&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stack_size = . - .stack			// размер секции стека</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/efremovnv/docs/edit/main/website/docs/peripheral-devices/lab2.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Отредактировать эту страницу</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Последнее обновление<!-- --> <b><time datetime="2025-11-22T17:49:14.000Z" itemprop="dateModified">22 нояб. 2025 г.</time></b></span></div></div></footer></article><div class="margin-top--lg"><button class="button button--secondary button--sm">📄 Скачать PDF</button></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/labs/peripheral-devices/lab1"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">Лабораторная работа №1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/labs/peripheral-devices/lab3"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">Лабораторная работа №3</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#контекст" class="table-of-contents__link toc-highlight">Контекст</a></li><li><a href="#сокращения" class="table-of-contents__link toc-highlight">Сокращения</a></li><li><a href="#цель-работы" class="table-of-contents__link toc-highlight">Цель работы</a></li><li><a href="#необходимые-инструменты" class="table-of-contents__link toc-highlight">Необходимые инструменты</a></li><li><a href="#исходные-файлы-лабораторной-работы" class="table-of-contents__link toc-highlight">Исходные файлы лабораторной работы</a></li><li><a href="#материалы-для-подготовки-к-лабораторной-работе" class="table-of-contents__link toc-highlight">Материалы для подготовки к лабораторной работе</a><ul><li><a href="#реальный-режим-работы-процессора-x86" class="table-of-contents__link toc-highlight">Реальный режим работы процессора X86</a></li><li><a href="#защищённый-режим-работы-процессора-x86" class="table-of-contents__link toc-highlight">Защищённый режим работы процессора X86</a></li><li><a href="#структура-и-организация-дескрипторов-и-селекторов-памяти-дескрипторные-таблицы" class="table-of-contents__link toc-highlight">Структура и организация дескрипторов и селекторов памяти. Дескрипторные таблицы</a></li><li><a href="#разбор-машинных-команд" class="table-of-contents__link toc-highlight">Разбор машинных команд</a></li></ul></li><li><a href="#вопросы-для-самоконтроля" class="table-of-contents__link toc-highlight">Вопросы для самоконтроля</a></li><li><a href="#выполнение-лабораторной-работы" class="table-of-contents__link toc-highlight">Выполнение лабораторной работы</a><ul><li><a href="#часть-1-подготовка-к-выполнению-лабораторной-работы" class="table-of-contents__link toc-highlight">Часть 1. Подготовка к выполнению лабораторной работы</a></li><li><a href="#часть-2-анализ-программы" class="table-of-contents__link toc-highlight">Часть 2. Анализ программы</a></li><li><a href="#часть-3-выполнение-действий-в-защищённом-режиме" class="table-of-contents__link toc-highlight">Часть 3. Выполнение действий в защищённом режиме</a></li></ul></li><li><a href="#защита-лабораторной-работы" class="table-of-contents__link toc-highlight">Защита лабораторной работы</a></li><li><a href="#чеклист-выполнения" class="table-of-contents__link toc-highlight">Чеклист выполнения</a></li><li><a href="#часто-задаваемые-вопросы-faq" class="table-of-contents__link toc-highlight">Часто задаваемые вопросы (FAQ)</a></li><li><a href="#связанные-материалы" class="table-of-contents__link toc-highlight">Связанные материалы</a></li><li><a href="#приложение" class="table-of-contents__link toc-highlight">Приложение</a><ul><li><a href="#makefile" class="table-of-contents__link toc-highlight">Makefile</a></li><li><a href="#linkerld" class="table-of-contents__link toc-highlight">linker.ld</a></li><li><a href="#lab2s" class="table-of-contents__link toc-highlight">lab2.S</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">efremovnv</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Начало</a></li></ul></div><div class="col footer__col"><div class="footer__title">Ресурсы</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/efremovnv/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 efremovnv. Создано с помощью Docusaurus.</div></div></div></footer></div>
</body>
</html>